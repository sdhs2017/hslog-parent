webpackJsonp([90],{E2EQ:function(e,t){},XLfe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),o=a.n(i),n=a("XLwt"),r={name:"detectionAnomalies",data:function(){return{str:"system76@Galago-UltraPro:~$ juju add-relation memcached mediawiki system76",list:[],websocket:null,SH:"",moveState:!0,chartState:!1,dataDetailLoading:!1,leftLoading2:!1,leftLoading1:!1,color:[],size:[],falseB:!1}},mounted:function(){this.$refs.Box.addEventListener("scroll",this.scrollHeight),this.getTrainChart(),this.getDetectChart()},created:function(){},destroyed:function(){this.websocket.close()},watch:{SH:function(e,t){e<t?this.moveState=!1:e+this.$refs.Box.clientHeight==this.$refs.Box.scrollHeight&&(this.moveState=!0)},chartState:function(){var e=this;this.chartState&&this.$nextTick(function(){e.getChartData()})}},methods:{creatSocket:function(e){var t=this;"WebSocket"in window?this.websocket=new WebSocket("ws://127.0.0.1:8080/hslog/websocket/"+e):alert("当前浏览器 Not support websocket"),this.websocket.onerror=function(){console.log("WebSocket连接发生错误")},this.websocket.onopen=function(){console.log("WebSocket连接成功")},"train"===e?this.appendP("训练开始"):this.appendP("检测开始"),this.websocket.onmessage=function(e){t.appendP(e.data)}},scrollHeight:function(){this.SH=this.$refs.Box.scrollTop},appendP:function(e){var t=this;this.list.push(e),this.$nextTick(function(){t.moveState&&$(".p-wapper").scrollTop($(".p-wapper")[0].scrollHeight)})},getTrainChart:function(){var e=this;this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/ml/getTrainData.do",e.$qs.stringify()).then(function(t){e.leftLoading1=!1;var a=t.data;if("true"==a.success){var i=n.init(e.$refs.left1);e.leftLoading1=!1,i.setOption({title:{text:"训练数据",x:"center",textStyle:{color:"#5bc0de"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{type:"scroll",pageTextStyle:{color:"#eee"},width:"80%",right:"5%",top:"25px",textStyle:{color:"#eee"},pageIconColor:"#fff"},xAxis:{type:"category",name:"时间",nameTextStyle:{color:"#5bc0de"},axisLine:{lineStyle:{color:"#5bc0de"}},boundaryGap:!1,axisLabel:{borderColor:"#5bc0de",rotate:"10"},data:a.data[0].timestamp},grid:{},yAxis:{name:"日志数",nameTextStyle:{color:"#5bc0de"},splitLine:{lineStyle:{color:"#303e4e"}},axisLine:{lineStyle:{color:"#5bc0de"}},axisLabel:{margin:2,formatter:function(e,t){return e>=1e4&&e<1e7?e=e/1e4+"万":e>=1e7&&(e=e/1e7+"千万"),e}}},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{color:"#5bc0de"},data:a.data[0].value}]}),window.addEventListener("resize",function(){i.resize()})}else layer.msg(a.message,{icon:5})}).catch(function(t){e.leftLoading1=!1})})},getDetectChart:function(){var e=this;this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/ml/getTestData.do",e.$qs.stringify()).then(function(t){e.leftLoading2=!1;var a=t.data;if("true"==a.success){var i=n.init(e.$refs.left2);e.leftLoading2=!1,i.setOption({title:{text:"待检测数据",x:"center",textStyle:{color:"#5bc0de"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{type:"scroll",pageTextStyle:{color:"#eee"},width:"80%",right:"5%",top:"25px",textStyle:{color:"#eee"},pageIconColor:"#fff"},xAxis:{type:"category",name:"时间",nameTextStyle:{color:"#5bc0de"},axisLine:{lineStyle:{color:"#5bc0de"}},boundaryGap:!1,axisLabel:{borderColor:"#5bc0de",rotate:"10"},data:a.data[0].timestamp},grid:{},yAxis:{name:"日志数",nameTextStyle:{color:"#5bc0de"},splitLine:{lineStyle:{color:"#303e4e"}},axisLine:{lineStyle:{color:"#5bc0de"}},axisLabel:{margin:2,formatter:function(e,t){return e>=1e4&&e<1e7?e=e/1e4+"万":e>=1e7&&(e=e/1e7+"千万"),e}}},series:[{type:"line",smooth:!0,lineStyle:{color:"#5bc0de"},data:a.data[0].value}]}),window.addEventListener("resize",function(){i.resize()})}else layer.msg(a.message,{icon:5})}).catch(function(t){e.leftLoading2=!1})})},getChartData:function(){var e=this;this.$nextTick(function(){e.dataDetailLoading=!0,e.$axios.post(e.$baseUrl+"/ml/getDetectResult.do",e.$qs.stringify()).then(function(t){var a=t.data;if("true"==a.success){var i=a.data[0].timestamp,r=a.data[0].real_value;e.color=a.data[0].color,e.size=a.data[0].size,setTimeout(function(){var t=n.init(e.$refs.mybox);e.dataDetailLoading=!1,t.setOption({title:{text:"",x:"center",textStyle:{color:"#5bc0de"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{type:"scroll",pageTextStyle:{color:"#eee"},width:"80%",right:"5%",top:"25px",textStyle:{color:"#eee"},pageIconColor:"#fff"},xAxis:{type:"category",name:"时间",nameTextStyle:{color:"#5bc0de"},axisLine:{lineStyle:{color:"#5bc0de"}},boundaryGap:!1,axisLabel:{borderColor:"#5bc0de",rotate:"10"},data:i},grid:{},yAxis:{name:"日志数",nameTextStyle:{color:"#5bc0de"},splitLine:{lineStyle:{color:"#303e4e"}},axisLine:{lineStyle:{color:"#5bc0de"}},axisLabel:{margin:2,formatter:function(e,t){return e>=1e4&&e<1e7?e=e/1e4+"万":e>=1e7&&(e=e/1e7+"千万"),e}}},series:[{type:"line",symbolSize:function(t,a){var i=e.size[a.dataIndex];return o()(i)},smooth:!0,symbol:"circle",showAllSymbol:!0,itemStyle:{color:function(t){return e.color[t.dataIndex]}},lineStyle:{color:"#5bc0de"},data:r}]}),window.addEventListener("resize",function(){t.resize()})},2e3)}else layer.msg(a.message,{icon:5})}).catch(function(t){e.dataDetailLoading=!1})})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[e._v("\n        异常检测\n        "),a("div",{staticStyle:{float:"right","margin-right":"10px"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.creatSocket("train")}}},[e._v("训练")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.creatSocket("detect")}}},[e._v("检测")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.chartState=!0}}},[e._v("查看异常检测结果")])],1)]),e._v(" "),a("div",{staticClass:"scroll-wapper"},[a("div",{staticClass:"left-wapper"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.leftLoading1,expression:"leftLoading1"}],ref:"left1",staticClass:"chart-wapper",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}}),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.leftLoading2,expression:"leftLoading2"}],ref:"left2",staticClass:"chart-wapper",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}})]),e._v(" "),a("div",{staticClass:"right-wapper"},[a("div",{staticClass:"right-tit"},[e._v("运行日志")]),e._v(" "),a("div",{ref:"Box",staticClass:"p-wapper"},e._l(this.list,function(t,i){return a("p",{key:i},[e._v(e._s(t))])}),0)])]),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.dataDetailLoading,expression:"dataDetailLoading"}],attrs:{title:"异常检测结果",visible:e.chartState,width:"85vw",height:"80vh","destroy-on-close":"","element-loading-background":"rgba(48, 62, 78, 0.5)","close-on-click-modal":e.falseB},on:{"update:visible":function(t){e.chartState=t}}},[a("div",{ref:"mybox",staticClass:"detail-wapper"}),e._v(" "),a("div",{staticClass:"text-wapper"},[a("p",[a("span",{staticStyle:{background:"#FE2D46"}}),e._v("异常值极高，需重点查验")]),e._v(" "),a("p",[a("span",{staticStyle:{background:"#FAA90E"}}),e._v("异常值较高")]),e._v(" "),a("p",[a("span",{staticStyle:{background:"#5bc0de"}}),e._v("数据正常")])])])],1)},staticRenderFns:[]};var s=a("VU/8")(r,l,!1,function(e){a("E2EQ")},"data-v-2baf3cd8",null);t.default=s.exports}});