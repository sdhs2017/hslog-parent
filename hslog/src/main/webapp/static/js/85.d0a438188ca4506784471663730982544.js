webpackJsonp([85],{f2km:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("ID1p"),n=a("qTy0"),s=a("/sA3"),o=a("8+FI"),l={name:"equipment",data:function(){var e=this;return{loading:!1,busName:"logicAssetsList",busNames:{selectionName:"logicAssetsDelect"},page:1,c_page:1,size:15,logBaseJson:[],logType:[],typeArr:[],formConditionsArr:[],searchConditions:{name:"",hostName:"",ip:"",type:""},saveCondition:"",tableHead:[{prop:"name",label:"资产名称",width:""},{prop:"hostName",label:"主机名",width:""},{prop:"type",label:"资产类型",width:"",formatData:function(e){return"01"==e?"实体机":"02"==e?"虚拟机":"03"==e?"微服务(类Docker)":type}},{prop:"ip",label:"IP地址",width:"125"},{prop:"startUp",label:"是否启用",width:"",formatData:function(e){return"1"==e?"是":"否"}},{prop:"createTime",label:"创建时间",width:"",formatData:function(e){return e.split(".")[0]}},{prop:"tools",label:"操作",width:"",btns:[{icon:"el-icon-edit",text:"修改资产",clickFun:function(t,a){e.reviseLogicAssets(t,a)}}]},{prop:"threats",label:"",width:"70",formatData:function(e,t){var a="";return 0!==t.high_risk&&(a+='<span title="高危事件数'+t.high_risk+'" style="display:inline-block;width: 20px;height:20px;border-radius: 100%;background: #f55446;text-align: center">'+t.high_risk+"</span>"),0!==t.moderate_risk&&(a+='<span title="中危事件数'+t.moderate_risk+'" style="display:inline-block;width: 20px;height:20px;border-radius: 100%;background: #f1ae09;text-align: center">'+t.moderate_risk+"</span>"),a}}],tableData:[],firstGetData:!0,allCounts:0,selectEquipmentId:"",delectEquipmentIds:""}},created:function(){var e=this;this.getLogType(),this.formConditionsArr=[{label:"资产名称",paramName:"name",model:{model:""},itemType:"",type:"input"},{label:"IP地址",paramName:"ip",itemType:"",model:{model:""},type:"input"},{label:"主机名",paramName:"hostName",model:{model:""},itemType:"",type:"input"},{label:"资产类型",paramName:"type",type:"select",itemType:"",model:{model:""},options:[{label:"全部",value:""},{label:"实体机",value:"01"},{label:"虚拟机",value:"02"},{label:"微服务(类Docker)",value:"03"}]}],o.default.$on(this.busName,function(t){e.searchConditions=t,e.getEquipmentList(e.searchConditions,1),e.c_page=1}),o.default.$on(this.busNames.selectionName,function(t){for(var a in e.delectEquipmentIds="",t)e.delectEquipmentIds+=t[a].id+","})},beforeDestroy:function(){o.default.$off(this.busName),o.default.$off(this.busNames.selectionName)},mounted:function(){},methods:{getLogType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/logTypeLevel.json",{}).then(function(t){e.logBaseJson=t.data,e.logType.push({value:"",label:"全部"});for(var a=0;a<t.data.length;a++){var i={value:t.data[a].type,label:t.data[a].type};e.logType.push(i)}}).catch(function(e){console.log(e)})})},getEquipmentList:function(e,t){var a=this;this.loading=!0;var i=e;i.pageIndex=t,i.pageSize=this.size,this.$nextTick(function(){a.$axios.post(a.$baseUrl+"/asset/selectPage.do",a.$qs.stringify(i)).then(function(e){a.loading=!1,a.tableData=e.data[0].asset,a.allCounts=JSON.parse(e.data[0].count.count),a.saveCondition=a.searchConditions}).catch(function(e){a.loading=!1,console.log(e)})})},selectEquipment:function(){var e=this;this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/asset/selectAsset.do",e.$qs.stringify({id:e.selectEquipmentId})).then(function(t){if(e.loading=!1,"false"===t.data.success)layer.msg(t.data.message,{icon:5});else{for(var a=t.data.equipment,i=0;i<a.length;i++){a[i].createTime&&(a[i].createTime=a[i].createTime.split(".")[0]),a[i].upDateTime&&(a[i].upDateTime=a[i].upDateTime.split(".")[0]),a[i].endTime&&(a[i].endTime=a[i].endTime.split(".")[0]),"1"==a[i].startUp?a[i].startUp="是":a[i].startUp="否";var n="",s=a[i].type.substring(0,2);for(var o in e.typeArr){var l=e.typeArr[o];if(l.value==s){for(var r in n+=l.label+"-",l.children)if(l.children[r].value==a[i].type){n+=l.children[r].label;break}break}}a[i].type=n}e.tableData=a}}).catch(function(t){e.loading=!1,console.log(t)})})},handleCurrentChange:function(e){this.getEquipmentList(this.saveCondition,e),this.firstGetData=!1},goToAddLogicAssets:function(){this.$router.push({path:"addLogicAssets"})},removeLogicAssets:function(){var e=this;""===this.delectEquipmentIds?layer.msg("未选中任何资产",{icon:5}):layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){layer.close(t),e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/asset/delete.do",e.$qs.stringify({id:e.delectEquipmentIds})).then(function(t){"true"==t.data.success?(layer.msg("删除成功",{icon:1}),e.getEquipmentList(e.searchConditions,1),e.c_page=1):layer.msg("删除失败",{icon:5})}).catch(function(e){layer.msg("删除失败",{icon:5})})})},function(){layer.close()})},reviseLogicAssets:function(e,t){Object(s.l)("reviseLogicAssets"+e.id,"equipment/reviseLogicAssets.vue",{name:e.name,id:e.id},"逻辑资产修改")},equipmentLogs:function(e,t){Object(s.l)("equipmentLogs"+e.id,"logsManage/equipmentLogs.vue",{name:e.name,id:e.id,logType:e.logType},"日志")},equipmentEcharts:function(e,t){Object(s.l)("equipmentEcharts"+e.id,"equipment/equipmentEcharts.vue",{name:e.name,id:e.id,logType:e.logType},"统计")},equipmentEvents:function(e,t){Object(s.l)("equipmentEvents"+e.id,"eventManage/equipmentEvents.vue",{name:e.name,id:e.id},"事件")},setSafe:function(e,t){Object(s.l)("equipmentSafe"+e.id,"equipment/equipmentSafe.vue",{name:e.name,id:e.id,logType:e.logType},"安全策略")},theartAnalyse:function(e,t){Object(s.l)("equipmentThreat"+e.id,"equipment/equipmentThreat.vue",{name:e.name,id:e.id,logType:e.logType},"威胁分析")}},watch:{},beforeRouteEnter:function(e,t,a){a(function(t){void 0!==e.params.equipmentid?(t.selectEquipmentId=e.params.equipmentid,t.selectEquipment()):t.getEquipmentList(t.searchConditions,1)})},components:{vSearchForm:i.default,vBasetable:n.default}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[e._v("逻辑资产管理")]),e._v(" "),a("div",{staticClass:"equipemnt-tools-form"},[a("v-search-form",{attrs:{formItem:e.formConditionsArr,busName:e.busName}})],1),e._v(" "),a("div",{staticClass:"equipment-tools"},[a("div",{staticClass:"equipemnt-tools-btns"},[a("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:e.goToAddLogicAssets}},[e._v("添加资产")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:e.removeLogicAssets}},[e._v("删除资产")])],1)]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"equipment-table-wapper",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("v-basetable",{attrs:{selection:!0,tableHead:e.tableHead,tableData:e.tableData,busName:e.busNames}})],1),e._v(" "),a("div",{staticClass:"equipment-table-page"},[a("span",[e._v("共检索到资产数量为 "),a("b",[e._v(e._s(e.allCounts))]),e._v(" 台")]),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.size,total:e.allCounts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t},"update:current-page":function(t){e.c_page=t}}})],1)])},staticRenderFns:[]};var c=a("VU/8")(l,r,!1,function(e){a("iw6P")},"data-v-39e68bbe",null);t.default=c.exports},iw6P:function(e,t){}});