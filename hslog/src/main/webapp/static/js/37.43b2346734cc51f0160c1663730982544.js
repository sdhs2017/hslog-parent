webpackJsonp([37],{"3FgM":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),n=a("62NR"),r=a("ck3A"),l=a.n(r),o=a("/sA3"),c={name:"alarmExecuteDetail",data:function(){var e=this;return{alarmId:"",alarmName:"",loading:!1,snapshotDialog:!1,dialogTitle:"",allCounts:0,page:1,c_page:1,size:15,snapshotJson:"",tableHead:[{prop:"run_time",label:"执行时间",width:"200",formatData:function(e,t){return t.alert_fire?'<span style="color: #F56C6C;">'+e+"</span>":e}},{prop:"alert_conditions",label:"条件",width:"",formatData:function(t,a){return a.alert_fire?'<span style="color: #F56C6C;">'+e.setAlertCondition(t)+"</span>":e.setAlertCondition(t)}},{prop:"match_size",label:"匹配结果数",width:"",formatData:function(e,t){return t.alert_fire?'<span style="color: #F56C6C;">'+e+"</span>":e}},{prop:"alert_fire",label:"是否告警",width:"150",formatData:function(e,t){return t.alert_fire?'<span style="color: #F56C6C;">是</span>':"否"}},{prop:"state",label:"操作",width:"150",clickFun:function(t){e.snapshotDialog=!0;var a=JSON.parse(s()(t));a.result=JSON.parse(a.result),e.dialogObj=a},formatData:function(e,t){return t.alert_fire?'<span style="color: #F56C6C;">详情</span>':'<span style="color: #D6DFEB;">详情</span>'}}],tableData:[],dateVal:[],param:{starttime:"",endtime:""},pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},dialogObj:{alert_name:"",alert_conditions:'[{"field":"value","operator":">","value":"2000"}]',pre_index_name:"winlog",suffix_index_name:"*",alert_exec_cycle:"",alert_time:"",alert_exec_type:"",alert_time_type:"",alert_assetGroup_name:"",alert_equipment_name:"lihaaa-pc",msg:"[]"}}},created:function(){var e=new Date,t=new Date;t.setTime(t.getTime()-864e5*this.$store.state.beforeDay),this.dateVal=[Object(o.e)("yyyy-mm-dd HH:MM:SS",t),Object(o.e)("yyyy-mm-dd",e)+" 23:59:59"],this.param.endtime=this.dateVal[1],this.param.starttime=this.dateVal[0],this.getAlarmExecute(this.param,1)},methods:{setAlertCondition:function(e){var t="",a=JSON.parse(e);for(var i in a)"is one of"!==a[i].operator&&"is not one of"!==a[i].operator?t+=a[i].field+" "+a[i].operator+" "+a[i].value+"; ":t+=a[i].field+" "+a[i].operator+" "+a[i].values+"; ";return t},setAlertExcute:function(e){if("simple"===e.alert_exec_type){var t="";return"second"===e.alert_time_cycle_type?t="秒":"minute"===e.alert_time_cycle_type?t="分钟":"hour"===e.alert_time_cycle_type&&(t="小时"),""+e.alert_time_cycle_num+t}return e.alert_cron},setAlertTime:function(e){var t="",a=e.alert_time;if("simple"===e.alert_exec_type){var i="";return"second"===e.alert_time_cycle_type?i="秒":"minute"===e.alert_time_cycle_type?i="分钟":"hour"===e.alert_time_cycle_type&&(i="小时"),"最近"+e.alert_time_cycle_num+i}if("range"===e.alert_time_type){var s=a.split(",");""===s[0]&&(s[0]="*"),""===s[1]&&(s[1]="*"),t=s[0]+"至"+s[1]}else if("1-daying"===a)t="今天";else if("1-weeking"===a)t="这周";else if("1-monthing"===a)t="本月";else{var n=a.split("-");t="min"===n[1]?"最近"+n[0]+"分钟":"hour"===n[1]?"最近"+n[0]+"小时":"day"===n[1]?"最近"+n[0]+"天":"时间格式未知"}return t},refrshData:function(){this.getAlarmExecute(this.param,1),this.c_page=1},getAlarmExecute:function(e,t){var a=this;this.loading=!0;var i=e;i.alert_id=this.$route.query.id,i.pageIndex=t,i.pageSize=this.size,this.$nextTick(function(){a.loading=!0,a.$axios.post(a.$baseUrl+"/alert/getAlertList.do",a.$qs.stringify(i)).then(function(e){a.loading=!1;var t=e.data;"true"===t.success?(a.allCounts=Number(t.data.count),a.tableData=t.data.list):layer.msg(t.message,{icon:5})}).catch(function(e){a.loading=!1})})},timeChange:function(){this.param.endtime=this.dateVal[1],this.param.starttime=this.dateVal[0],this.getAlarmExecute(this.param,1)},handleCurrentChange:function(e){this.getAlarmExecute(this.param,e)}},beforeRouteEnter:function(e,t,a){a(function(t){t.$options.name="editAlarm"+e.query.id,t.alarmName=e.query.name;var a={path:"alarmExecuteDetail"+e.query.id,component:"alarmManage/alarmExecuteDetail.vue",title:"执行详情"};sessionStorage.setItem("/alarmExecuteDetail"+e.query.id,s()(a)),""!==t.alarmId&&t.alarmId===e.query.id||(t.alarmId=e.query.id)})},components:{vBasetable:n.default,jsonView:l.a}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"content-bg",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("div",{staticClass:"top-title"},[e._v(e._s(this.alarmName)+" 执行详情\n        "),a("div",{staticClass:"data-box"},[e._v("\n            日期范围:\n            "),a("el-date-picker",{staticClass:"date-wapper",attrs:{type:"datetimerange","range-separator":"至",size:"mini",clearable:!1,"start-placeholder":"开始日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.timeChange},model:{value:e.dateVal,callback:function(t){e.dateVal=t},expression:"dateVal"}}),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:e.refrshData}},[e._v("刷新")])],1)]),e._v(" "),a("div",{staticClass:"execute-list-wapper"},[a("vBasetable",{attrs:{tableHead:e.tableHead,tableData:e.tableData}})],1),e._v(" "),a("div",{staticClass:"alarm-table-page"},[a("span",[e._v("共检索到告警数量为 "),a("b",[e._v(e._s(e.allCounts))]),e._v(" 个")]),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.size,total:e.allCounts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t},"update:current-page":function(t){e.c_page=t}}})],1),e._v(" "),a("el-dialog",{attrs:{title:"快照详情  "+e.dialogTitle,visible:e.snapshotDialog,width:"800px"},on:{"update:visible":function(t){e.snapshotDialog=t}}},[a("div",{staticClass:"snapshot-wapper"},[a("p",[a("span",{staticClass:"tit"},[e._v("告警名称 :")]),e._v(" "),a("span",{staticClass:"txt"},[e._v(e._s(e.dialogObj.alert_name))])]),e._v(" "),a("p",[a("span",{staticClass:"tit"},[e._v("数据源 :")]),e._v(" "),a("span",{staticClass:"txt"},[e._v(e._s(e.dialogObj.pre_index_name)+e._s(e.dialogObj.suffix_index_name))])]),e._v(" "),a("p",[a("span",{staticClass:"tit"},[e._v("条件 :")]),e._v(" "),a("span",{staticClass:"txt"},[e._v(e._s(e.setAlertCondition(e.dialogObj.alert_conditions)))])]),e._v(" "),a("p",[a("span",{staticClass:"tit"},[e._v("执行周期 :")]),e._v(" "),a("span",{staticClass:"txt"},[e._v(e._s(e.setAlertExcute(e.dialogObj)))])]),e._v(" "),a("p",[a("span",{staticClass:"tit"},[e._v("时间周期 :")]),e._v(" "),a("span",{staticClass:"txt"},[e._v(e._s(e.setAlertTime(e.dialogObj)))])]),e._v(" "),a("p",[a("span",{staticClass:"tit"},[e._v("详情 :")]),e._v(" "),a("span",{staticClass:"txt"},[a("jsonView",{staticClass:"jsonView",attrs:{data:e.dialogObj.result,theme:"one-dark","line-height":20,deep:5}})],1)])])])],1)},staticRenderFns:[]};var d=a("VU/8")(c,p,!1,function(e){a("pmEH")},"data-v-b3c824ac",null);t.default=d.exports},pmEH:function(e,t){}});