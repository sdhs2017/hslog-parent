webpackJsonp([43],{g89m:function(e,t){},"t8+U":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("ID1p"),n=i("62NR"),s=i("/sA3"),o=i("8+FI"),l={name:"equipment",data:function(){return{loading:!1,busName:"searchEquipment",busNames:{selectionName:"equipmentDelect"},importState:!1,backState:!1,page:1,c_page:1,size:15,logBaseJson:[],logType:[],typeArr:[],formConditionsArr:[],searchConditions:{name:"",hostname:"",ip:"",logType:""},saveCondition:"",tableHead:[],tableData:[],firstGetData:!0,allCounts:0,selectEquipmentId:"",delectEquipmentIds:""}},created:function(){var e=this;this.getLogType(),this.getEquipmentType(),this.formConditionsArr=[{label:"资产名称",paramName:"name",model:{model:""},itemType:"",type:"input"},{label:"IP地址",paramName:"ip",itemType:"",model:{model:""},type:"input"},{label:"主机名",paramName:"hostname",model:{model:""},itemType:"",type:"input"},{label:"日志类型",paramName:"logType",type:"select",itemType:"",model:{model:""},options:this.logType},{label:"资产类型",paramName:"type",type:"cascader",itemType:"",model:{model:[]},options:[]}],o.default.$on(this.busName,function(t){e.searchConditions=t,e.getEquipmentList(e.searchConditions,1),e.c_page=1}),o.default.$on(this.busNames.selectionName,function(t){for(var i in e.delectEquipmentIds="",t)e.delectEquipmentIds+=t[i].id+","})},beforeDestroy:function(){o.default.$off(this.busName)},mounted:function(){var e=this;this.tableHead=[{prop:"name",label:"资产名称",width:"200",formatData:function(e,t){var i=document.getElementById("dvCompute");return i.innerHTML=t.log_count+15,'<span title="'+e+'" style="display: inline-block;float:left;margin-right: 5px;max-width: calc(100% - '+i.offsetWidth+'px);overflow: hidden;text-overflow: ellipsis; ">'+e+'</span>\n                                <b title="今日日志数 " class="inNum" style="float:left;border: 1px solid #e4956d;color: #e4956d;padding: 0 5px;height: 18px;line-height: 18px;">'+t.log_count+"</b>"}},{prop:"hostName",label:"主机名",width:""},{prop:"type",label:"资产类型",width:"",formatData:function(t){var i="",a=t.substring(0,2);for(var n in e.typeArr){var s=e.typeArr[n];if(s.value==a){for(var o in i+=s.label+"-",s.children)if(s.children[o].value==t){i+=s.children[o].label;break}break}}return i}},{prop:"logTypeLabel",label:"日志类型",width:""},{prop:"ip",label:"IP地址",width:"125"},{prop:"domain",label:"根域名",width:""},{prop:"端口",label:"port",width:""},{prop:"startUp",label:"是否启用",width:"",formatData:function(e){return"1"==e?"是":"否"}},{prop:"createTime",label:"创建时间",width:"",formatData:function(e){return e.split(".")[0]}},{prop:"tools",label:"操作",width:"",btns:[{icon:"el-icon-edit",text:"修改资产",clickFun:function(t,i){e.reviseEquipment(t,i)}}]}]},methods:{refreshEq:function(){this.c_page=1,this.getEquipmentList(this.searchConditions,1)},importEquipment:function(){var e=this;layer.confirm("此功能适用于实施人员，请谨慎操作。",{btn:["确定导入","取消"]},function(t){layer.close(t),e.importState=!0},function(){layer.close()})},downLoadEq:function(){console.log("ddd");var e=document.getElementById("eqDownload");e.href=this.$baseUrl+"/equipment/equipmentDownload.do",e.click()},getLogType:function(){var e=this;this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/log/getLogTypeComboxByPage.do",e.$qs.stringify({pageType:"equipment"})).then(function(t){for(var i in e.logType.push({value:"",label:"全部"}),t.data.data)e.logType.push(t.data.data[i])}).catch(function(e){console.log(e)})})},getEquipmentType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/equiptype.json",{}).then(function(t){e.typeArr=t.data,e.formConditionsArr[e.formConditionsArr.length-1].options=e.typeArr}).catch(function(e){console.log(e)})})},getEquipmentList:function(e,t){var i=this;this.loading=!0;var a=e;a.pageIndex=t,a.pageSize=this.size,this.c_page=t,this.$nextTick(function(){i.$axios.post(i.$baseUrl+"/equipment/selectPage.do",i.$qs.stringify(a)).then(function(e){i.loading=!1,i.tableData=e.data[0].equipment,i.allCounts=JSON.parse(e.data[0].count.count),i.saveCondition=i.searchConditions}).catch(function(e){i.loading=!1,console.log(e)})})},selectEquipment:function(){var e=this;this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/equipment/selectEquipmentByLog.do",e.$qs.stringify({id:e.selectEquipmentId})).then(function(t){if(e.loading=!1,"false"===t.data.success)layer.msg(t.data.message,{icon:5});else{for(var i=t.data.equipment,a=0;a<i.length;a++){i[a].createTime&&(i[a].createTime=i[a].createTime.split(".")[0]),i[a].upDateTime&&(i[a].upDateTime=i[a].upDateTime.split(".")[0]),i[a].endTime&&(i[a].endTime=i[a].endTime.split(".")[0]),"1"==i[a].startUp?i[a].startUp="是":i[a].startUp="否";var n="",s=i[a].type.substring(0,2);for(var o in e.typeArr){var l=e.typeArr[o];if(l.value==s){for(var r in n+=l.label+"-",l.children)if(l.children[r].value==i[a].type){n+=l.children[r].label;break}break}}i[a].type=n}e.tableData=i}}).catch(function(t){e.loading=!1,console.log(t)})})},handleCurrentChange:function(e){this.getEquipmentList(this.saveCondition,e),this.firstGetData=!1},goToAddEquipment:function(){this.$router.push({path:"addEquipment"})},goToAllEcharts:function(){this.$router.push({path:"allEcharts"})},removeEquipment:function(){var e=this;""==this.delectEquipmentIds?layer.msg("未选中任何资产",{icon:5}):layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){layer.close(t),e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/equipment/delete.do",e.$qs.stringify({id:e.delectEquipmentIds})).then(function(t){"true"==t.data.success?(layer.msg("删除成功",{icon:1}),e.getEquipmentList(e.searchConditions,1),e.c_page=1,e.delectEquipmentIds=""):layer.msg("删除失败",{icon:5})}).catch(function(e){layer.msg("删除失败",{icon:5})})})},function(){layer.close()})},reviseEquipment:function(e,t){Object(s.l)("reviseEquipment"+e.id,"equipment/reviseEquipment.vue",{name:e.name,id:e.id},"资产修改")},equipmentLogs:function(e,t){Object(s.l)("equipmentLogs2"+e.id,"logsManage/equipmentLogs2.vue",{name:e.name,id:e.id,logType:e.logType},"日志")},equipmentEcharts:function(e,t){var i=e.logType;"syslog"===i?Object(s.l)("syslogEquipmentEcharts"+e.id,"equipment/syslogEquipmentEcharts.vue",{name:e.name,id:e.id},"统计"):"winlog"===i||"winlogbeat"===i?Object(s.l)("winEquipmentEcharts"+e.id,"equipment/winEquipmentEcharts.vue",{name:e.name,id:e.id},"统计"):"metric"===i?Object(s.l)("equipmentDashboard"+e.id,"dashboard/dashboard.vue",{name:e.name+"指标数据统计",eid:e.id,id:"y_qMB3IBmkPMjFRE7O-_",type:"EQedit"},"查看"):layer.msg(i+" 类型资产暂无报表",{icon:5})},equipmentDashboard:function(e,t){Object(s.l)("equipmentDashboard"+e.id,"dashboard/dashboard.vue",{name:e.name+"指标数据统计",eid:e.id,id:"y_qMB3IBmkPMjFRE7O-_",type:"EQedit"},"修改")},equipmentEvents:function(e,t){Object(s.l)("equipmentEvents2"+e.id,"eventManage/equipmentEvents2.vue",{name:e.name,id:e.id},"事件")},setSafe:function(e,t){Object(s.l)("equipmentSafe"+e.id,"equipment/equipmentSafe.vue",{name:e.name,id:e.id,logType:e.logType},"安全策略")},theartAnalyse:function(e,t){Object(s.l)("equipmentThreat"+e.id,"equipment/equipmentThreat.vue",{name:e.name,id:e.id,logType:e.logType},"威胁分析")}},watch:{importState:function(){var e=this;!0===this.importState&&setTimeout(function(){var t=e;$("#ssi-upload").ssi_uploader({url:e.$baseUrl+"/equipment/insertEquipmentUpload.do",maxNumberOfFiles:1,allowed:["xlsx","xls","xlsm"],ajaxOptions:{success:function(e){var i=JSON.parse(e);t.backState=!0,t.backStateObj={state:i.success,text:i.message}},error:function(e){layer.msg("导入失败",{icon:5}),$(".ssi-abortUpload").click()}}})},100)}},beforeRouteEnter:function(e,t,i){i(function(t){void 0!==e.params.equipmentid?(t.selectEquipmentId=e.params.equipmentid,t.selectEquipment(),t.c_page=1):""!==t.selectEquipmentId?(t.selectEquipment(),t.c_page=1):t.getEquipmentList(t.searchConditions,t.c_page)})},components:{vSearchForm:a.default,vBasetable:n.default}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content-bg"},[i("div",{staticStyle:{position:"absolute",visibility:"hidden"},attrs:{id:"dvCompute"}}),e._v(" "),i("div",{staticClass:"top-title"},[e._v("资产列表\n        "),i("div",{staticClass:"equipment-tools"},[i("div",{staticClass:"equipemnt-tools-btns"},[i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:e.goToAddEquipment}},[e._v("添加资产")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:e.removeEquipment}},[e._v("删除资产")]),e._v(" "),i("el-button",{attrs:{type:"success",size:"mini",plain:""},on:{click:e.refreshEq}},[e._v("刷新")])],1)])]),e._v(" "),i("div",{staticClass:"equipemnt-tools-form"},[i("v-search-form",{attrs:{formItem:e.formConditionsArr,busName:e.busName}})],1),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"equipment-table-wapper",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[i("v-basetable",{attrs:{selection:!0,tableHead:e.tableHead,tableData:e.tableData,busName:e.busNames}})],1),e._v(" "),i("div",{staticClass:"equipment-table-page"},[i("span",[e._v("共检索到资产数量为 "),i("b",[e._v(e._s(e.allCounts))]),e._v(" 台")]),e._v(" "),i("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.size,total:e.allCounts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t},"update:current-page":function(t){e.c_page=t}}})],1),e._v(" "),i("el-dialog",{staticClass:"dialog-wapper",attrs:{title:"资产导入",visible:e.importState,width:"680px",height:"550px"},on:{"update:visible":function(t){e.importState=t}}},[e.backState?i("div",{staticClass:"back-state"},[i("p",{staticClass:"i-box"},["true"==this.backStateObj.state?i("i",{staticClass:"el-icon-success",staticStyle:{color:"#279e72"}}):i("i",{staticClass:"el-icon-error",staticStyle:{color:"#e27145"}})]),e._v(" "),"true"==this.backStateObj.state?i("h3",{staticClass:"back-h3",staticStyle:{color:"#279e72"}},[e._v("导入成功")]):i("h3",{staticClass:"back-h3",staticStyle:{color:"#e27145"}},[e._v("导入失败")]),e._v(" "),i("p",{staticClass:"back-text"},[e._v(e._s(this.backStateObj.text))]),e._v(" "),i("p",{staticClass:"back-btn"},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.backState=!1}}},[e._v("返回导入界面")])],1)]):e._e(),e._v(" "),i("p",[e._v("通过浏览本地文件或将文件拖到下面指定区域，上传资产文件。")]),e._v(" "),i("p",[e._v("文件支持的类型："),i("span",{staticClass:"txtColor"},[e._v(".xlsx")]),e._v(" "),i("span",{staticClass:"txtColor"},[e._v(".xls")]),e._v(" "),i("span",{staticClass:"txtColor"},[e._v(".xlsm")])]),e._v(" "),i("p",[e._v("文件的名称必须为："),i("span",{staticClass:"txtColor"},[e._v("资产清单")]),e._v("  (例:资产清单.xlsx)")]),e._v(" "),i("div",{staticStyle:{"padding-right":"30px"}},[i("input",{attrs:{type:"file",multiple:"",id:"ssi-upload"}})]),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.importState=!1}}},[e._v("取 消")])],1)])],1)},staticRenderFns:[]};var p=i("VU/8")(l,r,!1,function(e){i("g89m")},"data-v-8d3d65d2",null);t.default=p.exports}});