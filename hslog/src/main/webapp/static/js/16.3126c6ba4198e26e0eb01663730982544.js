webpackJsonp([16],{"3km7":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),r={name:"dynamicTable",data:function(){return{chartId:"",operType:""}},created:function(){"{}"!==s()(this.$route.query)&&"edit"===this.$route.query.type?(this.$options.name="editDynamicTable"+this.$route.query.id,this.operType="edit",""!==this.chartId&&this.chartId===this.$route.query.id||(this.chartId=this.$route.query.id)):"see"===this.$route.query.type&&(this.$options.name="seeDynamicTable"+this.$route.query.id,this.operType="see",""!==this.chartId&&this.chartId===this.$route.query.id||(this.chartId=this.$route.query.id))},beforeRouteEnter:function(t,e,a){a(function(e){if("{}"!==s()(t.query)&&"edit"===t.query.type){var a={path:"editDynamicTable"+t.query.id,component:"dashboard/dynamicTable.vue",title:"修改"};sessionStorage.setItem("/editDynamicTable"+t.query.id,s()(a))}else if("see"===t.query.type){var i={path:"seeDynamicTable"+t.query.id,component:"dashboard/dynamicTable.vue",title:"查看"};sessionStorage.setItem("/seeDynamicTable"+t.query.id,s()(i))}})},components:{tableBaseConfig:a("gvjR").default}},n={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content-bg"},[e("tableBaseConfig",{attrs:{chartType:"table",chartId:this.chartId,operType:this.operType}})],1)},staticRenderFns:[]};var o=a("VU/8")(r,n,!1,function(t){a("jOC5")},"data-v-032592ce",null);e.default=o.exports},"9BdW":function(t,e){},gvjR:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),r=a("cUU5"),n=a("/sA3"),o=a("8+FI"),l=a("ck3A"),c=a.n(l),h=a("K3LF"),u=a("PNLW"),d=a("37ip"),m=a("IO/x"),p=a("62NR"),f={name:"tableBaseConfig",props:{operType:{type:String,defaultVal:function(){return"edit"}},chartType:{type:String},chartId:{type:String}},data:function(){return{emptyText:"",refresh:0,allLoading:!1,leftLoading:!1,loading:!1,customIndexVal:"",defaultVal:{lastVal:"15-min",starttime:"",endtime:"",dateBlock:!1,isIntervalBox:!0,intervalState:!1,intervalVal:"",intervalType:"",dateUnit:"min",dateCount:"15",commonlyVal:"",changeState:!0},dialogFormVisible:!1,chartParams:{chartName:"",chartDes:"",searchParam:"",otherSave:!1},opt:{},dateObj:{starttime:"",endtime:"",last:"15-min"},intervalObj:{state:!1,interval:"5000"},interval:"",sourceData:"",emptyTipState:!0,defaultConfig:"",busName:"createESTable",busIndexName:"ESTableIndexName",busCustomIndexName:"customIndexBusName",busTableDetailName:"busTableDetailName",busFilterName:"",busQueryName:"",indexVal:[],configOpened:["1","2","3","4","5","6","7","8","9"],yUnit:"",addValues:"",searchTime:[],chartsConfig:{dataSourceType:"ElasticSearch",dataSourceTypeWay:"template",custom_index_name:"",mysqlData:"",templateName:"",preIndexName:"",suffixIndexName:"",datefield:"",title:{text:""},columnArr:[{field:"",sort:"",aliasName:"",show:!0,isSearch:!1,searchVal:""}],conditionArr:[],trueCount:0,counts:100,page:{cPage:1,size:10,allCounts:0},tableHead:[],columnOpt:[],operatorOpt:[],tableData:[]},sortObj:{},mysqlDataOpt:[],activeName:"first",chartsConfigArr:[],filters:"",defaultFilter:[],updateBtn:!1,queryVal:"",oldQuery:"",defaultQuery:"",wapperHeight:1,tableHeight:1,pageSize:10,showCount:100,dialogState:!1,tableDetailObj:{columnHead:[],rowData:{}}}},created:function(){var t=this;this.defaultConfig=s()(this.chartsConfig),"edit"===this.operType?(this.htmlTitle="编辑 "+this.$route.query.name,this.busName=this.chartType+"resiveChartSimple"+this.$route.query.id,this.busIndexName=this.chartType+"IndexNameSimple"+this.$route.query.id,this.busCustomIndexName=this.chartType+"customIndexBusName"+this.$route.query.id,this.busTableDetailName=this.chartType+"busTableDetailName"+this.$route.query.id,this.busFilterName=this.chartType+"FilterNameSimple"+this.$route.query.id,this.busQueryName=this.chartType+"QueryNameSimple"+this.$route.query.id,""!==this.chartId&&this.chartId===this.$route.query.id||(this.chartId=this.$route.query.id)):"see"===this.operType?(this.htmlTitle="查看 "+this.$route.query.name,this.busName="seeChartSimple"+this.$route.query.id,this.busIndexName="seeIndexNameSimple"+this.$route.query.id,this.busCustomIndexName="seeCustomIndexNameSimple"+this.$route.query.id,this.busTableDetailName="seeTableDetailName"+this.$route.query.id,this.busFilterName="seeFliterNameSimple"+this.$route.query.id,this.busQueryName="seeQueryNameSimple"+this.$route.query.id,""!==this.chartId&&this.chartId===this.$route.query.id||(this.chartId=this.$route.query.id)):(this.busName=this.chartType+"addChartSimple",this.busIndexName=this.chartType+"addIndexNameSimple",this.busCustomIndexName=this.chartType+"addCustomIndexNameSimple",this.busTableDetailName=this.chartType+"addTableDetailName",this.busFilterName=this.chartType+"addFliterNameSimple",this.busQueryName=this.chartType+"addQueryNameSimple"),o.default.$on(this.busName,function(e){var a=Object(n.n)(e);t.dateObj=a[0],t.intervalObj=a[1]}),o.default.$on(this.busIndexName,function(e){t.initialize(),t.chartsConfig.suffixIndexName=e[2],t.chartsConfig.preIndexName=e[1],t.chartsConfig.templateName=e[0],t.chartsConfig.datefield=e[3],t.getColumnField()}),o.default.$on(this.busCustomIndexName,function(e){t.initialize(),t.chartsConfig.dataSourceTypeWay="index",t.chartsConfig.custom_index_name=e,t.getCustomIndex(e)}),o.default.$on(this.busTableDetailName,function(e){t.dialogState=!1}),o.default.$on(this.busFilterName,function(e){t.filters=e,"disabled"!==t.isCanCreate&&(t.loading=!0,t.chartsConfig.page.cPage=1,t.getData())}),o.default.$on(this.busQueryName,function(e){t.isUpdate(e)}),this.setHeight()},mounted:function(){var t=this;window.onresize=function(){t.setHeight()}},beforeDestroy:function(){o.default.$off(this.busName),o.default.$off(this.busIndexName),o.default.$off(this.busFilterName),o.default.$off(this.busQueryName),clearInterval(this.interval)},computed:{isCanCreate:function(){var t=!1,e=!1,a=!1;return this.chartsConfig.columnArr.forEach(function(e){""===e.field&&(t="disabled")}),"MySQL"===this.chartsConfig.dataSourceType&&this.chartsConfig.conditionArr.forEach(function(t){""===t.field&&(a="disabled"),"in"===t.operator||"not in"===t.operator?0===t.values.length&&(a="disabled"):"between"===t.operator||""===t.value&&(a="disabled")}),(Number(this.chartsConfig.page.size)<=0||Number(this.chartsConfig.counts)<=0)&&(e="disabled"),(!1!==t||!1!==e||!1!==a)&&(this.oldQuery=this.queryVal,this.updateBtn=!1,"disabled")}},methods:{searchData:function(){this.loading=!0,this.chartsConfig.page.cPage=1,this.getData()},setHeight:function(){var t=document.body.clientHeight;"MySQL"===this.chartsConfig.dataSourceType?(this.wapperHeight=parseInt(t)-240+"px",this.tableHeight=parseInt(t)-340):(this.wapperHeight=parseInt(t)-304+"px",this.tableHeight=parseInt(t)-400)},dataSourceChange:function(){var t=this.chartsConfig.dataSourceType;this.initialize(),this.chartsConfig.dataSourceType=t,"MySQL"===t&&this.getTableName(),this.setHeight()},dataSourceWayChange:function(){var t=this.chartsConfig.dataSourceTypeWay;this.initialize(),this.customIndexVal="",this.chartsConfig.dataSourceTypeWay=t,this.chartsConfig.custom_index_name=""},mySQLTableChange:function(){var t=this.chartsConfig.mysqlData;this.initialize(),this.chartsConfig.dataSourceType="MySQL",this.chartsConfig.mysqlData=t,this.getMySQLField(),this.getMySQLOperator()},columnChange:function(t,e){if("MySQL"===this.chartsConfig.dataSourceType){var a=this.chartsConfig.columnOpt.find(function(e){return e.value===t});this.chartsConfig.columnArr[e].aliasName=a.label}else this.sortObj[t]||(this.chartsConfig.columnArr[e].sort="")},conditionFieldChange:function(t,e){this.chartsConfig.conditionArr[e].operator="",this.chartsConfig.conditionArr[e].value="",this.chartsConfig.conditionArr[e].start="",this.chartsConfig.conditionArr[e].end="",this.chartsConfig.conditionArr[e].values=[]},conditionOperatorChange:function(t,e){this.chartsConfig.conditionArr[e].value="",this.chartsConfig.conditionArr[e].start="",this.chartsConfig.conditionArr[e].end="",this.chartsConfig.conditionArr[e].values=[]},addValue:function(t){this.chartsConfig.conditionArr[t].values.push(this.addValues),this.addValues=""},refreshChart:function(){this.refresh++},updateChart:function(){this.oldQuery=this.queryVal,this.refresh++,this.updateBtn=!1},isUpdate:function(t){this.queryVal=t,"disabled"!==this.isCanCreate?t!==this.oldQuery?(this.updateBtn=!0,0===$(".layui-layer-tips").length&&layer.tips("点击更新",".update-btn",{tips:[3,"#3595CC"],time:2e3})):this.updateBtn=!1:this.oldQuery=this.queryVal},initialize:function(){this.chartsConfig=JSON.parse(this.defaultConfig),this.emptyTipState=!0,this.opt={},this.chartParams.searchParam="",this.defaultFilter=[]},addColumn:function(){this.chartsConfig.columnArr.push({field:"",sort:"desc",aliasName:"",show:!0,isSearch:!1,searchVal:""})},addCondition:function(){this.chartsConfig.conditionArr.push({field:"",operator:"",value:"",start:"",end:"",values:[]})},createBtn:function(){this.loading=!0,this.chartsConfig.page.cPage=1,this.getData()},getTableName:function(){var t=this;this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/BI/showTables.do",t.$qs.stringify()).then(function(e){var a=e.data;"true"===a.success?t.mysqlDataOpt=a.data:layer.msg(a.message,{icon:5})}).catch(function(t){console.log(t)})})},getMySQLField:function(){var t=this;this.$nextTick(function(){t.leftLoading=!0,t.$axios.post(t.$baseUrl+"/BI/showColumns.do",t.$qs.stringify({tableName:t.chartsConfig.mysqlData})).then(function(e){t.leftLoading=!1;var a=e.data;"true"===a.success?t.chartsConfig.columnOpt=a.data:layer.msg(a.message,{icon:5})}).catch(function(e){t.leftLoading=!1})})},getMySQLOperator:function(){var t=this;this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/BI/getSqlOperators.do",t.$qs.stringify()).then(function(e){var a=e.data;"true"===a.success?(t.chartsConfig.operatorOpt=[],a.data.forEach(function(e){t.chartsConfig.operatorOpt.push({label:e,value:e})})):layer.msg(a.message,{icon:5})}).catch(function(t){console.log(t)})})},getCustomIndex:function(t){var e=this;this.$nextTick(function(){e.leftLoading=!0,e.$axios.post(e.$baseUrl+"/BI/getFieldsByCustomIndex.do",e.$qs.stringify({custom_index_name:t})).then(function(t){e.leftLoading=!1,e.chartsConfig.columnOpt=[],e.sortObj={},t.data.forEach(function(t){var a={value:t.fieldName,label:t.fieldName};e.chartsConfig.columnOpt.push(a),e.sortObj[t.fieldName]=t.sortable})}).catch(function(t){e.leftLoading=!1})})},getColumnField:function(){var t=this;if(""===this.chartsConfig.preIndexName||""===this.chartsConfig.preIndexName||""===this.chartsConfig.preIndexName)return!1;this.$nextTick(function(){t.leftLoading=!0,t.$axios.post(t.$baseUrl+"/BI/getFieldByDynamicTable.do",t.$qs.stringify({pre_index_name:t.chartsConfig.preIndexName,suffix_index_name:t.chartsConfig.suffixIndexName,template_name:t.chartsConfig.templateName})).then(function(e){t.leftLoading=!1,t.chartsConfig.columnOpt=[],t.sortObj={},e.data.forEach(function(e){var a={value:e.fieldName,label:e.fieldName};t.chartsConfig.columnOpt.push(a),t.sortObj[e.fieldName]=e.sortable})}).catch(function(e){t.leftLoading=!1})})},getData:function(t){var e=this,a=[];this.chartsConfig.columnArr.forEach(function(t){t.isSearch&&a.push({field:t.field,value:t.searchVal,fieldType:"text",operator:"is term",enable:!0})}),this.searchTime?a.push({field:"@timestamp",fieldType:"date",operator:"is between",start:this.searchTime[0],end:this.searchTime[1],enable:!0}):a.push({field:"@timestamp",fieldType:"date",operator:"is between",start:"",end:"",enable:!0});var i="";i="ElasticSearch"===this.chartsConfig.dataSourceType?"/BI/getDataByParams_dynamicTable.do":"/BI/getDataBySql.do";var r={};if(t)(r=JSON.parse(this.chartParams.searchParam)).page=this.chartsConfig.page.cPage;else if("ElasticSearch"===this.chartsConfig.dataSourceType)r={starttime:this.dateObj.starttime,endtime:this.dateObj.endtime,last:this.dateObj.last,unit:this.yUnit,source_type:this.chartsConfig.dataSourceTypeWay,index_name:this.chartsConfig.custom_index_name,pre_index_name:this.chartsConfig.preIndexName,suffix_index_name:this.chartsConfig.suffixIndexName,template_name:this.chartsConfig.templateName,queryBox:this.queryVal,page:this.chartsConfig.page.cPage,page_size:this.chartsConfig.page.size,size:this.chartsConfig.counts,filters_visual:this.filters,es_columns:s()(this.chartsConfig.columnArr)};else{var n=[];this.chartsConfig.columnArr.forEach(function(t){n.push({column_value:t.field,sort:t.sort})}),r={tableName:this.chartsConfig.mysqlData,page:this.chartsConfig.page.cPage,page_size:this.chartsConfig.page.size,columns:s()(n),wheres:s()(this.chartsConfig.conditionArr)}}r.visual_search=s()(a),this.chartsConfig.tableHead=[],this.chartsConfig.tableData=[],this.emptyText="加载中",this.chartsConfig.columnArr.forEach(function(t){t.show&&e.chartsConfig.tableHead.push({prop:t.field,label:""===t.aliasName?t.field:t.aliasName,width:""})}),this.chartsConfig.tableHead.push({prop:"tools",label:"操作",width:"100",btns:[{icon:"el-icon-tickets",text:"查看详情",clickFun:function(t,a){var i=[];e.chartsConfig.columnArr.forEach(function(t){i.push({prop:t.field,label:""===t.aliasName?t.field:t.aliasName})}),e.dialogState=!0,e.tableDetailObj={columnHead:i,rowData:t}}}]}),this.$nextTick(function(){e.$axios.post(e.$baseUrl+i,e.$qs.stringify(r)).then(function(t){e.loading=!1,e.chartParams.searchParam=s()(r);var a=t.data;"true"===a.success?(e.chartsConfig.page.allCounts=0,e.chartsConfig.trueCount=0,e.pageSize=Number(e.chartsConfig.page.size),e.showCount=e.chartsConfig.counts,e.chartsConfig.trueCount=a.data[0].count,"MySQL"===e.chartsConfig.dataSourceType?(e.chartsConfig.page.allCounts=Number(a.data[0].count),e.showCount=Number(a.data[0].count)):e.chartsConfig.trueCount>=e.chartsConfig.counts?e.chartsConfig.page.allCounts=Number(e.chartsConfig.counts):e.chartsConfig.page.allCounts=Number(e.chartsConfig.trueCount),setTimeout(function(){var t=e.tableHeight-40;$(".el-table__body-wrapper").height(t+"px"),e.chartsConfig.tableData=a.data[0].list,0===e.chartsConfig.tableData.length&&(e.emptyText="暂无数据")},300)):(e.emptyText=a.message,layer.msg(a.message,{icon:5}))}).catch(function(t){e.emptyText="获取数据出错",e.loading=!1})})},handleCurrentChange:function(t){this.loading=!0,this.chartsConfig.page.cPage=t,this.getData(t)},saveChart:function(){var t=this,e=JSON.parse(s()(this.chartsConfig));e.columnArr.forEach(function(t){t.searchVal=""}),e.columnOpt=[],e.tableData=[];var a={config:e},i={source_type:this.chartsConfig.dataSourceTypeWay,title:this.chartParams.chartName,description:this.chartParams.chartDes,filters_visual:this.filters,index_name:this.chartsConfig.custom_index_name,type:this.chartType,pre_index_name:this.chartsConfig.preIndexName,suffix_index_name:this.chartsConfig.suffixIndexName,template_name:this.chartsConfig.templateName,option:s()(a),params:this.chartParams.searchParam,isSaveAs:!0};""!==this.chartId&&(this.chartParams.otherSave||(i.id=this.chartId,i.isSaveAs=!1)),this.$nextTick(function(){t.allLoading=!0,t.$axios.post(t.$baseUrl+"/BI/saveVisualization.do",t.$qs.stringify(i)).then(function(e){t.allLoading=!1,"true"==e.data.success?(t.dialogFormVisible=!1,layer.msg(e.data.message,{icon:1})):layer.msg(e.data.message,{icon:5})}).catch(function(e){t.allLoading=!1,layer.msg("保存失败",{icon:5})})})},removeYaxisTab:function(t,e){this.chartsConfig.columnArr.length>1&&(this.chartsConfig.columnArr.splice(t,1),e.stopPropagation())}},watch:{chartId:{handler:function(t){var e=this;""!==t&&this.$nextTick(function(){e.allLoading=!0,e.$axios.post(e.$baseUrl+"/BI/getVisualizationById.do",e.$qs.stringify({id:e.chartId})).then(function(t){e.allLoading=!1;var a=t.data;if("true"==a.success){JSON.parse(a.data.params).filters_visual&&(e.filters=JSON.parse(a.data.params).filters_visual,e.defaultFilter=JSON.parse(JSON.parse(a.data.params).filters_visual));var i=JSON.parse(a.data.option);e.indexVal=[a.data.template_name,a.data.pre_index_name,a.data.suffix_index_name,e.chartsConfig.datefield],e.chartsConfig=i.config,e.customIndexVal=e.chartsConfig.custom_index_name,e.chartsConfig.dataSourceTypeWay=a.data.source_type,e.chartParams.chartName=a.data.title,e.chartParams.chartDes=a.data.description,e.chartParams.searchParam=a.data.params,e.chartsConfig.page.cPage=1,e.getData(),"MySQL"===e.chartsConfig.dataSourceType?(e.getTableName(),e.getMySQLField(),e.getMySQLOperator()):"template"===e.chartsConfig.dataSourceTypeWay?e.getColumnField():e.getCustomIndex(e.chartsConfig.custom_index_name),e.setHeight()}else layer.msg(t.data.message,{icon:5})}).catch(function(t){e.allLoading=!1})})},immediate:!0,deep:!0},dateObj:function(t,e){"disabled"!==this.isCanCreate&&(this.loading=!0,this.chartsConfig.page.cPage=1,this.getData())},intervalObj:function(){var t=this;this.intervalObj.state?(clearInterval(this.interval),this.interval=setInterval(function(){"disabled"!==t.isCanCreate&&t.getData()},this.intervalObj.interval)):clearInterval(this.interval)}},components:{dateLayout:r.default,chooseIndex:u.default,customIndex:d.default,jsonView:c.a,queryFilter:h.default,tableDetail:m.default,vBasetable:p.default}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.allLoading,expression:"allLoading"}],attrs:{"element-loading-background":"rgba(26,36,47, 0.2)"}},[a("div",{staticClass:"top-title",staticStyle:{"padding-left":"10px"}},["see"===t.operType?a("div",{staticClass:"top-zz"}):t._e(),t._v(" "),a("div",{staticStyle:{float:"left",display:"flex","margin-right":"15px"}},[a("span",{staticStyle:{width:"42px",color:"#409eff","text-shadow":"none"}},[t._v("类型:")]),t._v(" "),a("el-select",{staticStyle:{width:"90px"},attrs:{placeholder:"",size:"mini"},on:{change:t.dataSourceChange},model:{value:t.chartsConfig.dataSourceType,callback:function(e){t.$set(t.chartsConfig,"dataSourceType",e)},expression:"chartsConfig.dataSourceType"}},[a("el-option",{attrs:{label:"ElasticSearch",value:"ElasticSearch"}}),t._v(" "),a("el-option",{attrs:{label:"MySQL",value:"MySQL"}})],1),t._v(" "),"ElasticSearch"===t.chartsConfig.dataSourceType?a("el-select",{staticStyle:{width:"111px"},attrs:{placeholder:"",size:"mini"},on:{change:t.dataSourceWayChange},model:{value:t.chartsConfig.dataSourceTypeWay,callback:function(e){t.$set(t.chartsConfig,"dataSourceTypeWay",e)},expression:"chartsConfig.dataSourceTypeWay"}},[a("el-option",{attrs:{label:"模板",value:"template"}}),t._v(" "),a("el-option",{attrs:{label:"自定义索引",value:"index"}})],1):t._e()],1),t._v(" "),"ElasticSearch"===t.chartsConfig.dataSourceType?a("div",{staticClass:"choose-wapper"},["template"===t.chartsConfig.dataSourceTypeWay?a("choose-index",{attrs:{busName:this.busIndexName,arr:t.indexVal}}):t._e(),t._v(" "),"index"===t.chartsConfig.dataSourceTypeWay?a("div",{staticClass:"choose-wapper"},[a("customIndex",{attrs:{busName:this.busCustomIndexName,defaultVal:t.customIndexVal}})],1):t._e()],1):a("div",{staticClass:"choose-wapper"},[a("span",{staticStyle:{width:"60px",color:"#409eff","text-shadow":"none"}},[t._v("数据源:")]),t._v(" "),a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"",size:"mini"},on:{change:t.mySQLTableChange},model:{value:t.chartsConfig.mysqlData,callback:function(e){t.$set(t.chartsConfig,"mysqlData",e)},expression:"chartsConfig.mysqlData"}},t._l(t.mysqlDataOpt,function(t){return a("el-option",{key:"mysql"+t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-button",{staticClass:"saveChart",attrs:{type:"success",plain:"",size:"mini"},on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("保存")]),t._v(" "),"ElasticSearch"===t.chartsConfig.dataSourceType?a("div",{staticStyle:{float:"right"}},[t.updateBtn&&"disabled"!==t.isCanCreate?a("el-button",{staticClass:"update-btn",staticStyle:{float:"right","margin-right":"5px","margin-top":"10px",position:"relative","z-index":"101"},attrs:{type:"success",size:"mini"},on:{click:t.updateChart}},[t._v("更新")]):a("el-button",{staticStyle:{float:"right","margin-right":"5px","margin-top":"10px",position:"relative","z-index":"101"},attrs:{type:"primary",size:"mini",plain:""},on:{click:t.refreshChart}},[t._v("刷新")])],1):t._e(),t._v(" "),"ElasticSearch"===t.chartsConfig.dataSourceType?a("div",{staticClass:"date-wapper"},[a("date-layout",{attrs:{busName:t.busName,defaultVal:t.defaultVal,refresh:t.refresh}})],1):t._e()],1),t._v(" "),a("div",{staticClass:"filter-box"},["ElasticSearch"===t.chartsConfig.dataSourceType?a("queryFilter",{attrs:{busFilterName:this.busFilterName,busQueryName:this.busQueryName,defaultFilterArr:this.defaultFilter,queryVal:this.defaultQuery,useType:this.operType,useObject:this.chartsConfig.dataSourceTypeWay,tableTypeVal:this.customIndexVal,templateName:this.chartsConfig.templateName,preIndexName:this.chartsConfig.preIndexName,suffixIndexName:this.chartsConfig.suffixIndexName}}):t._e()],1),t._v(" "),a("div",{staticClass:"chart-wapper"},[a("div",{staticClass:"config-wapper",style:{height:t.wapperHeight}},[a("el-button",{staticClass:"creatBtn",attrs:{type:"primary",disabled:t.isCanCreate||"see"===t.operType},on:{click:t.createBtn}},[t._v("生成")]),t._v(" "),a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.leftLoading,expression:"leftLoading"}],staticStyle:{height:"100%"},attrs:{type:"border-card","element-loading-background":"rgba(26,36,47, 0.2)"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"数据",name:"first"}},[a("el-collapse",[t._l(t.chartsConfig.columnArr,function(e,i){return a("el-collapse-item",{key:i,staticClass:"tablist"},[a("template",{staticClass:"collapseTit",slot:"title"},[a("span",{staticStyle:{overflow:"hidden","word-break":"break-all",width:"200px",height:"36px","line-height":"36px"}},[t._v("列 "+t._s(""===e.aliasName?e.field:e.aliasName))]),"see"!==t.operType?a("i",{staticClass:"header-icon el-icon-error removeTab",on:{click:function(e){return t.removeYaxisTab(i,e)}}}):t._e()]),t._v(" "),a("el-form",{staticStyle:{position:"relative"},attrs:{"label-position":"top"}},["see"===t.operType?a("div",{staticClass:"from-zz"}):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"列参数"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:"",size:"mini"},on:{change:function(e){return t.columnChange(e,i)}},model:{value:e.field,callback:function(a){t.$set(e,"field",a)},expression:"columnItem.field"}},t._l(t.chartsConfig.columnOpt,function(t){return a("el-option",{key:"column"+t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),t.sortObj[e.field]||"MySQL"===t.chartsConfig.dataSourceType?a("el-form-item",{attrs:{label:"排序方式"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.sort,callback:function(a){t.$set(e,"sort",a)},expression:"columnItem.sort"}},[a("el-option",{attrs:{label:"无",value:""}}),t._v(" "),a("el-option",{attrs:{label:"降序",value:"desc"}}),t._v(" "),a("el-option",{attrs:{label:"升序",value:"asc"}})],1)],1):t._e(),t._v(" "),"ElasticSearch"===t.chartsConfig.dataSourceType?a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.aliasName,callback:function(a){t.$set(e,"aliasName",a)},expression:"columnItem.aliasName"}})],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"是否显示"}},[a("el-switch",{model:{value:e.show,callback:function(a){t.$set(e,"show",a)},expression:"columnItem.show"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"是否作为查询条件"}},[a("el-switch",{model:{value:e.isSearch,callback:function(a){t.$set(e,"isSearch",a)},expression:"columnItem.isSearch"}})],1)],1)],2)}),t._v(" "),"see"!==t.operType?a("p",{staticStyle:{"text-align":"center","font-size":"12px","margin-bottom":"10px"}},[a("span",{staticClass:"addY",on:{click:t.addColumn}},[a("i",{staticClass:"el-icon-circle-plus"}),t._v("添加列")])]):t._e(),t._v(" "),t._l(t.chartsConfig.conditionArr,function(e,i){return"MySQL"===t.chartsConfig.dataSourceType?a("el-collapse-item",{key:"conditionItem"+i,staticClass:"tablist"},[a("template",{staticClass:"collapseTit",slot:"title"},[a("span",{staticStyle:{overflow:"hidden","word-break":"break-all",width:"200px",height:"36px","line-height":"36px"}},[t._v("条件 "+t._s(i+1))]),"see"!==t.operType?a("i",{staticClass:"header-icon el-icon-error removeTab",on:{click:function(e){return t.chartsConfig.conditionArr.splice(i,1)}}}):t._e()]),t._v(" "),a("el-form",{staticStyle:{position:"relative"},attrs:{"label-position":"top"}},["see"===t.operType?a("div",{staticClass:"from-zz"}):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"列参数"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:"",size:"mini"},on:{change:function(e){return t.conditionFieldChange(e,i)}},model:{value:e.field,callback:function(a){t.$set(e,"field",a)},expression:"conditionItem.field"}},t._l(t.chartsConfig.columnOpt,function(t){return a("el-option",{key:"condition"+i+t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"运算符"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:"",size:"mini"},on:{change:function(e){return t.conditionOperatorChange(e,i)}},model:{value:e.operator,callback:function(a){t.$set(e,"operator",a)},expression:"conditionItem.operator"}},t._l(t.chartsConfig.operatorOpt,function(t){return a("el-option",{key:"operator"+i+t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),"between"===e.operator?a("el-form-item",{attrs:{label:"值"}},[a("div",{staticStyle:{display:"flex"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.start,callback:function(a){t.$set(e,"start",a)},expression:"conditionItem.start"}}),t._v("\n                                            -\n                                            "),a("el-input",{attrs:{size:"mini"},model:{value:e.end,callback:function(a){t.$set(e,"end",a)},expression:"conditionItem.end"}})],1)]):"in"===e.operator||"not in"===e.operator?a("el-form-item",{attrs:{label:"值"}},[a("p",{staticClass:"values-wapper"},t._l(e.values,function(i,s){return a("span",{key:s},[t._v(t._s(i)),a("i",{staticClass:"el-icon-close",attrs:{title:"删除"},on:{click:function(t){return e.values.splice(s,1)}}})])}),0),t._v(" "),a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.addValues,callback:function(e){t.addValues=e},expression:"addValues"}}),t._v(" "),a("el-button",{staticStyle:{background:"0",height:"28px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addValue(i)}}},[t._v("添加")])],1)]):a("el-form-item",{attrs:{label:"值"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"conditionItem.value"}})],1)],1)],2):t._e()}),t._v(" "),"see"!==t.operType&&"ElasticSearch"!==t.chartsConfig.dataSourceType?a("p",{staticStyle:{"text-align":"center","font-size":"12px","margin-bottom":"10px"}},[a("span",{staticClass:"addY",on:{click:t.addCondition}},[a("i",{staticClass:"el-icon-circle-plus"}),t._v("添加条件")])]):t._e()],2)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"基本设定",name:"second"}},[a("el-collapse",{model:{value:t.configOpened,callback:function(e){t.configOpened=e},expression:"configOpened"}},[a("el-collapse-item",{staticClass:"tablist",attrs:{title:"标题",name:"1"}},[a("el-form",{staticStyle:{position:"relative"},attrs:{"label-position":"left","label-width":"50px"}},["see"===t.operType?a("div",{staticClass:"from-zz"}):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.chartsConfig.title.text,callback:function(e){t.$set(t.chartsConfig.title,"text",e)},expression:"chartsConfig.title.text"}})],1)],1)],1),t._v(" "),a("el-collapse-item",{staticClass:"tablist",attrs:{title:"显示",name:"2"}},[a("el-form",{staticStyle:{position:"relative"},attrs:{"label-position":"left","label-width":"80px"}},["see"===t.operType?a("div",{staticClass:"from-zz"}):t._e(),t._v(" "),"ElasticSearch"===t.chartsConfig.dataSourceType?a("el-form-item",{attrs:{label:"显示总数"}},[a("el-input",{attrs:{min:"1",type:"Number",size:"mini"},model:{value:t.chartsConfig.counts,callback:function(e){t.$set(t.chartsConfig,"counts",e)},expression:"chartsConfig.counts"}})],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"每页条数"}},[a("el-input",{attrs:{min:"1",type:"Number",size:"mini"},model:{value:t.chartsConfig.page.size,callback:function(e){t.$set(t.chartsConfig.page,"size",e)},expression:"chartsConfig.page.size"}})],1)],1)],1)],1)],1)],1)],1),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"view-wapper",style:{height:t.wapperHeight},attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("div",{staticClass:"charts-title"},[t._v(t._s(t.chartsConfig.title.text))]),t._v(" "),a("div",{attrs:{id:"charts-wapper"}},[a("v-basetable",{attrs:{tableHead:t.chartsConfig.tableHead,emptyText:t.emptyText,height:t.tableHeight,tableData:t.chartsConfig.tableData}}),t._v(" "),0!==t.chartsConfig.tableData.length?a("div",{staticStyle:{display:"flex",height:"50px","align-items":"center","justify-content":"flex-end","border-top":"1px solid #5a7494"}},[t._v("\n                        总条数 "),a("b",{staticStyle:{color:"#409eff",margin:"0 10px"}},[t._v(" "+t._s(this.chartsConfig.trueCount)+" ")]),t._v(",最大显示条数 "),a("b",{staticStyle:{color:"#409eff",margin:"0 10px"}},[t._v(" "+t._s(this.showCount)+" ")]),t._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":t.chartsConfig.page.cPage,"page-size":t.pageSize,total:t.chartsConfig.page.allCounts},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.chartsConfig.page,"cPage",e)},"update:current-page":function(e){return t.$set(t.chartsConfig.page,"cPage",e)}}})],1):t._e()],1),t._v(" "),this.emptyTipState?t._e():a("el-popover",{staticClass:"source-data",attrs:{placement:"left",title:"",width:"400",trigger:"click"}},[a("jsonView",{staticClass:"jsonView",attrs:{data:this.sourceData,theme:"one-dark","line-height":20,deep:5}}),t._v(" "),a("el-button",{attrs:{slot:"reference",type:"primary",plain:"",size:"mini"},slot:"reference"},[t._v("源数据")])],1)],1),t._v(" "),a("div",{staticClass:"search-wapper",style:{height:t.wapperHeight}},[a("div",{staticClass:"search-tit"},[t._v("查询条件")]),t._v(" "),a("div",{staticClass:"search-con"},[t._l(t.chartsConfig.columnArr,function(e,i){return e.isSearch&&""!==e.field?a("div",{key:i,staticStyle:{"margin-bottom":"5px"}},[a("div",{staticStyle:{"font-size":"12px","margin-bottom":"3px"}},[t._v(t._s(e.aliasName?e.aliasName:e.field))]),t._v(" "),a("el-input",{staticClass:"seach-input",attrs:{size:"mini"},model:{value:e.searchVal,callback:function(a){t.$set(e,"searchVal",a)},expression:"fromItem.searchVal"}})],1):t._e()}),t._v(" "),a("div",{staticStyle:{"margin-bottom":"5px"}},[a("div",{staticStyle:{"font-size":"12px","margin-bottom":"3px"}},[t._v("时间范围")]),t._v(" "),a("div",{staticClass:"search-date-wapper",staticStyle:{border:"1px solid #5583b7"}},[a("el-date-picker",{staticStyle:{width:"230px","flex-wrap":"wrap",border:"0"},attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",size:"mini","default-time":["00:00:00","23:59:59"],"range-separator":"","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchTime,callback:function(e){t.searchTime=e},expression:"searchTime"}})],1)])],2),t._v(" "),a("div",{staticClass:"search-btn"},[a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isCanCreate||"see"===t.operType},on:{click:t.searchData}},[t._v("确定")])],1)])]),t._v(" "),a("el-dialog",{attrs:{title:"保存",visible:t.dialogFormVisible,width:"400px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{model:{value:t.chartParams.chartName,callback:function(e){t.$set(t.chartParams,"chartName",e)},expression:"chartParams.chartName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.chartParams.chartDes,callback:function(e){t.$set(t.chartParams,"chartDes",e)},expression:"chartParams.chartDes"}})],1),t._v(" "),""!==t.chartId?a("el-form-item",[a("el-switch",{attrs:{"active-text":"另存为新图表"},model:{value:t.chartParams.otherSave,callback:function(e){t.$set(t.chartParams,"otherSave",e)},expression:"chartParams.otherSave"}})],1):t._e()],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:""===t.chartParams.chartName&&"disabled"},on:{click:t.saveChart}},[t._v("确 定")])],1)],1),t._v(" "),a("tableDetail",{attrs:{dialogState:t.dialogState,columnHead:t.tableDetailObj.columnHead,rowData:t.tableDetailObj.rowData,busName:t.busTableDetailName}})],1)},staticRenderFns:[]};var y=a("VU/8")(f,g,!1,function(t){a("9BdW")},"data-v-47fb49d6",null);e.default=y.exports},jOC5:function(t,e){}});