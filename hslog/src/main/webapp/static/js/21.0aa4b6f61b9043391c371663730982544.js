webpackJsonp([21],{"/qXG":function(t,e){},"3CXN":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("ID1p"),i=a("62NR"),l=a("/sA3"),r=a("8+FI"),o={name:"alarmList",data:function(){return{loading:!1,page:1,c_page:1,size:15,busName:"searchAlarm",tableBusName:{selectionName:"alarmDelect"},allCounts:0,tableHead:[],tableData:[],formConditionsArr:[{label:"名称",paramName:"alert_name",model:{model:""},itemType:"",type:"input"}],conditionFrom:{alert_name:""},delectAlarmIds:""}},created:function(){var t=this;this.tableHead=[{prop:"alert_name",label:"名称",width:""},{prop:"template_name",label:"数据源",width:"",formatData:function(t,e){return e.pre_index_name+e.suffix_index_name}},{prop:"alert_conditions",label:"告警条件",width:"",formatData:function(t,e){var a="",n=JSON.parse(t);for(var i in n)"is one of"!==n[i].operator&&"is not one of"!==n[i].operator?a+=n[i].field+" "+n[i].operator+"<b> "+n[i].value+"</b>; ":a+=n[i].field+" "+n[i].operator+"<b> "+n[i].values+"</b>; ";return a}},{prop:"alert_exec_cycle",label:"执行周期",width:""},{prop:"alert_time",label:"时间范围",width:"",formatData:function(t,e){var a="";if("range"===e.alert_time_type){var n=t.split(",");""===n[0]&&(n[0]="*"),""===n[1]&&(n[1]="*"),a=n[0]+"至"+n[1]}else if("1-daying"===t)a="今天";else if("1-weeking"===t)a="这周";else if("1-monthing"===t)a="本月";else{var i=t.split("-");a="min"===i[1]?"最近"+i[0]+"分钟":"hour"===i[1]?"最近"+i[0]+"小时":"day"===i[1]?"最近"+i[0]+"天":"时间格式未知"}return a}},{prop:"alert_state_boolean",label:"状态",width:"80",formatData:function(t,e){return t?'<label><input class="mui-switch" type="checkbox" checked title="执行中" style="cursor: pointer"></label>':'<label><input class="mui-switch mui-switch-anim" type="checkbox" title="已停止" style="cursor: pointer"></label>'},clickFun:function(e,a){t.setAlarmState(e,a)}},{prop:"alert_note",label:"说明",width:""},{prop:"tools",label:"操作",width:"",btns:[{icon:"el-icon-edit",text:"修改",clickFun:function(e,a){t.goToReviseAlarm(e,a)}},{icon:"el-icon-tickets",text:"查看执行详情",clickFun:function(e,a){t.detailAlarm(e,a)}},{icon:"el-icon-caret-right",text:"立即执行一次",clickFun:function(e,a){t.startAlarm(e.alert_id)}}]}],this.getAlarmList(this.conditionFrom,1),r.default.$on(this.busName,function(e){t.conditionFrom=e,t.getAlarmList(t.conditionFrom,1),t.c_page=1}),r.default.$on(this.tableBusName.selectionName,function(e){for(var a in t.delectAlarmIds="",e)t.delectAlarmIds+=e[a].alert_id+","})},beforeDestroy:function(){r.default.$off(this.busName)},methods:{goToAddAlarm:function(){this.$router.push({path:"addAlarm"})},refresh:function(){this.c_page=1,this.getAlarmList(this.conditionFrom,1)},getAlarmList:function(t,e){var a=this;this.loading=!0;var n=t;n.pageIndex=e,n.pageSize=this.size,this.$nextTick(function(){a.loading=!0,a.$axios.post(a.$baseUrl+"/alert/getAlertInfoByCondition.do",a.$qs.stringify(n)).then(function(t){a.loading=!1;var e=t.data;"true"===e.success?(a.allCounts=Number(e.data.count),a.tableData=e.data.list):layer.msg(e.message,{icon:5})}).catch(function(t){a.loading=!1})})},goToReviseAlarm:function(t){Object(l.l)("editAlarm"+t.alert_id,"alarmManage/editAlarm.vue",{name:t.alert_name,id:t.alert_id},"修改")},startAlarm:function(t){var e=this;layer.confirm("您确定立即执行一次么？",{btn:["确定","取消"]},function(a){e.loading=!0,e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/alert/startOnce.do",e.$qs.stringify({alert_id:t})).then(function(t){e.loading=!1,"true"==t.data.success?layer.msg(t.data.message,{icon:1}):layer.msg(t.data.message,{icon:5})}).catch(function(t){e.loading=!1,layer.msg("删除失败",{icon:5})})})},function(){layer.close()})},deleteAlarm:function(){var t=this;layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(e){t.loading=!0,t.$nextTick(function(){t.$axios.post(t.$baseUrl+"/alert/deletes.do",t.$qs.stringify({alert_ids:t.delectAlarmIds})).then(function(e){t.loading=!1,"true"==e.data.success?(layer.msg("删除成功",{icon:1}),t.c_page=1,t.getAlarmList(t.conditionFrom,1)):layer.msg(e.data.message,{icon:5})}).catch(function(e){t.loading=!1,layer.msg("删除失败",{icon:5})})})},function(){layer.close()})},detailAlarm:function(t){Object(l.l)("alarmExecuteDetail"+t.alert_id,"alarmManage/alarmExecuteDetail.vue",{name:t.alert_name,id:t.alert_id},"执行详情")},handleCurrentChange:function(t){this.getAlarmList(this.conditionFrom,t)},setAlarmState:function(t,e){var a=this,n="";n=t.alert_state_boolean?"/alert/stopQuartz.do":"/alert/startQuartz.do",this.$nextTick(function(){a.loading=!0,a.$axios.post(a.$baseUrl+n,a.$qs.stringify({alert_id:t.alert_id})).then(function(n){a.loading=!1;var i=n.data;"true"===i.success?(layer.msg(i.message,{icon:1}),a.tableData[e].alert_state_boolean=!t.alert_state_boolean):layer.msg(i.message,{icon:5})}).catch(function(t){a.loading=!1})})}},components:{vBasetable:i.default,vSearchForm:n.default}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"content-bg",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("div",{staticClass:"top-title"},[t._v("告警管理\n        "),a("div",{staticClass:"btn-wapper"},[a("el-button",{attrs:{type:"danger",size:"mini",plain:"",disabled:!(t.delectAlarmIds.length>0)},on:{click:t.deleteAlarm}},[t._v("删除")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.goToAddAlarm}},[t._v("添加")]),t._v(" "),a("el-button",{attrs:{type:"success",size:"mini",plain:""},on:{click:t.refresh}},[t._v("刷新")])],1)]),t._v(" "),a("div",{staticClass:"search-wapper"},[a("v-search-form",{attrs:{formItem:t.formConditionsArr,busName:t.busName}})],1),t._v(" "),a("div",{staticClass:"alarm-list-wapper"},[a("vBasetable",{attrs:{selection:!0,tableHead:t.tableHead,tableData:t.tableData,busName:t.tableBusName}})],1),t._v(" "),a("div",{staticClass:"alarm-table-page"},[a("span",[t._v("共检索到告警数量为 "),a("b",[t._v(t._s(t.allCounts))]),t._v(" 个")]),t._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":t.c_page,"page-size":t.size,total:t.allCounts},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.c_page=e},"update:current-page":function(e){t.c_page=e}}})],1)])},staticRenderFns:[]};var c=a("VU/8")(o,s,!1,function(t){a("/qXG")},"data-v-faf314b0",null);e.default=c.exports}});