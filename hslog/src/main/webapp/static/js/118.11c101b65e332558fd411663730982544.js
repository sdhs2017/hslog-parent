webpackJsonp([118],{"7+05":function(e,t){},GYfB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("ID1p"),o=a("576z"),s=a("8+FI"),r=a("/sA3"),i={name:"fileLogSearch",data:function(){return{layerObj:{detailData:{},layerState:!1},busName:"fileLogSearch",words:"",searchConditions:{},searchUrl:"log/getFilebeatLogListByBlend.do",formConditionsArr:[],tableHead:[],firstSearch:!0,logBaseJson:[],logType:[{label:"全部",value:""},{label:"数据库",value:"database"},{label:"中间件",value:"middleware"}],logLevel:[],levelVal:"",normalizationVal:"true",normalizationOpt:[{label:"全部",value:""},{label:"是",value:"true"},{label:"否",value:"false"}],progressRight:"right:-90px;",progressTitle:'导出中<br/><i class="el-icon-loading"></i>',progressVal:"",exportInternal:""}},created:function(){var e=this;this.tableHead=[{prop:"@timestamp",label:"时间",width:"150"},{prop:"fields.equipmentname",label:"资产名称",width:"125",clickFun:function(t){"unknown"===t.equipmentid?layer.msg("资产未知",{icon:5}):e.$router.push({name:"equipment2",params:{equipmentid:t.fields.equipmentid}})}},{prop:"fields.ip",label:"IP",width:"125"},{prop:"message",label:"日志内容",width:""},{prop:"tools",label:"操作",width:"60",btns:[{icon:"el-icon-tickets",text:"查看详情",btnType:"readDetails",clickFun:function(t,a){t.agent.type="file",e.layerObj.layerState=!0,e.layerObj.detailData=t}},{icon:"el-icon-circle-close",text:"删除",btnType:"removeItem",clickFun:function(t,a){e.$refs.logContent.removeParams([t])}}]}];var t=Object(r.e)("yyyy-mm-dd HH:MM:SS",new Date),a=new Date;a.setTime(a.getTime()-864e5*this.$store.state.beforeDay),a=Object(r.e)("yyyy-mm-dd HH:MM:SS",a),this.searchConditions={"fields.file_type":"",endtime:t,"fields.ip":"","fields.equipmentname":"",starttime:a},this.formConditionsArr=[{label:"时间范围",type:"datetimerange",itemType:"",paramName:"time",model:{model:[a,t]},val:""},{label:"日志类型",paramName:"fields.file_type",type:"select",itemType:"",model:{model:""},options:this.logType},{label:"IP地址",paramName:"fields.ip",itemType:"",model:{model:""},type:"input"},{label:"资产名称",paramName:"fields.equipmentname",model:{model:""},itemType:"",type:"input"}],s.default.$on(this.busName,function(t){e.searchConditions=t}),s.default.$on("logTypeChange",function(t){var a="syslog";1===t.length&&(a=t[0]),e.setLogLevel(a)}),localStorage.getItem("exportLogs")&&(this.progressRight="right:5px;",this.progressTitle="导出中<br/>...",this.exportInternal=setInterval(this.updataProgressValue,1e3)),s.default.$on("exportStart",function(t){e.progressRight="right:5px;",e.exportInternal=setInterval(e.updataProgressValue,1e3)}),s.default.$on("exportFail",function(t){e.progressRight="right:-90px;",layer.msg("导出失败",{icon:5}),clearInterval(e.exportInternal),localStorage.removeItem("exportLogs")})},beforeDestroy:function(){s.default.$off(this.busName),s.default.$off("logTypeChange"),s.default.$off("exportStart"),s.default.$off("exportFail")},watch:{},methods:{getLogType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/logTypeLevel2.json",{}).then(function(t){e.logBaseJson=t.data;for(var a=0;a<t.data.length;a++){var l={value:t.data[a].type,label:t.data[a].type};e.logType.push(l)}e.setLogLevel("syslog")}).catch(function(e){console.log(e)})})},setLogLevel:function(e){this.logLevel.length=0,this.levelVal="";for(var t=0;t<this.logBaseJson.length;t++)if(this.logBaseJson[t].type==e)for(var a=0;a<this.logBaseJson[t].level.length;a++){var l={value:this.logBaseJson[t].level[a],label:this.logBaseJson[t].level[a]};this.logLevel.push(l)}},updataProgressValue:function(){var e=this;this.$nextTick(function(){e.$axios.get(e.$baseUrl+"/log/getExportProcess.do",{}).then(function(t){"finished"===t.data[0].state?(clearInterval(e.exportInternal),e.progressTitle="导出<br/>完成",e.progressVal=t.data[0].value,setTimeout(function(){e.progressRight="right:-90px;"},5e3),setTimeout(function(){e.progressTitle="导出中<br/>...",e.progressVal=""},5300),layer.msg("导出成功",{icon:1}),localStorage.removeItem("exportLogs")):e.progressVal=t.data[0].value}).catch(function(e){console.log(e)})})}},components:{vSearchForm:l.default,vLogscontent2:o.default}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[e._v("文件日志查询")]),e._v(" "),a("div",{staticClass:"search-wapper"},[a("v-search-form",{attrs:{formItem:e.formConditionsArr,busName:e.busName}})],1),e._v(" "),a("div",{staticClass:"content-wapper"},[a("v-logscontent2",{ref:"logContent",attrs:{searchConditions:e.searchConditions,tableHead:e.tableHead,searchUrl:e.searchUrl,layerObj:e.layerObj,moreDeleteBtn:!0}})],1),e._v(" "),a("div",{staticClass:"export-progress-box",style:e.progressRight},[a("div",{staticClass:"export-progress-wapper"},[a("div",{staticClass:"progress-name",domProps:{innerHTML:e._s(e.progressTitle)}}),e._v(" "),a("div",{staticClass:"progress-val"},[e._v(e._s(e.progressVal))])])])])},staticRenderFns:[]};var p=a("VU/8")(i,n,!1,function(e){a("7+05")},"data-v-038bdfb6",null);t.default=p.exports}});