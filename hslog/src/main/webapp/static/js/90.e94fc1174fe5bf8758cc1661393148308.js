webpackJsonp([90],{"2svr":function(t,e){},pNFL:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"equipmentScan",data:function(){return{loading:!1,form:{startip:"",endip:""},typeArr:[],tableData:[],scanState:!1,scanText:"资产扫描中",getEquipmentState:"",getScanEquipmentInterval:"",getScanStateInterval:""}},created:function(){var t=this;this.getEquipmentType(),this.getEquipmentScan(),localStorage.getItem("scanState")&&(this.scanState=!0,this.getScanEquipmentInterval=setInterval(function(){t.getScanEquipment()},3e3),this.getScanStateInterval=setInterval(function(){t.getScanState()},3e3))},watch:{scanState:function(){this.scanState?clearInterval(this.getEquipmentState):this.getEquipmentState=setInterval(function(){},12e4)}},methods:{getEquipmentType:function(){var t=this;this.$nextTick(function(){t.$axios.get("static/filejson/equiptype.json",{}).then(function(e){t.typeArr=e.data}).catch(function(t){console.log(t)})})},getEquipmentScan:function(){var t=this;this.loading=!0,this.tableData=[],this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/assets/selectAll.do","").then(function(e){t.loading=!1,e.data.forEach(function(a){if(null!==a.type){var n="",i=a.type.substring(0,2);for(var l in t.typeArr){var s=t.typeArr[l];if(s.value==i){for(var r in n+=s.label+"-",s.children)if(s.children[r].value==a.type){n+=s.children[r].label;break}break}}a.type=n}t.tableData=e.data})}).catch(function(e){t.loading=!1})})},getScanEquipment:function(){var t=this;this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/assets/selectByIncrement.do","").then(function(e){e.data.forEach(function(a){if(null!==a.type){var n="",i=a.type.substring(0,2);for(var l in t.typeArr){var s=t.typeArr[l];if(s.value==i){for(var r in n+=s.label+"-",s.children)if(s.children[r].value==a.type){n+=s.children[r].label;break}break}}a.type=n}t.tableData.prepend(e.data)})}).catch(function(t){})})},scanEquipment:function(){var t=this;if(this.scanState)layer.msg("有扫描任务正在进行",{icon:5});else{var e=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e.test(this.form.startip)?e.test(this.form.endip)?this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/collector/startMasscanCollector.do",t.$qs.stringify(t.form)).then(function(e){t.loading=!1,1==e.data[0].success?(layer.msg(e.data[0].msg,{icon:1}),t.scanState=!0,t.scanText="资产扫描中",t.getScanEquipmentInterval=setInterval(function(){t.getScanEquipment()},3e3),t.getScanStateInterval=setInterval(function(){t.getScanState()},3e3),localStorage.setItem("scanState","true")):layer.msg(e.data[0].msg,{icon:5})}).catch(function(e){t.loading=!1})}):layer.msg("结束ip地址不能为空或格式不正确",{icon:5}):layer.msg("起始ip地址不能为空或格式不正确",{icon:5})}},getScanState:function(){var t=this;this.$nextTick(function(){t.$axios.post(t.$baseUrl+"collector/stateMasscanCollector.do","").then(function(e){1==e.data[0].state&&(t.scanText="扫描完成",clearInterval(t.getScanEquipmentInterval),clearInterval(t.getScanStateInterval),t.getScanEquipment(),localStorage.removeItem("scanState"))}).then(function(t){})})},goToUpdate:function(t){var e=[{path:"/",component:function(t){return Promise.all([a.e(0),a.e(2)]).then(function(){var e=[a("MpTN")];t.apply(null,e)}.bind(this)).catch(a.oe)},meta:{title:"自述文件"},children:[{path:"/updateEquipment"+t.id,name:"updateEquipment"+t.id,component:function(t){return Promise.all([a.e(0),a.e(5)]).then(function(){var e=[a("EBFn")];t.apply(null,e)}.bind(this)).catch(a.oe)},meta:{title:"资产更新"}}]}];this.$router.addRoutes(e),this.$router.push({path:"/updateEquipment"+t.id,query:{ip:t.ip,id:t.id}})}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[t._v("资产配置管理\n        "),t.scanState?a("div",{staticStyle:{float:"right","margin-right":"10px",color:"mediumspringgreen"}},["资产扫描中"===t.scanText?a("i",{staticClass:"el-icon-loading"},[t._v(t._s(t.scanText))]):t._e()]):t._e()]),t._v(" "),a("div",{staticClass:"scan-wapper"},[a("div",{ref:"form",staticClass:"scan-condition"},[a("div",[a("label",[t._v("起始IP")]),t._v(" "),a("el-input",{staticClass:"item",attrs:{size:"mini"},model:{value:t.form.startip,callback:function(e){t.$set(t.form,"startip",e)},expression:"form.startip"}})],1),t._v(" "),a("div",[a("label",[t._v("结束IP")]),t._v(" "),a("el-input",{staticClass:"item",attrs:{size:"mini"},model:{value:t.form.endip,callback:function(e){t.$set(t.form,"endip",e)},expression:"form.endip"}})],1),t._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.scanEquipment}},[a("i",{staticClass:"el-icon-search"}),t._v("扫描")])],1)]),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"scan-table-wapper",attrs:{"element-loading-background":"rgba(26,36,47, 0.2)"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"",fit:""}},[a("el-table-column",{attrs:{prop:"ip",label:"IP地址"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"资产名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"hostName",label:"主机名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:"资产类型"}}),t._v(" "),a("el-table-column",{attrs:{prop:"logType",label:"日志类型"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"进入时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(null!==e.row.createTime?e.row.createTime.split(".")[0]:"-")+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"upDateTime",label:"更新时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(null!==e.row.upDateTime?e.row.upDateTime.split(".")[0]:"-")+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"endTime",label:"结束时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(null!==e.row.endTime?e.row.endTime.split(".")[0]:"-")+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"startUp",label:"是否启用"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(0===e.row.startUp?"否":"是")+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"responseDate",label:"响应时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(Number((new Date-new Date(e.row.responseDate))/1e3/60).toFixed(2))+" min\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"state",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["正常"===e.row.state?a("el-tag",{attrs:{type:"success","disable-transitions":""}},[t._v("正常")]):a("el-tag",{attrs:{type:"warning","disable-transitions":""}},[t._v("超时")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("i",{staticClass:"el-icon-edit",attrs:{title:"修改"},on:{click:function(a){return t.goToUpdate(e.row)}}})]}}])})],1)],1)])},staticRenderFns:[]};var l=a("VU/8")(n,i,!1,function(t){a("2svr")},"data-v-2cb6a578",null);e.default=l.exports}});