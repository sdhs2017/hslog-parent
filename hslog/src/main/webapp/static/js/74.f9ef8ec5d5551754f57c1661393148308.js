webpackJsonp([74],{BROY:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("ID1p"),s=a("576z"),i=a("8+FI"),r=a("/sA3"),l={name:"accurateSearch2",data:function(){return{layerObj:{detailData:{},layerState:!1},backState:!1,backStateObj:{text:"",state:"false"},importState:!1,busName:"accurateSearch2",words:"",searchConditions:{},searchUrl:"ecsWinlog/getLogListByBlend.do",formConditionsArr:[],tableHead:[],firstSearch:!0,logBaseJson:[],logType:[],logLevel:[],levelVal:"",normalizationVal:"true",normalizationOpt:[{label:"全部",value:""},{label:"是",value:"true"},{label:"否",value:"false"}],progressRight:"right:-90px;",progressTitle:'导出中<br/><i class="el-icon-loading"></i>',progressVal:"",exportInternal:""}},created:function(){var t=this;this.tableHead=[{prop:"@timestamp",label:"时间",width:"150"},{prop:"log.level",label:"级别",width:"100"},{prop:"agent.type",label:"日志类型",width:"100"},{prop:"fields.equipmentname",label:"资产名称",width:"125",clickFun:function(e){"unknown"===e.equipmentid?layer.msg("资产未知",{icon:5}):t.$router.push({name:"equipment2",params:{equipmentid:e.fields.equipmentid}})}},{prop:"fields.ip",label:"IP",width:"125"},{prop:"message",label:"日志内容",width:""},{prop:"tools",label:"操作",width:"60",btns:[{icon:"el-icon-tickets",text:"查看详情",btnType:"readDetails",clickFun:function(e,a){t.layerObj.layerState=!0,t.layerObj.detailData=e}},{icon:"el-icon-circle-close",text:"删除",btnType:"removeItem",clickFun:function(e,a){t.$refs.logContent.removeParams([e])}}]}],this.getLogType(),this.setLogLevel("");var e=Object(r.e)("yyyy-mm-dd HH:MM:SS",new Date),a=new Date;if(a.setTime(a.getTime()-864e5*this.$store.state.beforeDay),a=Object(r.e)("yyyy-mm-dd HH:MM:SS",a),this.searchConditions={normalization:"true","agent.type":"",endtime:e,"fields.ip":"","fields.equipmentname":"","log.level":"",starttime:a},this.formConditionsArr=[{label:"事件范围",type:"datetimerange",itemType:"",paramName:"time",model:{model:[a,e]},val:""},{label:"日志类型",paramName:"agent.type",type:"select",itemType:"multiple",model:{model:""},options:this.logType},{label:"日志级别",paramName:"log.level",type:"select",itemType:"multiple",model:{model:this.levelVal},options:this.logLevel},{label:"是否完整范式化",paramName:"normalization",width:"70",type:"select",itemType:"",model:{model:this.normalizationVal},options:this.normalizationOpt},{label:"IP地址",paramName:"fields.ip",itemType:"",model:{model:""},type:"input"},{label:"资产名称",paramName:"fields.equipmentname",model:{model:""},itemType:"",type:"input"}],this.$route.params.logLevel){var o="",s="";this.$route.params.dateArr&&this.$route.params.dateArr[0].length&&(o=this.$route.params.dateArr[0],s=this.$route.params.dateArr[1]),this.formConditionsArr[0].model.model=[o,s],this.formConditionsArr[2].model.model=[this.$route.params.logLevel],this.searchConditions["log.level"]=this.$route.params.logLevel,this.searchConditions.starttime=o,this.searchConditions.endtime=s,this.formConditionsArr[1].model.model="",this.searchConditions["agent.type"]=""}i.default.$on(this.busName,function(e){t.searchConditions=e}),i.default.$on("logTypeChange",function(e){var a;a=e.join(","),t.setLogLevel(a)}),localStorage.getItem("exportLogs")&&(this.progressRight="right:5px;",this.progressTitle="导出中<br/>...",this.exportInternal=setInterval(this.updataProgressValue,1e3)),i.default.$on("exportStart",function(e){t.progressRight="right:5px;",t.exportInternal=setInterval(t.updataProgressValue,1e3)}),i.default.$on("exportFail",function(e){t.progressRight="right:-90px;",layer.msg("导出失败",{icon:5}),clearInterval(t.exportInternal),localStorage.removeItem("exportLogs")})},beforeDestroy:function(){i.default.$off(this.busName),i.default.$off("logTypeChange"),i.default.$off("exportStart"),i.default.$off("exportFail")},watch:{$route:function(t,e){if(this.$route.params.logLevel){var a="",o="";this.$route.params.dateArr&&(this.$route.params.dateArr[0].length?(a=this.$route.params.dateArr[0]+" 00:00:00",o=this.$route.params.dateArr[1]+" 23:59:59"):(a=Object(r.e)("yyyy-mm-dd",this.$route.params.dateArr[0])+" 00:00:00",o=Object(r.e)("yyyy-mm-dd",this.$route.params.dateArr[1])+" 23:59:59")),this.formConditionsArr[2].model.model=[this.$route.params.logLevel],this.formConditionsArr[0].model.model=[a,o],this.searchConditions["log.level"]=this.$route.params.logLevel,this.searchConditions.starttime=a,this.searchConditions.endtime=o,this.formConditionsArr[1].model.model="",this.searchConditions["agent.type"]=""}},importState:function(){var t=this;!0===this.importState&&setTimeout(function(){var e=t;$("#ssi-upload").ssi_uploader({url:t.$baseUrl+"/log/insertLog.do",maxNumberOfFiles:1,allowed:["xlsx","xls","xlsm"],ajaxOptions:{success:function(t){var a=JSON.parse(t);e.backState=!0,e.backStateObj={state:a.success,text:a.message}},error:function(t){layer.msg("导入失败",{icon:5}),$(".ssi-abortUpload").click()}}})},100)}},methods:{downLoadEq:function(){var t=document.getElementById("eqDownload");t.href=this.$baseUrl+"/log/logTemplateFileDownload.do",t.click()},importLogs:function(){this.importState=!0},getLogType:function(){var t=this;this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/log/getLogTypeComboxByPage.do",t.$qs.stringify({pageType:"search"})).then(function(e){for(var a in e.data.data)t.logType.push(e.data.data[a])}).catch(function(t){console.log(t)})})},setLogLevel:function(t){var e=this;this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/log/getLogLevelByLogType.do",e.$qs.stringify({logType:t})).then(function(t){var a=t.data;if("true"==a.success){e.logLevel=[];for(var o=0;o<a.data.length;o++)e.$set(e.logLevel,o,a.data[o]);e.formConditionsArr[2].options=e.logLevel}else layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})})},updataProgressValue:function(){var t=this;this.$nextTick(function(){t.$axios.get(t.$baseUrl+"/log/getExportProcess.do",{}).then(function(e){if("finished"===e.data[0].state){clearInterval(t.exportInternal),t.progressTitle="导出<br/>完成",t.progressVal=e.data[0].value,setTimeout(function(){t.progressRight="right:-90px;"},5e3),setTimeout(function(){t.progressTitle="导出中<br/>...",t.progressVal=""},5300),layer.msg("导出成功",{icon:1}),localStorage.removeItem("exportLogs");var a=document.createElement("a"),o=t.$baseUrl+"/log/logFileDownload.do";a.href=o,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(o)}else t.progressVal=e.data[0].value}).catch(function(t){console.log(t)})})}},components:{vSearchForm:o.default,vLogscontent2:s.default}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-bg"},[t._m(0),t._v(" "),a("div",{staticClass:"search-wapper"},[a("v-search-form",{attrs:{formItem:t.formConditionsArr,busName:t.busName}})],1),t._v(" "),a("div",{staticClass:"content-wapper"},[a("v-logscontent2",{ref:"logContent",attrs:{searchConditions:t.searchConditions,tableHead:t.tableHead,searchUrl:t.searchUrl,exportBtn:!0,layerObj:t.layerObj,moreDeleteBtn:!0}})],1),t._v(" "),a("div",{staticClass:"export-progress-box",style:t.progressRight},[a("div",{staticClass:"export-progress-wapper"},[a("div",{staticClass:"progress-name",domProps:{innerHTML:t._s(t.progressTitle)}}),t._v(" "),a("div",{staticClass:"progress-val"},[t._v(t._s(t.progressVal))])])]),t._v(" "),a("el-dialog",{staticClass:"dialog-wapper",attrs:{title:"日志导入",visible:t.importState,width:"680px",height:"550px"},on:{"update:visible":function(e){t.importState=e}}},[t.backState?a("div",{staticClass:"back-state"},[a("p",{staticClass:"i-box"},["true"==this.backStateObj.state?a("i",{staticClass:"el-icon-success",staticStyle:{color:"#279e72"}}):a("i",{staticClass:"el-icon-error",staticStyle:{color:"#e27145"}})]),t._v(" "),"true"==this.backStateObj.state?a("h3",{staticClass:"back-h3",staticStyle:{color:"#279e72"}},[t._v("导入成功")]):a("h3",{staticClass:"back-h3",staticStyle:{color:"#e27145"}},[t._v("导入失败")]),t._v(" "),a("p",{staticClass:"back-text"},[t._v(t._s(this.backStateObj.text))]),t._v(" "),a("p",{staticClass:"back-btn"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.backState=!1}}},[t._v("返回导入界面")])],1)]):t._e(),t._v(" "),a("p",[t._v("通过浏览本地文件或将文件拖到下面指定区域，上传日志文件。")]),t._v(" "),a("p",[t._v("文件支持的类型："),a("span",{staticClass:"txtColor"},[t._v(".xlsx")]),t._v(" "),a("span",{staticClass:"txtColor"},[t._v(".xls")]),t._v(" "),a("span",{staticClass:"txtColor"},[t._v(".xlsm")])]),t._v(" "),a("p",[t._v("文件的名称必须为："),a("span",{staticClass:"txtColor"},[t._v("日志")]),t._v("  (例:日志.xlsx)")]),t._v(" "),a("div",{staticStyle:{"padding-right":"30px"}},[a("input",{attrs:{type:"file",multiple:"",id:"ssi-upload"}})]),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.importState=!1}}},[t._v("取 消")])],1)])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"top-title"},[this._v("精确查询\n        "),e("div",{staticClass:"equipemnt-tools-btns"})])}]};var c=a("VU/8")(l,n,!1,function(t){a("Y9lo")},"data-v-4b2a1f7d",null);e.default=c.exports},Y9lo:function(t,e){}});