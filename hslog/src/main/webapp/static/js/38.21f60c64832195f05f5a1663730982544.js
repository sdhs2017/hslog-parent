webpackJsonp([38],{"4Ogx":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),n=a.n(s),i=a("woOf"),l=a.n(i),r=a("ID1p"),o=a("qTy0"),m=a("6EjU"),c=(a("/sA3"),a("8+FI")),u={name:"menuManage",data:function(){var e=this;return{treeData:[{id:"0",sys_name:"全部",children:[]}],props:{label:"sys_name",children:"children",isLeaf:"leaf"},systemParams:{sys_name:"",icon:"",note:""},selectedTreeNode:{id:"",note:"",sys_name:""},busName:{selectionName:"userSelect",reviseUserName:"reviseUserName"},resiveIndex:"",treeKey:"",treeForm:!1,userForm:!1,clickModal:!1,menuForm:{name:"",id:""},menuFormState:!1,menuParam:{menuName:"",superiorId:"",childId:"",url:"",icon:"",state:"",fk_system_id:"",btn:""},sysOptions:[],menuBtnHead:[{prop:"name",label:"名称",width:""},{prop:"id",label:"id",width:""},{prop:"tools",label:"操作",width:"60px",btns:[{icon:"el-icon-edit",text:"修改",btnType:"reviseUser",clickFun:function(t,a){!0===e.menuFormState?layer.msg("此前操作未完成",{icon:5}):(e.menuFormState=!0,e.menuBtnName="修改",e.menuForm=l()({},t),e.resiveIndex=a)}},{icon:"el-icon-close",text:"删除",btnType:"remove",clickFun:function(t,a){e.menuBtnData.splice(a,1)}}]}],menuBtnData:[],menuBtnName:"添加",sysId:"",userParams:{name:"",sex:1,phone:"",age:"",password:"",Email:"",departmentId:0,role:1,state:1},userCheckboxState:!0,password2:"",selectedUserIds:"",reviseMenuId:"",treeBtnType:"add",userBtnType:"add",menuTableHeadData:[{prop:"menuName",label:"菜单名称",width:""},{prop:"superiorId",label:"父级菜单ID",width:""},{prop:"childId",label:"序号",width:""},{prop:"url",label:"url",width:""},{prop:"icon",label:"icon",width:""},{prop:"state",label:"状态",width:"150px",formatData:function(e){return"1"==e?"启用":"停用"}},{prop:"systemName",label:"所属系统",width:""},{prop:"tools",label:"操作",width:"60px",btns:[{icon:"el-icon-edit",text:"修改菜单",btnType:"reviseMenu",clickFun:function(t){e.reviseMenuBtn(t)}},{icon:"el-icon-close",text:"删除菜单",btnType:"reviseMenu",clickFun:function(t){e.removeMenu(t.id)}}]}],menuTableData:[],options:[]}},computed:{disabled:function(){return 5!==JSON.parse(localStorage.getItem("LoginUser")).role}},created:function(){this.getTreeData()},mounted:function(){},watch:{},beforeDestroy:function(){c.default.$off("searchUserCon"),c.default.$off("getValue"),c.default.$off(this.busName.selectionName),c.default.$off(this.busName.reviseUserName)},methods:{getTreeData:function(){var e=this;this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/system/selectAllSystem.do","").then(function(t){for(var a in e.sysOptions=[],e.treeData[0].children=t.data,t.data)e.sysOptions.push({value:t.data[a].id,label:t.data[a].sys_name})}).catch(function(e){})})},nodeClick:function(e){0!=e.id&&(this.sysId=e.id,this.selectedTreeNode={id:e.id,note:e.note,sys_name:e.sys_name}),this.getMenuBySysId()},getMenuBySysId:function(){var e=this;this.$nextTick(function(){layer.load(1),e.$axios.post(e.$baseUrl+"/menu/selectMenuBySysID.do",e.$qs.stringify({systemID:e.sysId})).then(function(t){layer.closeAll("loading"),e.menuTableData=t.data[0]}).catch(function(e){layer.closeAll("loading")})})},addBtn:function(){this.treeBtnType="add",this.treeForm=!0,this.systemParams={}},addTree:function(){var e=this;layer.load(1),this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/system/upsert.do",e.$qs.stringify(e.systemParams)).then(function(t){layer.closeAll("loading"),"true"===t.data.success?(layer.msg("添加成功",{icon:1}),e.treeForm=!1,e.getTreeData()):layer.msg(t.data.message,{icon:5})}).catch(function(e){layer.closeAll("loading")})})},editBtn:function(){this.selectedTreeNode.id?(this.treeBtnType="edit",this.treeForm=!0,this.systemParams=l()({},this.selectedTreeNode)):layer.msg("未选中任何系统",{icon:5})},editTree:function(){var e=this;layer.load(1),this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/system/upsert.do",e.$qs.stringify(e.systemParams)).then(function(t){layer.closeAll("loading"),"true"===t.data.success?(layer.msg("修改成功",{icon:1}),e.treeForm=!1,e.selectedTreeNode={},e.getTreeData()):layer.msg(t.data.message,{icon:5})}).catch(function(e){layer.closeAll("loading")})})},removeTree:function(){var e=this;this.selectedTreeNode.id?layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){layer.load(1),e.$nextTick(function(){e.$axios.post(e.$baseUrl+"/system/delete.do",e.$qs.stringify({id:e.selectedTreeNode.id})).then(function(t){layer.closeAll("loading"),"true"===t.data.success?(layer.msg("删除成功",{icon:1}),e.selectedTreeNode={},e.getTreeData()):layer.msg(t.data.message,{icon:5})}).catch(function(e){layer.closeAll("loading")})})}):layer.msg("未选中任何组织",{icon:5})},removeClass:function(e){"department-wapper"===$(e.target)[0].className&&(this.selectedTreeNode={},$(".el-tree--highlight-current").removeClass("el-tree--highlight-current"))},selectTreeUser:function(e){var t=this;layer.load(1),this.$nextTick(function(){t.$axios.get(t.$baseUrl+"/user/selectUser.do",{params:{id:e}}).then(function(e){layer.closeAll(),t.changeUserShowData(e.data[0])}).catch(function(e){layer.closeAll()})})},selectUser:function(e,t){var a=this;this.fatherName="",t.pageIndex=e,t.pageSize=this.pageSize,layer.load(1),this.$nextTick(function(){a.$axios.post(a.$baseUrl+"/user/selectAlls.do",a.$qs.stringify(t)).then(function(e){layer.closeAll(),a.allUserCounts=Number(e.data.count[0].count),a.changeUserShowData(e.data.user[0])}).catch(function(e){layer.closeAll()})})},changeUserShowData:function(e){this.userTableData=e},addMenuBtn:function(){this.userBtnType="add",this.menuParam={btn:"",childId:"",fk_system_id:"",icon:"",menuName:"",state:"",superiorId:"",url:""},this.menuBtnData=[],this.userForm=!0},addMenu:function(){var e=this;this.checkParams(this.menuParam)&&(this.menuParam.btn=n()(this.menuBtnData),layer.load(1),this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/menu/upsert.do",e.$qs.stringify(e.menuParam)).then(function(t){layer.closeAll("loading"),"true"===t.data.success?(layer.msg("添加成功",{icon:1}),e.userForm=!1,e.getMenuBySysId()):layer.msg(t.data.message,{icon:5})}).catch(function(e){layer.closeAll(),layer.msg("添加失败",{icon:5})})}))},removeMenu:function(e){var t=this;layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(a){layer.load(1),t.$nextTick(function(){t.$axios.post(t.$baseUrl+"/menu/delete.do",t.$qs.stringify({id:e})).then(function(e){layer.closeAll(),"true"===e.data.success?(layer.msg("删除成功",{icon:1}),t.getMenuBySysId()):layer.msg("删除失败",{icon:5})}).catch(function(e){layer.closeAll()})})})},reviseMenuBtn:function(e){var t=this;this.menuParam={btn:"",childId:"",fk_system_id:"",icon:"",menuName:"",state:"",superiorId:"",url:""},this.menuBtnData=[],this.userForm=!0,this.userBtnType="revise",layer.load(1),this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/menu/getEntity.do",t.$qs.stringify({id:e.id})).then(function(a){layer.closeAll("loading"),t.menuParam={btn:"",childId:a.data.childId,fk_system_id:a.data.fk_system_id,icon:a.data.icon,menuName:a.data.menuName,state:JSON.parse(a.data.state),superiorId:a.data.superiorId,url:a.data.url},t.menuBtnData=[];var s=JSON.parse(a.data.btn);for(var n in s)t.menuBtnData.push({id:s[n].buttonID,name:s[n].buttonName});t.reviseMenuId=e.id}).catch(function(e){layer.msg("获取菜单信息失败",{icon:5}),layer.closeAll("loading")})})},reviseUser:function(e){var t=this;this.menuParam.btn=n()(this.menuBtnData),this.menuParam.id=this.reviseMenuId,this.checkParams(this.menuParam)&&(layer.load(1),this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/menu/upsert.do",t.$qs.stringify(t.menuParam)).then(function(e){layer.closeAll("loading"),"true"===e.data.success?(layer.msg("修改成功",{icon:1}),t.userForm=!1,t.menuParam={btn:"",childId:"",fk_system_id:"",icon:"",menuName:"",state:"",superiorId:"",url:""},t.getMenuBySysId()):layer.msg(e.data.message,{icon:5})}).catch(function(e){layer.closeAll("loading"),layer.msg("修改失败",{icon:5})})}))},handleCurrentChange:function(e){this.selectUser(e,this.userSearchCondition)},menuBtn:function(){"添加"===this.menuBtnName?(this.menuFormState=!0,this.menuBtnName="确定"):"确定"===this.menuBtnName?""!==this.menuForm.name&&""!==this.menuForm.id&&(this.menuBtnData.push(this.menuForm),console.log(this.menuBtnData),this.menuForm={name:"",id:""},this.menuFormState=!1,this.menuBtnName="添加"):"修改"===this.menuBtnName&&""!==this.menuForm.name&&""!==this.menuForm.id&&(this.menuBtnData.splice(this.resiveIndex,1,this.menuForm),console.log(this.menuBtnData),this.menuForm={name:"",id:""},this.menuFormState=!1,this.menuBtnName="添加")},closeMenuBtn:function(){this.menuBtnName="添加",this.menuFormState=!1,this.menuForm={name:"",id:""}},checkParams:function(e){return""===e.menuName?(layer.msg("菜单名称不能为空",{icon:5}),!1):""===e.childId?(layer.msg("序号不能为空",{icon:5}),!1):""===e.fk_system_id?(layer.msg("所属系统不能为空",{icon:5}),!1):""!==e.superiorId||""!==e.icon||(layer.msg("一级菜单icon不能为空",{icon:5}),!1)}},components:{vBasetable:o.default,vSearchForm:r.default,vSelectTree:m.default}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[e._v("菜单管理")]),e._v(" "),a("div",{staticClass:"user-manage-content"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"department-wapper",on:{click:e.removeClass}},[a("div",{staticClass:"department-top"},[a("h5",[e._v("系统列表")]),e._v(" "),a("div",{staticClass:"department-btns"},[a("el-button",{attrs:{type:"primary",size:"mini",plain:"",title:"添加系统"},on:{click:e.addBtn}},[a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("el-button",{attrs:{type:"success",size:"mini",plain:"",title:"修改系统"},on:{click:e.editBtn}},[a("i",{staticClass:"el-icon-edit"})]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini",plain:"",title:"删除系统"},on:{click:e.removeTree}},[a("i",{staticClass:"el-icon-close"})])],1)]),e._v(" "),a("div",{staticClass:"department-content treeBox"},[a("el-tree",{key:e.treeKey,attrs:{props:e.props,data:e.treeData,"highlight-current":""},on:{"node-click":e.nodeClick}})],1)])]),e._v(" "),a("el-col",{attrs:{span:18}},[a("div",{staticClass:"user-wapper"},[a("div",{staticClass:"user-department-name"},[e._v(e._s(e.selectedTreeNode.sys_name))]),e._v(" "),a("div",{staticClass:"user-tools-wapper"},[a("div",{staticClass:"user-btn"},[a("el-button",{attrs:{type:"primary",size:"mini",plain:"",title:"添加菜单"},on:{click:e.addMenuBtn}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加菜单")])],1)]),e._v(" "),a("div",{staticClass:"user-table-wapper"},[a("v-basetable",{attrs:{tableHead:e.menuTableHeadData,tableData:e.menuTableData,height:500}})],1)])])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"add"===e.treeBtnType?"添加系统":"修改系统",visible:e.treeForm,width:"440px"},on:{"update:visible":function(t){e.treeForm=t}}},[a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称:"}},[a("el-input",{staticClass:"item",attrs:{placeholder:"名称"},model:{value:e.systemParams.sys_name,callback:function(t){e.$set(e.systemParams,"sys_name",t)},expression:"systemParams.sys_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"图标:"}},[a("el-input",{staticClass:"item",attrs:{placeholder:"图标"},model:{value:e.systemParams.icon,callback:function(t){e.$set(e.systemParams,"icon",t)},expression:"systemParams.icon"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述:"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:6,maxRows:8}},model:{value:e.systemParams.note,callback:function(t){e.$set(e.systemParams,"note",t)},expression:"systemParams.note"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){"add"===e.treeBtnType?e.addTree():e.editTree()}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.treeForm=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"add"===e.userBtnType?"添加菜单":"修改菜单",visible:e.userForm,width:"550px","close-on-click-modal":e.clickModal},on:{"update:visible":function(t){e.userForm=t}}},[a("el-tabs",{attrs:{type:"border-card",value:"first"}},[a("el-tab-pane",{staticClass:"pane-con",attrs:{label:"基本信息",name:"first"}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"菜单名称:"}},[a("el-input",{staticClass:"item",model:{value:e.menuParam.menuName,callback:function(t){e.$set(e.menuParam,"menuName",t)},expression:"menuParam.menuName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"父级菜单Id:"}},[a("el-input",{staticClass:"item",model:{value:e.menuParam.superiorId,callback:function(t){e.$set(e.menuParam,"superiorId",t)},expression:"menuParam.superiorId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"序号:"}},[a("el-input",{staticClass:"item",model:{value:e.menuParam.childId,callback:function(t){e.$set(e.menuParam,"childId",t)},expression:"menuParam.childId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"URL:"}},[a("el-input",{staticClass:"item",model:{value:e.menuParam.url,callback:function(t){e.$set(e.menuParam,"url",t)},expression:"menuParam.url"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"icon:"}},[a("el-input",{staticClass:"item",model:{value:e.menuParam.icon,callback:function(t){e.$set(e.menuParam,"icon",t)},expression:"menuParam.icon"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态:"}},[a("el-radio-group",{model:{value:e.menuParam.state,callback:function(t){e.$set(e.menuParam,"state",t)},expression:"menuParam.state"}},[a("el-radio",{attrs:{label:1}},[e._v("启用")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("停用")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"所属系统:"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.menuParam.fk_system_id,callback:function(t){e.$set(e.menuParam,"fk_system_id",t)},expression:"menuParam.fk_system_id"}},e._l(e.sysOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),a("el-tab-pane",{staticClass:"pane-con",attrs:{label:"按钮管理",name:"second"}},[a("div",{staticStyle:{display:"flex",height:"40px","align-items":"center"}},[a("div",{staticStyle:{display:"flex","align-items":"center",overflow:"hidden",width:"0",transition:"all 0.2s linear"},style:{width:e.menuFormState?"393px":"0"}},[a("span",{staticClass:"menu-span",staticStyle:{width:"45px"}},[e._v("名称：")]),a("el-input",{staticStyle:{width:"159px"},attrs:{placeholder:""},model:{value:e.menuForm.name,callback:function(t){e.$set(e.menuForm,"name",t)},expression:"menuForm.name"}}),e._v(" "),a("span",{staticClass:"menu-span",staticStyle:{width:"36px"}},[e._v("id：")]),a("el-input",{staticStyle:{width:"165px"},attrs:{placeholder:""},model:{value:e.menuForm.id,callback:function(t){e.$set(e.menuForm,"id",t)},expression:"menuForm.id"}})],1),e._v(" "),a("el-button",{staticClass:"menu-btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.menuBtn}},[e._v(e._s(e.menuBtnName))]),e._v(" "),e.menuFormState?a("el-button",{staticClass:"menu-btn",attrs:{type:"warning",plain:"",size:"mini"},on:{click:e.closeMenuBtn}},[e._v("取消")]):e._e()],1),e._v(" "),a("div",{staticStyle:{"border-top":"1px solid #5a7494","margin-top":"5px"}},[a("v-basetable",{attrs:{tableHead:e.menuBtnHead,tableData:e.menuBtnData}})],1)])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){"add"===e.userBtnType?e.addMenu():e.reviseUser()}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.userForm=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(u,d,!1,function(e){a("KsP/")},null,null);t.default=p.exports},"KsP/":function(e,t){}});