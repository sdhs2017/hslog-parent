webpackJsonp([100],{cEjW:function(e,t){},nikq:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),n=a.n(i),l=a("ID1p"),s=a("62NR"),o=a("MPrf"),r=a("8+FI"),c=a("/sA3"),d={name:"eventSearch_group",data:function(){var e=this;return{loading:!1,loadingFrom:!1,baseConfig:{type:"2",title:"事件详情",areaWidth:"620px",areaHeight:"520px"},layerObj:{detailData:{},layerState:!1},timeArr:[],page:1,size:15,c_page:1,allCounts:0,total:0,eventGroup:[],eventList:[],logTypeOpt:[],tableHead:[{prop:"@timestamp",label:"时间",width:"150"},{prop:"event.action",label:"名称",width:"150"},{prop:"winlog.task",label:"类型",width:"150"},{prop:"winlog.event_data.SubjectUserName",label:"主体",width:"120",formatData:function(e){return e||""}},{prop:"fields.ip",label:"客体/目的地址",width:"125"},{prop:"source.ip",label:"源地址",width:"125"},{prop:"agent.type",label:"日志类型",width:"100"},{prop:"fields.equipmentname",label:"资产名称",width:"120"},{prop:"winlog",label:"事件原因",width:"100"},{prop:"message",label:"日志内容",width:""},{prop:"tools",label:"操作",width:"60",btns:[{icon:"el-icon-tickets",text:"查看详情",btnType:"readDetails",clickFun:function(t,a){var i=t;i.type="eventDetail",e.layerObj.layerState=!0,e.layerObj.detailData=i}}]}],tableData:[],selectVal:"10万",selectOption:[{value:1e5,label:"10万"},{value:2e5,label:"20万"},{value:5e5,label:"50万"},{value:1e6,label:"100万"},{value:1e7,label:"1000万"},{value:1e8,label:"1亿"}],eventSearchCondition:{"winlog.task":"","event.action":"","agent.type":"",event_group_id:"","fields.ip":"","source.ip":"",endtime:"",starttime:""},saveCondition:{}}},created:function(){this.getEventGroup(""),this.getEventList(),this.getLogType();var e=Object(c.e)("yyyy-mm-dd HH:MM:SS",new Date),t=new Date;t.setTime(t.getTime()-864e5*this.$store.state.beforeDay),t=Object(c.e)("yyyy-mm-dd HH:MM:SS",t),this.timeArr=[t,e],this.eventSearchCondition={"winlog.task":"","event.action":"","agent.type":"","fields.ip":"","source.ip":"",event_group_id:"",endtime:e,starttime:t},this.saveCondition=this.eventSearchCondition,this.getEventsData(1,this.eventSearchCondition)},beforeDestroy:function(){r.default.$off("eventSearch_group")},watch:{"layerObj.layerState":{handler:function(e,t){var a=this;e&&r.default.$on("closeLayer",function(e){a.layerObj.layerState=!1,r.default.$off("closeLayer")})},deep:!0,immediate:!0}},methods:{getLogType:function(){var e=this;this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/log/getLogTypeComboxByPage.do",e.$qs.stringify({pageType:"event"})).then(function(t){for(var a in e.logTypeOpt.push({value:"",label:"全部"}),t.data.data)e.logTypeOpt.push(t.data.data[a])}).catch(function(e){console.log(e)})})},refreshEvent:function(){this.getEventGroup()},timeChanage:function(e){null!==e?(this.eventSearchCondition.starttime=e[0],this.eventSearchCondition.endtime=e[1]):(this.eventSearchCondition.starttime="",this.eventSearchCondition.endtime="")},logtypeChange:function(e){this.getEventList(e),this.eventSearchCondition["event.action"]=""},getEventList:function(e){var t=this;this.loadingFrom=!0,this.$nextTick(function(){t.$axios.post(t.$baseUrl+"/eventGroup/getEventListByType4Combobox_equal.do",t.$qs.stringify({log_type:e})).then(function(e){t.loadingFrom=!1;var a=e.data;"true"===a.success?t.eventList=a.data:layer.msg(a.message,{icon:5})}).catch(function(e){t.loadingFrom=!1})})},getEventGroup:function(){var e=this;this.loadingFrom=!0,this.$nextTick(function(){e.$axios.post(e.$baseUrl+"/eventGroup/getEventGroupList.do",e.$qs.stringify()).then(function(t){var a=t.data;e.loadingFrom=!1,"true"===a.success?e.eventGroup=a.data:layer.msg(a.message,{icon:5})}).catch(function(t){e.loadingFrom=!1})})},searchBtn:function(){var e=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;if(""===this.eventSearchCondition.starttime||""===this.eventSearchCondition.endtime)layer.msg("查询时间条件不允许为空，时间跨度过大可能导致相应慢",{icon:5});else{if(""!==this.eventSearchCondition["fields.ip"]&&!e.test(this.eventSearchCondition["fields.ip"]))return layer.msg("目的地址不合法",{icon:5}),!1;if(""!==this.eventSearchCondition["source.ip"]&&!e.test(this.eventSearchCondition["source.ip"]))return layer.msg("源地址不合法",{icon:5}),!1;this.getEventsData(1,this.eventSearchCondition),this.c_page=1,this.saveCondition=this.eventSearchCondition}},getEventsData:function(e,t){var a=this;this.loading=!0,t.size=this.size,t.page=e,t.exists="event.action",this.$nextTick(function(){a.$axios.post(a.$baseUrl+"/ecsCommon/getEventListByBlend.do",a.$qs.stringify({hsData:n()(t)})).then(function(e){for(var t in a.loading=!1,e.data[0].list)e.data[0].list[t].winlog.event_data||(e.data[0].list[t].winlog.event_data={},e.data[0].list[t].winlog.event_data.SubjectUserName="");a.tableData=e.data[0].list,a.allCounts=e.data[0].count,a.allCounts>1e5?a.total=1e5:a.total=a.allCounts}).catch(function(e){a.loading=!1,console.log(e)})})},handleCurrentChange:function(e){this.getEventsData(e,this.saveCondition),e*this.size>this.allCounts?layer.tips("这是最后一页",".el-pager .active",{tips:[1,"#3595CC"],time:4e3}):$(".el-pager .active").next().length<1&&layer.tips("可通过更改最大显示数量，查看后面的数据",".maxSelect",{tips:[1,"#3595CC"],time:4e3})},seletChange:function(e){e<this.allCounts?this.total=e:this.total=this.allCounts;e>=1e7&&layer.tips("提示: 数据量过大时，细化查询条件，提高查询效率",".maxSelect",{tips:[1,"#3595CC"],time:4e3})}},components:{vSearchForm:l.default,vBasetable2:s.default,vListdetails2:o.default}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[e._v("事件关联查询\n            "),a("div",{staticClass:"equipemnt-tools-btns"},[a("el-button",{attrs:{type:"success",size:"mini",plain:""},on:{click:e.refreshEvent}},[e._v("刷新事件组")])],1)]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingFrom,expression:"loadingFrom"}],staticClass:"event-search-condition",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("div",{staticStyle:{width:"384px"}},[a("span",{staticClass:"input-lable"},[e._v("日期范围")]),e._v(" "),a("el-date-picker",{staticStyle:{"border-radius":"0"},attrs:{type:"datetimerange","range-separator":"至",size:"mini","start-placeholder":"开始日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"end-placeholder":"结束日期"},on:{change:e.timeChanage},model:{value:e.timeArr,callback:function(t){e.timeArr=t},expression:"timeArr"}})],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("日志类型")]),e._v(" "),a("el-select",{staticStyle:{"border-radius":"0"},attrs:{size:"mini"},on:{change:e.logtypeChange},model:{value:e.eventSearchCondition["agent.type"],callback:function(t){e.$set(e.eventSearchCondition,"agent.type",t)},expression:"eventSearchCondition['agent.type']"}},e._l(e.logTypeOpt,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("事件名称")]),e._v(" "),a("el-select",{attrs:{size:"mini",clearable:"",filterable:""},model:{value:e.eventSearchCondition["event.action"],callback:function(t){e.$set(e.eventSearchCondition,"event.action",t)},expression:"eventSearchCondition['event.action']"}},e._l(e.eventList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("事件组")]),e._v(" "),a("el-select",{attrs:{size:"mini",clearable:""},model:{value:e.eventSearchCondition.event_group_id,callback:function(t){e.$set(e.eventSearchCondition,"event_group_id",t)},expression:"eventSearchCondition.event_group_id"}},e._l(e.eventGroup,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("目的地址")]),e._v(" "),a("el-input",{staticStyle:{"border-radius":"0"},attrs:{size:"mini",placeholder:""},model:{value:e.eventSearchCondition["fields.ip"],callback:function(t){e.$set(e.eventSearchCondition,"fields.ip",t)},expression:"eventSearchCondition['fields.ip']"}})],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("源地址")]),e._v(" "),a("el-input",{staticStyle:{"border-radius":"0"},attrs:{size:"mini",placeholder:""},model:{value:e.eventSearchCondition["source.ip"],callback:function(t){e.$set(e.eventSearchCondition,"source.ip",t)},expression:"eventSearchCondition['source.ip']"}})],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("事件类型")]),e._v(" "),a("el-input",{staticStyle:{"border-radius":"0"},attrs:{size:"mini",placeholder:""},model:{value:e.eventSearchCondition["winlog.task"],callback:function(t){e.$set(e.eventSearchCondition,"winlog.task",t)},expression:"eventSearchCondition['winlog.task']"}})],1),e._v(" "),a("el-button",{staticClass:"searchHttpLogs",attrs:{size:"mini",type:"primary"},on:{click:e.searchBtn}},[e._v("检索")])],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"event-search-content",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("v-basetable2",{attrs:{tableHead:e.tableHead,tableData:e.tableData}}),e._v(" "),a("div",{staticClass:"event-table-page"},[e._v("\n                共检索到事件数为 "),a("b",[e._v(e._s(e.allCounts))]),e._v("，最大展示\n                "),a("el-select",{staticClass:"maxSelect",staticStyle:{width:"84px"},attrs:{placeholder:"请选择",size:"mini"},on:{change:e.seletChange},model:{value:e.selectVal,callback:function(t){e.selectVal=t},expression:"selectVal"}},e._l(e.selectOption,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1),e._v(" 条\n                "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.size,total:e.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t},"update:current-page":function(t){e.c_page=t}}})],1)],1),e._v(" "),this.layerObj.layerState?a("div",[a("vListdetails2",{attrs:{baseConfig:this.baseConfig,detailsData:this.layerObj.detailData}})],1):e._e()])},staticRenderFns:[]};var u=a("VU/8")(d,v,!1,function(e){a("cEjW")},"data-v-1b6a0a1f",null);t.default=u.exports}});