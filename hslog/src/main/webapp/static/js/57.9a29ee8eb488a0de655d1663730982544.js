webpackJsonp([57],{I0cz:function(t,e){},mlim:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),n=a("ck3A"),r=a.n(n),l=a("62NR"),c=a("/sA3"),o={name:"alert",data:function(){var t=this;return{activeNames:[],loading:!1,snapshotDialog:!1,dateVal:[],param:{starttime:"",endtime:""},size:15,tableHead:[{prop:"run_time",label:"执行时间",width:"150",formatData:function(t,e){return'<span style="color: #F56C6C;">'+t+"</span>"}},{prop:"alert_conditions",label:"条件",width:"",formatData:function(e,a){return'<span style="color: #F56C6C;">'+t.setAlertCondition(e)+"</span>"}},{prop:"match_size",label:"匹配结果数",width:"90",formatData:function(t,e){return'<span style="color: #F56C6C;">'+t+"</span>"}},{prop:"state",label:"操作",width:"90",clickFun:function(e){t.showDialog(e)},formatData:function(t,e){return'<span style="color: #F56C6C;">快照详情</span>'}}],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},leftAlertData:[],rightAlertData:[],dialogObj:{alert_name:"",alert_conditions:'[{"field":"value","operator":">","value":"2000"}]',pre_index_name:"winlog",suffix_index_name:"*",alert_exec_cycle:"",alert_time:"",alert_exec_type:"",alert_time_type:"",alert_assetGroup_name:"",alert_equipment_name:"lihaaa-pc",msg:"[]"}}},created:function(){var t=new Date,e=new Date;e.setTime(e.getTime()-864e5*this.$store.state.beforeDay),this.dateVal=[Object(c.e)("yyyy-mm-dd HH:MM:SS",e),Object(c.e)("yyyy-mm-dd HH:MM:SS",t)],this.param.endtime=this.dateVal[1],this.param.starttime=this.dateVal[0],this.getAlertData(this.param)},methods:{setAlertCondition:function(t){var e="",a=JSON.parse(t);for(var i in a)"is one of"!==a[i].operator&&"is not one of"!==a[i].operator?e+=a[i].field+" "+a[i].operator+" "+a[i].value+"; ":e+=a[i].field+" "+a[i].operator+" "+a[i].values+"; ";return e},setAlertExcute:function(t){if("simple"===t.alert_exec_type){var e="";return"second"===t.alert_time_cycle_type?e="秒":"minute"===t.alert_time_cycle_type?e="分钟":"hour"===t.alert_time_cycle_type&&(e="小时"),""+t.alert_time_cycle_num+e}return t.alert_cron},setAlertTime:function(t){var e="",a=t.alert_time;if("simple"===t.alert_exec_type){var i="";return"second"===t.alert_time_cycle_type?i="秒":"minute"===t.alert_time_cycle_type?i="分钟":"hour"===t.alert_time_cycle_type&&(i="小时"),"最近"+t.alert_time_cycle_num+i}if("range"===t.alert_time_type){var s=a.split(",");""===s[0]&&(s[0]="*"),""===s[1]&&(s[1]="*"),e=s[0]+"至"+s[1]}else if("1-daying"===a)e="今天";else if("1-weeking"===a)e="这周";else if("1-monthing"===a)e="本月";else{var n=a.split("-");e="min"===n[1]?"最近"+n[0]+"分钟":"hour"===n[1]?"最近"+n[0]+"小时":"day"===n[1]?"最近"+n[0]+"天":"时间格式未知"}return e},timeChange:function(){this.activeNames=[],this.param.endtime=this.dateVal[1],this.param.starttime=this.dateVal[0],this.getAlertData(this.param)},headClick:function(t){t.firstSearched||(this.getExecuteList(t,1),t.firstSearched=!0)},getAlertData:function(t){var e=this;this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/alert/getAlertFireInfo.do",e.$qs.stringify(t)).then(function(t){e.loading=!1;var a=t.data;"true"===a.success?(e.leftAlertData=[],e.rightAlertData=[],a.data.forEach(function(t,a){a%2==0?e.leftAlertData.push(t):e.rightAlertData.push(t)})):layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})})},getExecuteList:function(t,e){var a=this;this.$nextTick(function(){a.loading=!0,a.$axios.post(a.$baseUrl+"/alert/getAlertFireList.do",a.$qs.stringify({alert_id:t.alert_id,pageIndex:e,pageSize:a.size,starttime:a.dateVal[0],endtime:a.dateVal[1]})).then(function(e){a.loading=!1;var i=e.data;"true"===i.success?(t.fire_count=i.data.count,t.fire_list=i.data.list):layer.msg(i.message,{icon:5})}).catch(function(t){a.loading=!1})})},showDialog:function(t){this.snapshotDialog=!0;var e=JSON.parse(s()(t));e.result=JSON.parse(e.result),this.dialogObj=e},handleCurrentChange:function(t,e){e.current_page=t,this.getExecuteList(e,t)}},components:{jsonView:r.a,vBasetable:l.default}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"content-bg",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("div",{staticClass:"top-title"},[t._v("告警\n            "),a("div",{staticClass:"data-box"},[t._v("\n                日期范围:\n                "),a("el-date-picker",{staticClass:"date-wapper",attrs:{type:"datetimerange","range-separator":"至",size:"mini",clearable:!1,"start-placeholder":"开始日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"end-placeholder":"结束日期","picker-options":t.pickerOptions},on:{change:t.timeChange},model:{value:t.dateVal,callback:function(e){t.dateVal=e},expression:"dateVal"}})],1)]),t._v(" "),a("div",{staticClass:"alert-wapper"},[a("el-collapse",{staticStyle:{width:"100%",display:"flex","flex-wrap":"wrap"},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[a("div",{staticClass:"left-wapper",staticStyle:{width:"50%"}},t._l(t.leftAlertData,function(e,i){return a("el-collapse-item",{key:i,staticClass:"alert-item",attrs:{name:i}},[a("template",{slot:"title"},[a("div",{staticClass:"tit-wapper",on:{click:function(a){return t.headClick(e)}}},[a("div",{staticClass:"i-wapper"},[a("i",{staticClass:"el-icon-warning"})]),t._v(" "),a("div",{staticClass:"txt-wapper"},[a("p",{staticClass:"txt-top"},[t._v(t._s(e.alert_name))]),t._v(" "),a("p",{staticClass:"txt-bottom"},[t._v(" 告警条件:"+t._s(t.setAlertCondition(e.alert_conditions)))])]),t._v(" "),a("div",{staticClass:"count-wapper"},[t._v("\n                                    告警次数: "),a("b",[t._v(t._s(Number(e.fire_count)))])])])]),t._v(" "),a("p",{staticStyle:{margin:"10px 0",color:"#e4956d"}},[t._v("执行详情（快照）")]),t._v(" "),a("div",{staticClass:"execute-wapper"},[a("vBasetable",{attrs:{tableHead:t.tableHead,height:200,tableData:e.fire_list}}),t._v(" "),a("div",{staticClass:"alarm-table-page"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.current_page,"page-size":t.size,total:Number(e.fire_count)},on:{"current-change":function(a){return t.handleCurrentChange(a,e)},"update:currentPage":function(a){return t.$set(e,"current_page",a)},"update:current-page":function(a){return t.$set(e,"current_page",a)}}})],1)],1)],2)}),1),t._v(" "),a("div",{staticClass:"right-wapper",staticStyle:{width:"50%"}},t._l(t.rightAlertData,function(e,i){return a("el-collapse-item",{key:i,staticClass:"alert-item"},[a("template",{slot:"title"},[a("div",{staticClass:"tit-wapper",on:{click:function(a){return t.headClick(e)}}},[a("div",{staticClass:"i-wapper"},[a("i",{staticClass:"el-icon-warning"})]),t._v(" "),a("div",{staticClass:"txt-wapper"},[a("p",{staticClass:"txt-top"},[t._v(t._s(e.alert_name))]),t._v(" "),a("p",{staticClass:"txt-bottom"},[t._v("告警条件:"+t._s(t.setAlertCondition(e.alert_conditions)))])]),t._v(" "),a("div",{staticClass:"count-wapper"},[t._v("\n                                    告警次数: "),a("b",[t._v(t._s(Number(e.fire_count)))])])])]),t._v(" "),a("p",{staticStyle:{margin:"10px 0",color:"#e4956d"}},[t._v("执行详情（快照）")]),t._v(" "),a("div",{staticClass:"execute-wapper"},[a("vBasetable",{attrs:{tableHead:t.tableHead,height:200,tableData:e.fire_list}}),t._v(" "),a("div",{staticClass:"alarm-table-page"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.current_page,"page-size":t.size,total:Number(e.fire_count)},on:{"current-change":function(a){return t.handleCurrentChange(a,e)},"update:currentPage":function(a){return t.$set(e,"current_page",a)},"update:current-page":function(a){return t.$set(e,"current_page",a)}}})],1)],1)],2)}),1)])],1),t._v(" "),a("el-dialog",{attrs:{title:"快照详情",visible:t.snapshotDialog,width:"800px"},on:{"update:visible":function(e){t.snapshotDialog=e}}},[a("div",{staticClass:"snapshot-wapper"},[a("p",[a("span",{staticClass:"tit"},[t._v("告警名称 :")]),t._v(" "),a("span",{staticClass:"txt"},[t._v(t._s(t.dialogObj.alert_name))])]),t._v(" "),a("p",[a("span",{staticClass:"tit"},[t._v("数据源 :")]),t._v(" "),a("span",{staticClass:"txt"},[t._v(t._s(t.dialogObj.pre_index_name)+t._s(t.dialogObj.suffix_index_name))])]),t._v(" "),a("p",[a("span",{staticClass:"tit"},[t._v("条件 :")]),t._v(" "),a("span",{staticClass:"txt"},[t._v(t._s(t.setAlertCondition(t.dialogObj.alert_conditions)))])]),t._v(" "),a("p",[a("span",{staticClass:"tit"},[t._v("匹配结果数 :")]),t._v(" "),a("span",{staticClass:"txt"},[t._v(t._s(t.dialogObj.match_size))])]),t._v(" "),a("p",[a("span",{staticClass:"tit"},[t._v("执行周期 :")]),t._v(" "),a("span",{staticClass:"txt"},[t._v(t._s(t.setAlertExcute(t.dialogObj)))])]),t._v(" "),a("p",[a("span",{staticClass:"tit"},[t._v("时间周期 :")]),t._v(" "),a("span",{staticClass:"txt"},[t._v(t._s(t.setAlertTime(t.dialogObj)))])]),t._v(" "),a("p",[a("span",{staticClass:"tit"},[t._v("结果 :")]),t._v(" "),a("span",{staticClass:"txt"},[a("jsonView",{staticClass:"jsonView",attrs:{data:t.dialogObj.result,theme:"one-dark","line-height":20,deep:5}})],1)])])])],1)},staticRenderFns:[]};var _=a("VU/8")(o,p,!1,function(t){a("I0cz")},"data-v-67292f63",null);e.default=_.exports}});