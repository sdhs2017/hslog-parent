webpackJsonp([59],{"2QwF":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("ID1p"),i=a("62NR"),r=a("K3LF"),l=(a("/sA3"),a("8+FI")),o={name:"eventAlarm",data:function(){var e=this;return{trueB:!0,falseB:!1,editId:"",loading:!1,formLoading:!1,formState:!1,defaultFilter:[],indexName:{template_name:"winlogbeat-",pre_index_name:"winlogbeat-",suffix_index_name:"*"},form:{event_type:"",event_name:"",event_area_num:"",event_filters:"",alert_count:1,event_action_range:"all",event_alert_name:"",event_area_unit:"second",alert_equipment_id:"",alert_assetGroup_id:""},timeIntervalArr:[{value:"second",label:"秒"},{value:"minute",label:"分钟"},{value:"hour",label:"小时"}],eqTypeArr:[{value:"03",label:"主机",children:[{value:"0301",label:"Windows"},{value:"0302",label:"Linux"}]}],actionRange:[{label:"全局",value:"all"},{label:"资产",value:"equipment"},{label:"资产组",value:"asset_group"}],eventType:[],eventArr:[],assetGroupOptions:[],assetOptions:[],page:1,c_page:1,size:15,busName:"searchEventAlarm",busFilterName:"eventAlarmFilter",tableBusName:{selectionName:"eventAlarmDelect"},allCounts:0,tableHead:[{prop:"event_alert_name",label:"告警名称",width:""},{prop:"event_action_range",label:"告警范围",width:"",formatData:function(e,t){return"all"===e?"全局":"equipment"===e?"资产":"资产组"}},{prop:"event_action_range_name",label:"资产/资产组",width:""},{prop:"event_type",label:"资产类型",width:"",formatData:function(t,a){var n="",i=t.substring(0,2);for(var r in e.eqTypeArr){var l=e.eqTypeArr[r];if(l.value==i){for(var o in n+=l.label+"-",l.children)if(l.children[o].value==t){n+=l.children[o].label;break}break}}return n}},{prop:"event_name_en_cn",label:"事件名称",width:""},{prop:"alert_count",label:"告警条件",width:"",formatData:function(e,t){return"事件数>= "+e}},{prop:"event_area_num",label:"事件时间间隔",width:"",formatData:function(e,t){var a="";return"second"===t.event_area_unit?a="秒":"minute"===t.event_area_unit?a="分钟":"hour"===t.event_area_unit&&(a="小时"),e+a}},{prop:"tools",label:"操作",width:"",btns:[{icon:"el-icon-edit",text:"修改",clickFun:function(t,a){e.formState=!0,e.editId=t.event_alert_id,e.getEventInfo()}}]}],tableData:[],conditionFrom:{event_alert_name:"",event_type:"",event_name:"",alert_equipment_id:"",alert_assetGroup_id:"",event_action_range:""},delectAlarmIds:""}},created:function(){var e=this;this.getEventType(),this.getEvent(""),this.getAssetGroup(),this.getAsset(""),this.getList(1,this.conditionFrom),l.default.$on(this.busName,function(t){e.conditionFrom=t,e.getAlarmList(e.conditionFrom,1),e.c_page=1}),l.default.$on(this.tableBusName.selectionName,function(t){for(var a in e.delectAlarmIds="",t)e.delectAlarmIds+=t[a].event_alert_id+","}),l.default.$on(this.busFilterName,function(t){e.form.event_filters=t})},watch:{formState:function(){this.formState?(this.form.event_alert_name="",this.getEventType(),this.getAssetGroup(),""===this.editId&&this.getAsset("")):(this.editId="",this.initialize(),this.getAsset(""),this.getEvent(""),this.form.event_alert_name="")},alertName:function(e,t){this.form.event_alert_name=e}},computed:{alertName:function(){var e="all"===this.form.event_action_range?"全局":"equipment"===this.form.event_action_range?"资产":"资产组",t="";for(var a in this.eventArr)this.eventArr[a].value===this.form.event_name&&(t=this.eventArr[a].label);var n=t.split("（");return n.length>1?n[0]+"-"+e+"（"+n[1]:n[0]+"-"+e}},methods:{initialize:function(){this.defaultFilter=[],this.form={event_type:"",event_name:"",event_area_num:"",event_filters:"",alert_count:1,event_action_range:"all",event_alert_name:"",event_area_unit:"second",alert_equipment_id:"",alert_assetGroup_id:""}},refresh:function(){this.getList(1,this.conditionFrom)},searchFunc:function(){this.getList(1,this.conditionFrom)},getList:function(e,t){var a=this,n=t;n.pageIndex=e,n.pageSize=this.size,this.$nextTick(function(){a.loading=!0,a.$axios.post(a.$baseUrl+"/eventAlert/getEventAlertList.do",a.$qs.stringify(n)).then(function(e){a.loading=!1;var t=e.data;"true"==t.success?(a.allCounts=Number(t.data[0].count),a.tableData=t.data[0].list):layer.msg(t.message,{icon:5})}).catch(function(e){a.loading=!1})})},getEventType:function(){var e=this;this.$nextTick(function(){e.formLoading=!0,e.$axios.post(e.$baseUrl+"/eventAlert/getEventType.do","").then(function(t){e.formLoading=!1;var a=t.data;"true"==a.success?e.eventType=a.data:layer.msg(a.message,{icon:5})}).catch(function(t){e.formLoading=!1})})},eventTypeChangeSearch:function(e){this.conditionFrom.event_name="";var t="";t=e?e[1]:"",this.conditionFrom.event_type=t,this.getEvent(t)},eventTypeChange:function(e){var t="";t=e?e[1]:"",this.form.event_type=t,this.form.event_name="",this.getEvent(t),this.form.alert_equipment_id="",this.getAsset(t)},getEvent:function(e){var t=this;this.$nextTick(function(){t.formLoading=!0,t.$axios.post(t.$baseUrl+"/eventAlert/getEventByType.do",t.$qs.stringify({event_type:e})).then(function(e){t.formLoading=!1;var a=e.data;"true"==a.success?t.eventArr=a.data:layer.msg(a.message,{icon:5})}).catch(function(e){t.formLoading=!1})})},addAlarm:function(){var e=this;this.checkParam()&&this.$nextTick(function(){e.formLoading=!0,e.$axios.post(e.$baseUrl+"/eventAlert/save.do",e.$qs.stringify(e.form)).then(function(t){e.formLoading=!1;var a=t.data;"true"==a.success?(layer.msg(a.message,{icon:1}),e.formState=!1,e.getList(1,{})):layer.msg(a.message,{icon:5})}).catch(function(t){e.formLoading=!1})})},getEventInfo:function(){var e=this;this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/eventAlert/getEventAlertInfo.do",e.$qs.stringify({event_alert_id:e.editId})).then(function(t){e.loading=!1;var a=t.data;"true"==a.success?(e.form=a.data,e.getEvent(a.data.event_type),e.getAsset(a.data.event_type),e.defaultFilter=JSON.parse(a.data.event_filters)):layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})})},reviseAlarm:function(){var e=this;this.checkParam()&&this.$nextTick(function(){e.formLoading=!0,e.$axios.post(e.$baseUrl+"/eventAlert/update.do",e.$qs.stringify(e.form)).then(function(t){e.formLoading=!1;var a=t.data;"true"==a.success?(layer.msg(a.message,{icon:1}),e.formState=!1,e.editId="",e.getList(1,{})):layer.msg(a.message,{icon:5})}).catch(function(t){e.formLoading=!1})})},checkParam:function(){return""===this.form.event_type?(layer.msg("资产类型不能为空",{icon:5}),!1):""===this.form.event_name?(layer.msg("事件名称不能为空",{icon:5}),!1):"equipment"===this.form.event_action_range&&""===this.form.alert_equipment_id?(layer.msg("资产不能为空",{icon:5}),!1):"asset_group"===this.form.event_action_range&&""===this.form.alert_assetGroup_id?(layer.msg("资产组不能为空",{icon:5}),!1):""===this.form.event_alert_name?(layer.msg("告警名称不能为空",{icon:5}),!1):this.form.event_area_num<=0?(layer.msg("事件时间间隔不合法",{icon:5}),!1):!(this.form.alert_count<=0)||(layer.msg("告警条件不合法",{icon:5}),!1)},deleteAlarm:function(){var e=this;layer.confirm("您确定删除么？",{btn:["确定","取消"]},function(t){e.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/eventAlert/delete.do",e.$qs.stringify({event_alert_ids:e.delectAlarmIds})).then(function(t){e.loading=!1;var a=t.data;"true"==a.success?(layer.msg(a.message,{icon:1}),e.getList(1,e.conditionFrom)):layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})})},function(){layer.close()})},handleCurrentChange:function(e){this.getList(e,this.conditionFrom)},getAssetGroup:function(){var e=this;this.$nextTick(function(){e.formLoading=!0,e.$axios.post(e.$baseUrl+"/assetGroup/getAssetGroupList4EventAlertCombobox.do",e.$qs.stringify()).then(function(t){e.formLoading=!1;var a=t.data;(a.success="true")?e.assetGroupOptions=a.data:layer.msg(a.message,{icon:5})}).catch(function(t){e.formLoading=!1})})},assetGroupChangeSearch:function(e){this.getAsset(e)},assetGroupChange:function(e){this.getAsset(e)},getAsset:function(e){var t=this;this.$nextTick(function(){t.formLoading=!0,t.$axios.post(t.$baseUrl+"/assetGroup/getAssetList4EventAlertCombobox.do",t.$qs.stringify({equipment_type:e})).then(function(e){t.formLoading=!1;var a=e.data;(a.success="true")?t.assetOptions=a.data:layer.msg(a.message,{icon:5})}).catch(function(e){t.formLoading=!1})})}},components:{vBasetable:i.default,vSearchForm:n.default,queryFilter:r.default}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"content-bg",attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("div",{staticClass:"top-title"},[e._v("事件告警管理\n            "),a("div",{staticClass:"btn-wapper"},[a("el-button",{attrs:{type:"danger",size:"mini",plain:"",disabled:!(e.delectAlarmIds.length>0)},on:{click:e.deleteAlarm}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){e.formState=!0}}},[e._v("添加")]),e._v(" "),a("el-button",{attrs:{type:"success",size:"mini",plain:""},on:{click:e.refresh}},[e._v("刷新")])],1)]),e._v(" "),a("div",{staticClass:"search-wapper"},[a("div",[a("span",{staticClass:"input-lable"},[e._v("告警名称")]),e._v(" "),a("el-input",{attrs:{size:"mini",placeholder:""},model:{value:e.conditionFrom.event_alert_name,callback:function(t){e.$set(e.conditionFrom,"event_alert_name",t)},expression:"conditionFrom.event_alert_name"}})],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("告警范围")]),e._v(" "),a("el-select",{staticStyle:{width:"150px"},attrs:{size:"mini",clearable:"",filterable:""},model:{value:e.conditionFrom.event_action_range,callback:function(t){e.$set(e.conditionFrom,"event_action_range",t)},expression:"conditionFrom.event_action_range"}},e._l(e.actionRange,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("资产类型")]),e._v(" "),a("el-cascader",{attrs:{size:"mini",clearable:"",options:e.eqTypeArr},on:{change:e.eventTypeChangeSearch},model:{value:e.conditionFrom.event_type,callback:function(t){e.$set(e.conditionFrom,"event_type",t)},expression:"conditionFrom.event_type"}})],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("事件名称")]),e._v(" "),a("el-select",{attrs:{size:"mini",clearable:"",filterable:""},on:{change:function(e){}},model:{value:e.conditionFrom.event_name,callback:function(t){e.$set(e.conditionFrom,"event_name",t)},expression:"conditionFrom.event_name"}},e._l(e.eventArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("资产组")]),e._v(" "),a("el-select",{attrs:{size:"mini",clearable:"",filterable:""},model:{value:e.conditionFrom.alert_assetGroup_id,callback:function(t){e.$set(e.conditionFrom,"alert_assetGroup_id",t)},expression:"conditionFrom.alert_assetGroup_id"}},e._l(e.assetGroupOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("span",{staticClass:"input-lable"},[e._v("资产")]),e._v(" "),a("el-select",{attrs:{size:"mini",clearable:"",filterable:""},model:{value:e.conditionFrom.alert_equipment_id,callback:function(t){e.$set(e.conditionFrom,"alert_equipment_id",t)},expression:"conditionFrom.alert_equipment_id"}},e._l(e.assetOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-button",{staticClass:"searchBtn",attrs:{size:"mini",type:"primary"},on:{click:e.searchFunc}},[e._v("检索")])],1),e._v(" "),a("div",{staticClass:"alarm-list-wapper"},[a("vBasetable",{attrs:{selection:!0,tableHead:e.tableHead,tableData:e.tableData,busName:e.tableBusName}})],1),e._v(" "),a("div",{staticClass:"alarm-table-page"},[a("span",[e._v("共检索到告警数量为 "),a("b",[e._v(e._s(e.allCounts))]),e._v(" 个")]),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.c_page,"page-size":e.size,total:e.allCounts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.c_page=t},"update:current-page":function(t){e.c_page=t}}})],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],attrs:{title:""===e.editId?"添加":"修改",visible:e.formState,width:"500px","element-loading-background":"rgba(48, 62, 78, 0.5)","close-on-click-modal":e.falseB},on:{"update:visible":function(t){e.formState=t}}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"告警名称:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-input",{staticClass:"item",staticStyle:{width:"90%"},attrs:{size:"mini",placeholder:"会根据下列选择自动填充"},model:{value:e.form.event_alert_name,callback:function(t){e.$set(e.form,"event_alert_name",t)},expression:"form.event_alert_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-cascader",{staticStyle:{width:"90%"},attrs:{emitPath:e.falseB,options:e.eqTypeArr},on:{change:e.eventTypeChange},model:{value:e.form.event_type,callback:function(t){e.$set(e.form,"event_type",t)},expression:"form.event_type"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"告警范围:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-select",{staticStyle:{width:"28%"},attrs:{size:"mini",placeholder:"请选择"},model:{value:e.form.event_action_range,callback:function(t){e.$set(e.form,"event_action_range",t)},expression:"form.event_action_range"}},e._l(e.actionRange,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),"asset_group"===e.form.event_action_range?a("el-select",{staticStyle:{width:"61%"},attrs:{filterable:"",placeholder:"",size:"mini"},model:{value:e.form.alert_assetGroup_id,callback:function(t){e.$set(e.form,"alert_assetGroup_id",t)},expression:"form.alert_assetGroup_id"}},e._l(e.assetGroupOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1):e._e(),e._v(" "),"equipment"===e.form.event_action_range?a("el-select",{staticStyle:{width:"61%"},attrs:{filterable:"",placeholder:"",size:"mini"},model:{value:e.form.alert_equipment_id,callback:function(t){e.$set(e.form,"alert_equipment_id",t)},expression:"form.alert_equipment_id"}},e._l(e.assetOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"事件名称:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-select",{staticStyle:{width:"90%"},attrs:{size:"mini",filterable:"",placeholder:"先选择资产类型"},model:{value:e.form.event_name,callback:function(t){e.$set(e.form,"event_name",t)},expression:"form.event_name"}},e._l(e.eventArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"事件时间间隔:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v(" "),a("el-input",{staticClass:"item",staticStyle:{width:"59%"},attrs:{size:"mini",type:"number",min:"1"},model:{value:e.form.event_area_num,callback:function(t){e.$set(e.form,"event_area_num",t)},expression:"form.event_area_num"}}),e._v(" "),a("el-select",{staticStyle:{width:"30%"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.form.event_area_unit,callback:function(t){e.$set(e.form,"event_area_unit",t)},expression:"form.event_area_unit"}},e._l(e.timeIntervalArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("p",{staticStyle:{"font-size":"10px",color:"#e4956d"}},[e._v("两个事件的时间间隔小于该数值时，会合并为一个时间区间。")])],1),e._v(" "),a("el-form-item",{attrs:{label:"告警条件:"}},[a("span",{staticStyle:{color:"red",position:"absolute",left:"-10px"}},[e._v("*")]),e._v("\n                    事件数>=\n                    "),a("el-input",{staticClass:"item",staticStyle:{width:"50%"},attrs:{size:"mini",type:"number",min:"1"},model:{value:e.form.alert_count,callback:function(t){e.$set(e.form,"alert_count",t)},expression:"form.alert_count"}}),e._v(" "),a("p",{staticStyle:{"font-size":"10px",color:"#e4956d"}},[e._v("合并后的时间区间内事件发生次数的阈值。")])],1),e._v(" "),a("el-form-item",{attrs:{label:"筛选条件:"}},[a("queryFilter",{staticStyle:{"line-height":"15px"},attrs:{busFilterName:this.busFilterName,defaultFilterArr:this.defaultFilter,queryState:!1,useObject:"chart",templateName:this.indexName.template_name,preIndexName:this.indexName.pre_index_name,suffixIndexName:this.indexName.suffix_index_name}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){""===e.editId?e.addAlarm():e.reviseAlarm()}}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:function(t){e.formState=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(o,s,!1,function(e){a("uMbI")},"data-v-641fa2bc",null);t.default=c.exports},uMbI:function(e,t){}});