webpackJsonp([103],{"4R2q":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("ID1p"),l=a("AIWI"),r=a("8+FI"),s={name:"accurateSearch",data:function(){return{layerObj:{detailData:{},layerState:!1},busName:"accurateSeatch",words:"",searchConditions:{},searchUrl:"log/getLogListByBlend.do",formConditionsArr:[],tableHead:[],firstSearch:!0,logBaseJson:[],logType:[],logLevel:[],levelVal:"",progressRight:"right:-90px;",progressTitle:'导出中<br/><i class="el-icon-loading"></i>',progressVal:"",exportInternal:""}},created:function(){var e=this;this.tableHead=[{prop:"logtime",label:"时间",width:"150"},{prop:"operation_level",label:"级别",width:"100"},{prop:"type",label:"日志类型",width:"100"},{prop:"equipmentname",label:"资产名称",width:"125",clickFun:function(t){"unknown"===t.equipmentid?layer.msg("资产未知",{icon:5}):e.$router.push({name:"equipment",params:{equipmentid:t.equipmentid}})}},{prop:"ip",label:"IP",width:"125"},{prop:"operation_des",label:"日志内容",width:""},{prop:"tools",label:"操作",width:"60",btns:[{icon:"el-icon-tickets",text:"查看详情",btnType:"readDetails",clickFun:function(t,a){e.layerObj.layerState=!0,e.layerObj.detailData=t}},{icon:"el-icon-circle-close",text:"删除",btnType:"removeItem",clickFun:function(t,a){e.$refs.logContent.removeParams([t])}}]}],this.getLogType(),this.formConditionsArr=[{label:"事件范围",type:"datetimerange",itemType:"",paramName:"time",model:{model:[]},val:""},{label:"日志类型",paramName:"type",type:"select",itemType:"",model:{model:""},options:this.logType},{label:"日志级别",paramName:"operation_level",type:"select",itemType:"multiple",model:{model:this.levelVal},options:this.logLevel},{label:"IP地址",paramName:"ip",itemType:"",model:{model:""},type:"input"},{label:"资产名称",paramName:"hostname",model:{model:""},itemType:"",type:"input"}],r.default.$on(this.busName,function(t){console.log(t),e.searchConditions=t}),r.default.$on("logTypeChange",function(t){e.logLevel.length=0,e.levelVal="";for(var a=0;a<e.logBaseJson.length;a++)if(e.logBaseJson[a].type==t)for(var o=0;o<e.logBaseJson[a].level.length;o++){var l={value:e.logBaseJson[a].level[o],label:e.logBaseJson[a].level[o]};e.logLevel.push(l)}}),localStorage.getItem("exportLogs")&&(this.progressRight="right:5px;",this.progressTitle="导出中<br/>...",this.exportInternal=setInterval(this.updataProgressValue,1e3)),r.default.$on("exportStart",function(t){e.progressRight="right:5px;",e.exportInternal=setInterval(e.updataProgressValue,1e3)}),r.default.$on("exportFail",function(t){e.progressRight="right:-90px;",layer.msg("导出失败",{icon:5}),clearInterval(e.exportInternal),localStorage.removeItem("exportLogs")})},watch:{$route:function(e,t){}},methods:{getLogType:function(){var e=this;this.$nextTick(function(){e.$axios.get("static/filejson/logTypeLevel.json",{}).then(function(t){e.logBaseJson=t.data,e.logType.push({value:"",label:"全部"});for(var a=0;a<t.data.length;a++){var o={value:t.data[a].type,label:t.data[a].type};e.logType.push(o)}}).catch(function(e){console.log(e)})})},updataProgressValue:function(){var e=this;this.$nextTick(function(){e.$axios.get(e.$baseUrl+"/log/getExportProcess.do",{}).then(function(t){"finished"===t.data[0].state?(clearInterval(e.exportInternal),e.progressTitle="导出<br/>完成",e.progressVal=t.data[0].value,setTimeout(function(){e.progressRight="right:-90px;"},5e3),setTimeout(function(){e.progressTitle="导出中<br/>...",e.progressVal=""},5300),layer.msg("导出成功",{icon:1}),localStorage.removeItem("exportLogs")):e.progressVal=t.data[0].value}).catch(function(e){console.log(e)})})}},components:{vSearchForm:o.default,vLogscontent:l.default}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-bg"},[a("div",{staticClass:"top-title"},[e._v("精确查询")]),e._v(" "),a("div",{staticClass:"search-wapper"},[a("v-search-form",{attrs:{formItem:e.formConditionsArr,busName:e.busName}})],1),e._v(" "),a("div",{staticClass:"content-wapper"},[a("v-logscontent",{ref:"logContent",attrs:{searchConditions:e.searchConditions,tableHead:e.tableHead,searchUrl:e.searchUrl,exportBtn:!0,layerObj:e.layerObj,moreDeleteBtn:!0}})],1),e._v(" "),a("div",{staticClass:"export-progress-box",style:e.progressRight},[a("div",{staticClass:"export-progress-wapper"},[a("div",{staticClass:"progress-name",domProps:{innerHTML:e._s(e.progressTitle)}}),e._v(" "),a("div",{staticClass:"progress-val"},[e._v(e._s(e.progressVal))])])])])},staticRenderFns:[]};var i=a("VU/8")(s,n,!1,function(e){a("MSTE")},"data-v-1ae6d1cb",null);t.default=i.exports},MSTE:function(e,t){}});