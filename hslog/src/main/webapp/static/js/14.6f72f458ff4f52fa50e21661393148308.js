webpackJsonp([14],{"4Jb0":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),l=a.n(i),r=a("cUU5"),s=a("PNLW"),o=a("K3LF"),n=a("ck3A"),c=a.n(n),m=a("/sA3"),u=a("8+FI"),d={name:"alarmFrom",props:{formType:{type:String,default:function(){return""}},alarmId:{type:String,default:function(){return""}},url:{type:String,default:function(){return""}},defaultFrom:{type:Object},busNameObj:{type:Object,default:function(){return{busIndexName:"",busFilterName:"",busDateName:""}}}},data:function(){return{changeOver:!1,configOpened:["1","2"],JSONData:{},loading:!1,alarmLoading:!1,leftYLoading:!1,leftXLoading:!1,active:0,indexVal:[],defaultVal:{lastVal:"15-min",starttime:"",endtime:"",dateBlock:!1,isIntervalBox:!1,intervalState:!1,intervalVal:"",intervalType:"",dateUnit:"min",dateCount:"15",commonlyVal:"",changeState:!0},form:{alert_name:"",template_name:"",pre_index_name:"",suffix_index_name:"",alert_exec_type:"simple",alert_time_cycle_num:"15",alert_time_cycle_type:"second",alert_assetGroup_id:"",alert_equipment_id:"",datefield:"",alert_search_filters:"",alert_cron:"",alert_note:"",alert_search_metric:[],alert_search_bucket:[],alert_conditions:[],alert_structure:"",alert_time:"15-min",alert_time_type:"last"},paramObj:{},defaultFilter:[],xAxisArr:[],yAxisArr:[],yAggregation:[{value:"Count",label:"Count"},{value:"Sum",label:"Sum"},{value:"Average",label:"Average"},{value:"Max",label:"Max"},{value:"Min",label:"Min"}],xAggregation:[{value:"Terms",label:"Terms"},{value:"Range",label:"Range"},{value:"Date Histogram",label:"Date Histogram"},{value:"Date Range",label:"Date Range"},{value:"IPv4 Range",label:"IPv4 Range"}],assetGroupOptions:[],assetOptions:[],timeIntervalArr:[{value:"minute",label:"分钟"},{value:"hourly",label:"小时"},{value:"daily",label:"天"},{value:"weekly",label:"周"},{value:"monthly",label:"月"},{value:"yearly",label:"年"}],alarmDialog:!1,dialogType:"add",alarmList:[],formDialog:{field:"",fieldType:"",operator:"",value:"",start:"",end:"",values:[]},fieldType:{},formQueryVal:"",fieldOpt:[],operatorOpt:[],addFromValue:"",currentIndex:0}},created:function(){var e=this;this.getAssetGroup(),this.getAsset(),u.default.$on(this.busNameObj.busIndexName,function(t){e.yAxisArr=[],e.xAxisArr=[],e.form.alert_search_filters="",e.form.alert_search_metric=[],e.form.alert_search_bucket=[],e.form.alert_structure="",e.form.suffix_index_name=t[2],e.form.pre_index_name=t[1],e.form.template_name=t[0],e.form.datefield=t[3]}),u.default.$on(this.busNameObj.busFilterName,function(t){e.form.alert_search_filters=t}),u.default.$on(this.busNameObj.busDateName,function(t){e.defaultVal=t;var a=Object(m.n)(t)[0];""===a.last?(e.form.alert_time_type="range",e.form.alert_time=a.starttime+","+a.endtime):(e.form.alert_time_type="last",e.form.alert_time=a.last)})},beforeDestroy:function(){u.default.$off(this.busNameObj.busIndexName),u.default.$off(this.busNameObj.busFilterName),u.default.$off(this.busNameObj.busDateName)},watch:{defaultFrom:function(){var e=this;if(this.alarmId){for(var t in this.form)this.form[t]=this.defaultFrom[t];this.form.alert_search_filters?this.defaultFilter=JSON.parse(this.form.alert_search_filters):this.defaultFilter=[];var a=JSON.parse(this.form.alert_structure);if(this.form.datefield=a.dateField,this.indexVal=[this.form.template_name,this.form.pre_index_name,this.form.suffix_index_name,this.form.datefield],this.alarmList=JSON.parse(this.form.alert_conditions),this.xAxisArr=a.buckets,this.yAxisArr=a.mertics,0!==this.xAxisArr.length)for(var i in this.xAxisArr)this.getXAggregationArr(this.xAxisArr[i].aggregationType,i);if(0!==this.yAxisArr.length)for(var l in this.yAxisArr)this.getYAggregationArr(this.yAxisArr[l].aggregationType,l);this.defaultVal=a.date,setTimeout(function(){e.changeOver=!0},1500),this.getAssetGroup(),this.getAsset(this.form.alert_assetGroup_id)}},alarmDialog:function(){this.alarmDialog?this.getFieldData():this.formDialog={field:"",fieldType:"",operator:"",value:"",start:"",end:"",values:[]}},"form.suffix_index_name":function(){this.clearAlertCondition()},"form.alert_exec_type":function(){this.clearAlertCondition()},"form.alert_time_cycle_num":function(){this.clearAlertCondition()},"form.alert_time_cycle_type":function(){this.clearAlertCondition()},"form.alert_cron":function(){this.clearAlertCondition()},"form.alert_time":function(){this.clearAlertCondition()},xAxisArr:{handler:function(){var e=this;this.$nextTick(function(){e.clearAlertCondition()})},immediate:!1,deep:!0},yAxisArr:{handler:function(){var e=this;this.$nextTick(function(){e.clearAlertCondition()})},immediate:!1,deep:!0},active:function(){0===this.active?this.alarmId:1===this.active&&this.alarmId}},computed:{isCanCreate1:function(){var e=!1,t=!1,a=!1;return""===this.form.suffix_index_name&&(e="disabled"),this.yAxisArr.forEach(function(e){""===e.aggregationType?t="disabled":""===e.aggregationParam&&"Count"!==e.aggregationType&&(t="disabled")}),this.xAxisArr.forEach(function(e){""===e.aggregationType?a="disabled":""===e.aggregationParam&&"Count"!==e.aggregationType&&(a="disabled")}),(0!=e||0!=t||0!=a)&&"disabled"}},methods:{nextToOne:function(){var e=this;"complex"===this.form.alert_exec_type?this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/alert/cronValid.do",e.$qs.stringify({alert_cron:e.form.alert_cron})).then(function(t){e.loading=!1;var a=t.data;"true"===a.success?e.active=1:layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})}):this.active=1},clearAlertCondition:function(){this.alarmId&&this.changeOver},timeCycleNumChange:function(e){this.form.alert_time_cycle_num=Math.floor(e),this.form.alert_time_cycle_num<=0?this.form.alert_time_cycle_num=1:"second"===this.form.alert_time_cycle_type||"minute"===this.form.alert_time_cycle_type?e>59&&(this.form.alert_time_cycle_num=59):e>23&&(this.form.alert_time_cycle_num=23)},timeCycleTypeChange:function(e){"second"===e||"minute"===e?this.form.alert_time_cycle_num>59&&(this.form.alert_time_cycle_num=59):this.form.alert_time_cycle_num>23&&(this.form.alert_time_cycle_num=23)},initialize:function(){this.form.alert_name="",this.form.alert_cron="",this.form.alert_note="",this.form.alert_assetGroup_id="",this.form.alert_equipment_id="",this.form.alert_exec_type="simple",this.form.alert_time_cycle_num="",this.form.alert_time_cycle_type="second",this.form.alert_search_filters="",this.form.alert_search_metric=[],this.form.alert_search_bucket=[],this.form.alert_conditions=[],this.form.alert_structure="",this.form.alert_time="15-min",this.form.alert_time_type="last",this.alarmList=[],this.yAxisArr=[],this.xAxisArr=[],this.defaultVal={lastVal:"15-min",starttime:"",endtime:"",dateBlock:!1,isIntervalBox:!1,intervalState:!1,intervalVal:"",intervalType:"",dateUnit:"min",dateCount:"15",commonlyVal:"",changeState:!0}},yAggregationChange:function(e,t){""!==this.form.pre_index_name&&""!==this.form.suffix_index_name&&""!==this.form.template_name?(this.yAxisArr[t].aggregationParam="",this.yAxisArr[t].aggregationParamArr=[],this.getYAggregationArr(e,t)):layer.msg("请选择数据源",{icon:"5"})},getYAggregationArr:function(e,t){var a=this;this.$nextTick(function(){a.leftYLoading=!0,a.$axios.post(a.$baseUrl+"/BI/getFieldByYAxisAggregation.do",a.$qs.stringify({agg:e,pre_index_name:a.form.pre_index_name,suffix_index_name:a.form.suffix_index_name,template_name:a.form.template_name})).then(function(e){a.leftYLoading=!1,e.data.forEach(function(e){var i={value:e.fieldName,label:e.fieldName};a.yAxisArr[t].aggregationParamArr.push(i)})}).catch(function(e){a.leftYLoading=!1})})},xAggregationChange:function(e,t){""!==this.form.pre_index_name&&""!==this.form.suffix_index_name&&""!==this.form.template_name?(this.xAxisArr[t].aggregationParam="",this.xAxisArr[t].aggregationParamArr=[],this.xAxisArr[t].ipRange=[{start:"",end:""}],this.xAxisArr[t].numberRange=[{start:"",end:""}],this.xAxisArr[t].dateRange=[{start:"",end:""}],this.getXAggregationArr(e,t)):layer.msg("请选择数据源",{icon:"5"})},getXAggregationArr:function(e,t){var a=this;this.$nextTick(function(){a.leftXLoading=!0,a.$axios.post(a.$baseUrl+"/BI/getFieldByXAxisAggregation.do",a.$qs.stringify({agg:e,pre_index_name:a.form.pre_index_name,suffix_index_name:a.form.suffix_index_name,template_name:a.form.template_name})).then(function(e){a.leftXLoading=!1,e.data.forEach(function(e){var i={value:e.fieldName,label:e.fieldName};a.xAxisArr[t].aggregationParamArr.push(i)})}).catch(function(e){a.leftXLoading=!1})})},addMetric:function(){""!==this.form.suffix_index_name?this.yAxisArr=[{aggregationType:"",aggregationParam:"",aggregationParamArr:[],yAxisName:"",legendName:""}]:layer.msg("请先选择数据源",{icon:5})},deleteMetric:function(){1===this.xAxisArr.length?layer.msg("请先删除分组",{icon:5}):this.yAxisArr=[]},addBucket:function(){""!==this.form.suffix_index_name?0!==this.yAxisArr.length?this.xAxisArr=[{aggregationType:"",aggregationParam:"",aggregationParamArr:[],timeInterval:"1",timeType:"hourly",xAxisName:"",orderType:"desc",topSum:"5",numberRange:[{start:"",end:""}],dateRange:[{start:"",end:""}],ipRange:[{start:"",end:""}]}]:layer.msg("请先添加统计",{icon:5}):layer.msg("请先选择数据源",{icon:5})},getAssetGroup:function(){var e=this;this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/assetGroup/getAssetGroupList4EventAlertCombobox.do",e.$qs.stringify()).then(function(t){e.loading=!1;var a=t.data;(a.success="true")?e.assetGroupOptions=a.data:layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})})},assetGroupChange:function(e){this.form.alert_asset=[],this.getAsset(e)},getAsset:function(e){var t=this;this.$nextTick(function(){t.loading=!0,t.$axios.post(t.$baseUrl+"/assetGroup/getAssetList4Combobox.do",t.$qs.stringify({asset_group_id:e})).then(function(e){t.loading=!1;var a=e.data;(a.success="true")?t.assetOptions=a.data:layer.msg(a.message,{icon:5})}).catch(function(e){t.loading=!1})})},assetChange:function(){},assetGroupClear:function(){this.form.alert_assetGroup_id="",this.getAsset("")},getFields:function(){var e=this,t=[];for(var a in this.yAxisArr){var i={};i.aggType=this.yAxisArr[a].aggregationType,i.aliasName=this.yAxisArr[a].yAxisName,"Count"===i.aggType?i.field=this.form.datefield:i.field=this.yAxisArr[a].aggregationParam,t.push(i)}var r=[];for(var s in this.xAxisArr){var o={};o.aggType=this.xAxisArr[s].aggregationType,o.field=this.xAxisArr[s].aggregationParam,o.size=this.xAxisArr[s].topSum,o.sort=this.xAxisArr[s].orderType,o.intervalType=this.xAxisArr[s].timeType,o.intervalValue=this.xAxisArr[s].timeInterval;var n=[],c=[],m=[];for(var u in this.xAxisArr[s].numberRange)n.push({from:this.xAxisArr[s].numberRange[u].start,to:this.xAxisArr[s].numberRange[u].end});for(var d in this.xAxisArr[s].dateRange)c.push({from:this.xAxisArr[s].dateRange[d].start,to:this.xAxisArr[s].dateRange[d].end});for(var f in this.xAxisArr[s].ipRange)m.push({from:this.xAxisArr[s].ipRange[f].start,to:this.xAxisArr[s].ipRange[f].end});"Range"===o.aggType?o.ranges=n:"IPv4 Range"===o.aggType?o.ranges=m:"Date Range"===o.aggType?o.ranges=c:o.ranges=[],r.push(o)}this.form.alert_search_metric=l()(t),this.form.alert_search_bucket=l()(r),""===this.form.alert_search_filters&&(this.form.alert_search_filters=[]),this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+"/alert/getAlertResult.do",e.$qs.stringify(e.form)).then(function(t){e.loading=!1;var a=t.data;"true"===a.success?(e.active=2,e.JSONData=a.data):layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})})},addAlarmBtn:function(){this.alarmDialog=!0,this.dialogType="add"},addAlarm:function(){var e,t=l()(this.formDialog);e=JSON.parse(t),"resive"===this.dialogType?this.alarmList[this.currentIndex]=e:this.alarmList.push(e),this.alarmDialog=!1},resiveAlarm:function(e){this.currentIndex=e,this.formDialog=JSON.parse(l()(this.alarmList[e])),this.dialogType="resive",this.alarmDialog=!0,this.getOperatorData(this.formDialog.fieldType)},getFieldData:function(e){var t=this;this.$nextTick(function(){t.alarmLoading=!0;var e={};"[]"===t.form.alert_search_bucket&&"[]"===t.form.alert_search_metric?e.aggType="All":e.aggType="alertAgg",e.template_name=t.form.template_name,t.$axios.post(t.$baseUrl+"/alert/getFieldByAggResult.do",t.$qs.stringify(e)).then(function(e){t.alarmLoading=!1,t.fieldOpt=[],t.fieldType={},e.data.forEach(function(e){t.fieldOpt.push({value:e.fieldName,label:e.fieldName}),"long"===e.fieldType||"integer"===e.fieldType||"short"===e.fieldType||"byte"===e.fieldType||"double"===e.fieldType||"float"===e.fieldType||"half_float"===e.fieldType||"scaled_float"===e.fieldType?t.fieldType[e.fieldName]="number":"boolean"===e.fieldType?t.fieldType[e.fieldName]="boolean":"text"===e.fieldType||"keyword"===e.fieldType?t.fieldType[e.fieldName]="string":"ip"===e.fieldType?t.fieldType[e.fieldName]="ip":"date"===e.fieldType&&(t.fieldType[e.fieldName]="date")})}).catch(function(e){t.alarmLoading=!1})})},getOperatorData:function(e){var t=this;this.$nextTick(function(){t.alarmLoading=!0,t.$axios.post(t.$baseUrl+"/alert/getOperatorByFiledType.do",t.$qs.stringify({fieldType:e})).then(function(e){t.alarmLoading=!1,t.operatorOpt=[],e.data.forEach(function(e){t.operatorOpt.push({value:e,label:e})})}).catch(function(e){t.alarmLoading=!1})})},fieldChange:function(e){this.formDialog.value="",this.formDialog.start="",this.formDialog.end="",this.formDialog.values=[],this.addFromValue="",this.formDialog.operator="",this.formDialog.fieldType=this.fieldType[e],this.getOperatorData(this.formDialog.fieldType)},operatorChange:function(){this.formDialog.value="",this.formDialog.start="",this.formDialog.end="",this.formDialog.values=[],this.addFromValue=""},addValue:function(){this.addFromValue&&!this.formDialog.values.includes(this.addFromValue)&&(this.formDialog.values.push(this.addFromValue),this.addFromValue="")},commitFunc:function(){var e=this,t=JSON.parse(l()(this.form));""!==this.alarmId&&(t.alert_id=this.alarmId),t.alert_conditions=l()(this.alarmList);var a={};a.buckets=this.xAxisArr,a.mertics=this.yAxisArr,0!==a.buckets.length&&(a.buckets[0].aggregationParamArr=[]),0!==a.mertics.length&&(a.mertics[0].aggregationParamArr=[]),a.date=this.defaultVal,a.dateField=this.form.datefield,t.alert_structure=l()(a),this.$nextTick(function(){e.loading=!0,e.$axios.post(e.$baseUrl+e.url,e.$qs.stringify(t)).then(function(t){e.loading=!1;var a=t.data;"true"===a.success?e.active=3:layer.msg(a.message,{icon:5})}).catch(function(t){e.loading=!1})})},addAgain:function(){this.initialize(),this.active=0}},components:{dateLayout:r.default,chooseIndex:s.default,queryFilter:o.default,jsonView:c.a}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("el-steps",{attrs:{active:e.active,simple:""}},[a("el-step",{attrs:{title:"基本信息",icon:"el-icon-edit-outline"}}),e._v(" "),a("el-step",{attrs:{title:"数据源",icon:"el-icon-coin"}}),e._v(" "),a("el-step",{attrs:{title:"选择字段",icon:"el-icon-thumb"}}),e._v(" "),a("el-step",{attrs:{title:"完成",icon:"el-icon-success"}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],staticClass:"con-wapper"},[a("div",{staticClass:"form-con"},[a("div",{staticClass:"form-item"},[a("span",{staticClass:"mustWrite",staticStyle:{left:"23px"}},[e._v("*")]),e._v(" "),a("div",{staticClass:"item-label",staticStyle:{position:"absolute",width:"80px"}},[e._v("名称：")]),e._v(" "),a("div",{staticClass:"item-con",staticStyle:{"margin-left":"80px",width:"350px"}},[a("el-input",{attrs:{size:"mini",placeholder:"名称"},model:{value:e.form.alert_name,callback:function(t){e.$set(e.form,"alert_name",t)},expression:"form.alert_name"}})],1)]),e._v(" "),a("div",{staticClass:"form-item"},[a("span",{staticClass:"mustWrite",staticStyle:{left:"-8px"}},[e._v("*")]),e._v(" "),a("div",{staticClass:"item-label",staticStyle:{position:"absolute",width:"80px",top:"0"}},[e._v("执行周期：")]),e._v(" "),a("div",{staticClass:"item-con",staticStyle:{"margin-left":"80px",width:"350px"}},[[a("el-radio",{attrs:{label:"simple"},model:{value:e.form.alert_exec_type,callback:function(t){e.$set(e.form,"alert_exec_type",t)},expression:"form.alert_exec_type"}},[e._v("普通")]),e._v(" "),a("el-radio",{attrs:{label:"complex"},model:{value:e.form.alert_exec_type,callback:function(t){e.$set(e.form,"alert_exec_type",t)},expression:"form.alert_exec_type"}},[e._v("高级")])],e._v(" "),"simple"===e.form.alert_exec_type?a("div",{staticStyle:{display:"flex","margin-top":"10px"}},[a("el-input",{staticStyle:{"margin-right":"10px"},attrs:{size:"mini",type:"number",min:"1"},on:{change:e.timeCycleNumChange},model:{value:e.form.alert_time_cycle_num,callback:function(t){e.$set(e.form,"alert_time_cycle_num",t)},expression:"form.alert_time_cycle_num"}}),e._v(" "),a("el-select",{attrs:{placeholder:"请选择",size:"mini"},on:{change:e.timeCycleTypeChange},model:{value:e.form.alert_time_cycle_type,callback:function(t){e.$set(e.form,"alert_time_cycle_type",t)},expression:"form.alert_time_cycle_type"}},[a("el-option",{attrs:{label:"秒",value:"second"}}),e._v(" "),a("el-option",{attrs:{label:"分钟",value:"minute"}}),e._v(" "),a("el-option",{attrs:{label:"小时",value:"hour"}})],1)],1):e._e(),e._v(" "),"complex"===e.form.alert_exec_type?a("div",{staticStyle:{"margin-top":"10px"}},[a("el-input",{attrs:{size:"mini",placeholder:"请输入cron表达式"},model:{value:e.form.alert_cron,callback:function(t){e.$set(e.form,"alert_cron",t)},expression:"form.alert_cron"}})],1):e._e(),e._v(" "),"simple"===e.form.alert_exec_type?a("p",{staticStyle:{color:"#e4956d","font-size":"12px",margin:"5px 0 0 0"}},[e._v("(普通模式下，秒、分钟小于60，小时小于24，且都为整数。)")]):e._e(),e._v(" "),"complex"===e.form.alert_exec_type?a("p",{staticStyle:{color:"#e4956d","font-size":"12px",margin:"5px 0 0 0"}},[e._v("例：0 */10 * * * ?    每10分钟的0秒种执行一次")]):e._e()],2)]),e._v(" "),a("div",{staticClass:"form-item"},[a("span",{staticClass:"mustWrite",staticStyle:{left:"-8px"}},[e._v("*")]),e._v(" "),a("div",{staticClass:"item-label",staticStyle:{position:"absolute",width:"80px"}},[e._v("时间范围：")]),e._v(" "),a("div",{staticClass:"item-con",staticStyle:{"margin-left":"80px",width:"350px"}},[a("date-layout",{attrs:{busName:e.busNameObj.busDateName,defaultVal:e.defaultVal}})],1)]),e._v(" "),a("div",{staticClass:"form-item"},[a("div",{staticClass:"item-label",staticStyle:{position:"absolute",top:"5px",width:"80px"}},[e._v("说明：")]),e._v(" "),a("div",{staticClass:"item-con",staticStyle:{"margin-left":"80px"}},[a("el-input",{attrs:{size:"mini",type:"textarea",rows:"10",placeholder:"说明"},model:{value:e.form.alert_note,callback:function(t){e.$set(e.form,"alert_note",t)},expression:"form.alert_note"}})],1)])]),e._v(" "),a("div",{staticClass:"btn-wapper",staticStyle:{display:"flex"}},[a("el-button",{attrs:{type:"primary",disabled:""===e.form.alert_name||("simple"===e.form.alert_exec_type?""===e.form.alert_time_cycle_num:""===e.form.alert_cron)},on:{click:function(t){return e.nextToOne()}}},[e._v("下一步")])],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}],staticClass:"con-wapper"},[a("div",{staticClass:"form-con"},[a("div",{staticClass:"form-item"},[a("span",{staticClass:"mustWrite",staticStyle:{left:"-10px"}},[e._v("*")]),e._v(" "),a("choose-index",{attrs:{busName:this.busNameObj.busIndexName,arr:e.indexVal}})],1),e._v(" "),a("div",{staticClass:"form-item"},[a("div",{staticClass:"item-label",staticStyle:{position:"absolute",top:"9px",width:"64px"}},[e._v("筛选：")]),e._v(" "),a("div",{staticClass:"item-con",staticStyle:{"margin-left":"66px"}},[a("queryFilter",{attrs:{busFilterName:this.busNameObj.busFilterName,defaultFilterArr:this.defaultFilter,queryState:!1,useObject:"chart",templateName:this.form.template_name,preIndexName:this.form.pre_index_name,suffixIndexName:this.form.suffix_index_name}})],1)]),e._v(" "),a("div",{staticClass:"form-item"},[a("div",{staticClass:"item-label",staticStyle:{position:"absolute",top:"9px",width:"64px"}},[e._v("统计：")]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.leftYLoading,expression:"leftYLoading"}],staticClass:"item-con",staticStyle:{"margin-left":"58px"},attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("el-collapse",{model:{value:e.configOpened,callback:function(t){e.configOpened=t},expression:"configOpened"}},e._l(e.yAxisArr,function(t,i){return a("el-collapse-item",{key:i,staticClass:"tablist",attrs:{name:"1"}},[a("template",{staticClass:"collapseTit",slot:"title"},[e._v("\n                                    "+e._s(t.aggregationType)+"\n                                    "),a("i",{staticClass:"header-icon el-icon-error removeTab",on:{click:e.deleteMetric}})]),e._v(" "),a("el-form",{staticStyle:{position:"relative"},attrs:{"label-position":"top"}},[a("el-form-item",{attrs:{label:"聚合类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"mini"},on:{change:function(t){return e.yAggregationChange(t,i)}},model:{value:t.aggregationType,callback:function(a){e.$set(t,"aggregationType",a)},expression:"yItem.aggregationType"}},e._l(e.yAggregation,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),""!==t.aggregationType&&"Count"!==t.aggregationType?a("el-form-item",{attrs:{label:"聚合参数"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:"",size:"mini"},model:{value:t.aggregationParam,callback:function(a){e.$set(t,"aggregationParam",a)},expression:"yItem.aggregationParam"}},e._l(t.aggregationParamArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e()],1)],2)}),1),e._v(" "),0===e.yAxisArr.length?a("p",{staticClass:"addWapper"},[a("span",{on:{click:e.addMetric}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加")])]):e._e()],1)]),e._v(" "),a("div",{staticClass:"form-item"},[a("div",{staticClass:"item-label",staticStyle:{position:"absolute",top:"9px",width:"64px"}},[e._v("分组：")]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.leftXLoading,expression:"leftXLoading"}],staticClass:"item-con",staticStyle:{"margin-left":"58px"},attrs:{"element-loading-background":"rgba(48, 62, 78, 0.5)"}},[a("el-collapse",{model:{value:e.configOpened,callback:function(t){e.configOpened=t},expression:"configOpened"}},e._l(e.xAxisArr,function(t,i){return a("el-collapse-item",{key:i,staticClass:"tablist",attrs:{name:"1"}},[a("template",{staticClass:"collapseTit",slot:"title"},[e._v("\n                                    "+e._s(t.aggregationParam)+"\n                                    "),a("i",{staticClass:"header-icon el-icon-error removeTab",on:{click:function(t){e.xAxisArr=[]}}})]),e._v(" "),a("el-form",{staticStyle:{position:"relative"},attrs:{"label-position":"top"}},[a("el-form-item",{attrs:{label:"聚合类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"mini"},on:{change:function(t){return e.xAggregationChange(t,i)}},model:{value:t.aggregationType,callback:function(a){e.$set(t,"aggregationType",a)},expression:"xItem.aggregationType"}},e._l(e.xAggregation,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"聚合参数"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择",size:"mini"},model:{value:t.aggregationParam,callback:function(a){e.$set(t,"aggregationParam",a)},expression:"xItem.aggregationParam"}},e._l(t.aggregationParamArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),"Date Histogram"===t.aggregationType?a("el-form-item",{attrs:{label:"间隔类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"mini"},model:{value:t.timeType,callback:function(a){e.$set(t,"timeType",a)},expression:"xItem.timeType"}},e._l(e.timeIntervalArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),"Date Histogram"===t.aggregationType?a("el-form-item",{attrs:{label:"间隔数值"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.timeInterval,callback:function(a){e.$set(t,"timeInterval",a)},expression:"xItem.timeInterval"}})],1):e._e(),e._v(" "),"Terms"===t.aggregationType?a("el-form-item",{attrs:{label:"排序方式"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"mini"},model:{value:t.orderType,callback:function(a){e.$set(t,"orderType",a)},expression:"xItem.orderType"}},[a("el-option",{attrs:{label:"降序",value:"desc"}}),e._v(" "),a("el-option",{attrs:{label:"升序",value:"asc"}})],1)],1):e._e(),e._v(" "),"Terms"===t.aggregationType?a("el-form-item",{attrs:{label:"展示数量"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.topSum,callback:function(a){e.$set(t,"topSum",a)},expression:"xItem.topSum"}})],1):e._e(),e._v(" "),"Range"===t.aggregationType?a("el-form-item",{attrs:{label:"范围"}},[e._l(t.numberRange,function(i,l){return a("p",{staticClass:"range-p"},[a("el-input",{attrs:{type:"number",placeholder:"大于等于",size:"mini"},model:{value:i.start,callback:function(t){e.$set(i,"start",t)},expression:"numRange.start"}}),e._v(" "),a("span",[e._v("-")]),e._v(" "),a("el-input",{attrs:{type:"number",placeholder:"小于",size:"mini"},model:{value:i.end,callback:function(t){e.$set(i,"end",t)},expression:"numRange.end"}}),e._v(" "),a("i",{staticClass:"el-icon-error",attrs:{disabled:""},on:{click:function(a){return e.removeItem(t.numberRange,l)}}})],1)}),e._v(" "),a("p",{staticClass:"range-btn-p"},[a("span",{on:{click:function(e){return t.numberRange.push({start:"",end:""})}}},[a("i",{staticClass:"el-icon-circle-plus"}),e._v(" 添加范围")])])],2):e._e(),e._v(" "),"Date Range"===t.aggregationType?a("el-form-item",{attrs:{label:"范围"}},[e._l(t.dateRange,function(i,l){return a("p",{staticClass:"range-p"},[a("el-input",{attrs:{size:"mini"},model:{value:i.start,callback:function(t){e.$set(i,"start",t)},expression:"dateRange.start"}}),e._v(" "),a("span",[e._v("-")]),e._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:i.end,callback:function(t){e.$set(i,"end",t)},expression:"dateRange.end"}}),e._v(" "),a("i",{staticClass:"el-icon-error",attrs:{disabled:""},on:{click:function(a){return e.removeItem(t.dateRange,l)}}})],1)}),e._v(" "),a("p",{staticClass:"range-btn-p"},[a("span",{on:{click:function(e){return t.dateRange.push({start:"",end:""})}}},[a("i",{staticClass:"el-icon-circle-plus"}),e._v(" 添加范围")])])],2):e._e(),e._v(" "),"IPv4 Range"===t.aggregationType?a("el-form-item",{attrs:{label:"范围"}},[e._l(t.ipRange,function(i,l){return a("p",{staticClass:"range-p"},[a("el-input",{attrs:{size:"mini"},model:{value:i.start,callback:function(t){e.$set(i,"start",t)},expression:"ipRange.start"}}),e._v(" "),a("span",[e._v("-")]),e._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:i.end,callback:function(t){e.$set(i,"end",t)},expression:"ipRange.end"}}),e._v(" "),a("i",{staticClass:"el-icon-error",attrs:{disabled:""},on:{click:function(a){return e.removeItem(t.ipRange,l)}}})],1)}),e._v(" "),a("p",{staticClass:"range-btn-p"},[a("span",{on:{click:function(e){return t.ipRange.push({start:"",end:""})}}},[a("i",{staticClass:"el-icon-circle-plus"}),e._v(" 添加范围")])])],2):e._e()],1)],2)}),1),e._v(" "),0===e.xAxisArr.length?a("p",{staticClass:"addWapper"},[a("span",{on:{click:e.addBucket}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加")])]):e._e()],1)]),e._v(" "),a("div",{staticClass:"form-item"},[a("div",{staticClass:"item-label",staticStyle:{position:"absolute",width:"64px"}},[e._v("资产组：")]),e._v(" "),a("div",{staticClass:"item-con",staticStyle:{"margin-left":"80px",width:"350px"}},[a("el-select",{class:{emptyClass:""===e.form.alert_assetGroup_id},attrs:{placeholder:"",size:"mini",clearable:""},on:{change:e.assetGroupChange},model:{value:e.form.alert_assetGroup_id,callback:function(t){e.$set(e.form,"alert_assetGroup_id",t)},expression:"form.alert_assetGroup_id"}},e._l(e.assetGroupOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),""!==e.form.alert_assetGroup_id?a("span",{staticStyle:{color:"#409eff","font-size":"12px",cursor:"pointer"},on:{click:function(t){return e.assetGroupClear()}}},[e._v("清空")]):e._e()],1)]),e._v(" "),a("div",{staticClass:"form-item"},[a("div",{staticClass:"item-label",staticStyle:{position:"absolute",width:"64px"}},[e._v("资产：")]),e._v(" "),a("div",{staticClass:"item-con",staticStyle:{"margin-left":"80px",width:"350px"}},[a("el-select",{class:{emptyClass:""===e.form.alert_equipment_id},attrs:{placeholder:"",size:"mini",clearable:""},on:{change:e.assetChange},model:{value:e.form.alert_equipment_id,callback:function(t){e.$set(e.form,"alert_equipment_id",t)},expression:"form.alert_equipment_id"}},e._l(e.assetOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),""!==e.form.alert_equipment_id?a("span",{staticStyle:{color:"#409eff","font-size":"12px",cursor:"pointer"},on:{click:function(t){e.form.alert_equipment_id=""}}},[e._v("清空")]):e._e()],1)])]),e._v(" "),a("div",{staticClass:"btn-wapper",staticStyle:{display:"flex"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.active=0}}},[e._v("上一步")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.isCanCreate1},on:{click:function(t){return e.getFields()}}},[e._v("下一步")])],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active === 2"}],staticClass:"con-wapper"},[a("div",{staticClass:"form-con"},[a("div",{staticClass:"form-item"},[a("span",{staticClass:"mustWrite"},[e._v("*")]),e._v(" "),a("div",{staticClass:"item-label",staticStyle:{position:"absolute",top:"9px",width:"80px"}},[e._v("告警条件：")]),e._v(" "),a("div",{staticClass:"item-con alarm-list",staticStyle:{"margin-left":"80px","margin-top":"11px","font-size":"14px"}},[e._l(e.alarmList,function(t,i){return a("div",{key:i,staticClass:"alarm-item"},["is one of"!==t.operator&&"is not one of"!==t.operator?a("span",{on:{click:function(t){return e.resiveAlarm(i)}}},[e._v(e._s(t.field)+" "+e._s(t.operator)+" "),a("b",[e._v(e._s(t.value))])]):a("span",{on:{click:function(t){return e.resiveAlarm(i)}}},[e._v(e._s(t.field)+" "+e._s(t.operator)+" "),a("b",[e._v(e._s(t.values))])]),e._v(" "),a("i",{staticClass:"el-icon-close",on:{click:function(t){return e.alarmList.splice(i,1)}}})])}),e._v(" "),a("span",{staticClass:"addFilter",on:{click:function(t){return e.addAlarmBtn()}}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加条件")])],2)]),e._v(" "),a("p",{staticClass:"tip-wapper"},[e._v("提示：告警条件所选字段为下方示例数据的key（即标红字段）")]),e._v(" "),a("p",{staticStyle:{color:"#409eff","font-weight":"600","font-size":"15px","margin-bottom":"10px"}},[e._v("示例数据")]),e._v(" "),a("jsonView",{staticClass:"jsonView",attrs:{data:this.JSONData,theme:"one-dark","line-height":20,deep:5}})],1),e._v(" "),a("div",{staticClass:"btn-wapper",staticStyle:{display:"flex"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.active=1}}},[e._v("上一步")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:0===e.alarmList.length},on:{click:e.commitFunc}},[e._v("提交")])],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:3===e.active,expression:"active === 3"}],staticClass:"con-wapper"},[a("div",{staticClass:"form-con"},[a("div",{staticClass:"success-wapper"},[e._m(0),e._v(" "),a("div",{staticClass:"text-wapper"},[e._v(e._s(""===this.alarmId?"添加完成":"修改完成"))])]),e._v(" "),a("div",{staticClass:"error-wapper"}),e._v(" "),a("div",{staticStyle:{width:"300px",margin:"50px auto"}},[""===e.alarmId?a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.addAgain}},[e._v("再次添加")]):e._e()],1)])]),e._v(" "),a("el-dialog",{attrs:{title:"编辑告警",visible:e.alarmDialog,width:"450px"},on:{"update:visible":function(t){e.alarmDialog=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.alarmLoading,expression:"alarmLoading"}],staticClass:"filter-form-wapper",attrs:{"element-loading-background":"rgba(26,36,47, 0.2)"}},[a("div",{staticClass:"filter-form"},[a("el-form",{staticStyle:{display:"flex"},attrs:{inline:"","label-width":"80px","label-position":"top"}},[a("el-form-item",{staticStyle:{width:"70%"},attrs:{label:"Field"}},[a("el-select",{staticClass:"chooseClass iss",attrs:{placeholder:"请选择",filterable:"","default-first-option":"",size:"mini"},on:{change:e.fieldChange},model:{value:e.formDialog.field,callback:function(t){e.$set(e.formDialog,"field",t)},expression:"formDialog.field"}},e._l(e.fieldOpt,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Operator"}},[a("el-select",{staticClass:"chooseClass iss",attrs:{filterable:"","allow-create":"","default-first-option":"",size:"mini"},on:{change:function(t){return e.operatorChange()}},model:{value:e.formDialog.operator,callback:function(t){e.$set(e.formDialog,"operator",t)},expression:"formDialog.operator"}},e._l(e.operatorOpt,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),"is one of"!==e.formDialog.operator&&"is not one of"!==e.formDialog.operator?a("el-form",{ref:"form",attrs:{"label-width":"80px","label-position":"top"}},["string"===e.fieldType[e.formDialog.field]?a("el-form-item",{attrs:{label:"Value"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.formDialog.value,callback:function(t){e.$set(e.formDialog,"value",t)},expression:"formDialog.value"}})],1):"number"===e.fieldType[e.formDialog.field]?a("el-form-item",{attrs:{label:"Value"}},[a("el-input",{attrs:{type:"number",size:"mini"},model:{value:e.formDialog.value,callback:function(t){e.$set(e.formDialog,"value",t)},expression:"formDialog.value"}})],1):"ip"===e.fieldType[e.formDialog.field]?a("el-form-item",{attrs:{label:"Value"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.formDialog.value,callback:function(t){e.$set(e.formDialog,"value",t)},expression:"formDialog.value"}})],1):"date"===e.fieldType[e.formDialog.field]?a("el-form-item",{attrs:{label:"Value"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.formDialog.value,callback:function(t){e.$set(e.formDialog,"value",t)},expression:"formDialog.value"}})],1):"boolean"===e.fieldType[e.formDialog.field]?a("el-form-item",{attrs:{label:"Value"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.formDialog.value,callback:function(t){e.$set(e.formDialog,"value",t)},expression:"formDialog.value"}},[a("el-option",{attrs:{label:"true",value:"true"}}),e._v(" "),a("el-option",{attrs:{label:"false",value:"false"}})],1)],1):e._e()],1):e._e(),e._v(" "),""===e.formDialog.field||"is one of"!==e.formDialog.operator&&"is not one of"!==e.formDialog.operator?e._e():a("div",[a("p",{staticClass:"values-tit"},[e._v("Value")]),e._v(" "),a("div",{staticClass:"values-wapper"},e._l(e.formDialog.values,function(t,i){return a("span",{key:i},[e._v(e._s(t)),a("i",{staticClass:"el-icon-close",attrs:{title:"删除"},on:{click:function(t){return e.formDialog.values.splice(i,1)}}})])}),0),e._v(" "),a("div",{staticClass:"morevalue-form"},[a("el-form",{staticStyle:{height:"32px",width:"300px"}},["string"===e.fieldType[e.formDialog.field]?a("el-form-item",[a("el-input",{attrs:{size:"mini"},model:{value:e.addFromValue,callback:function(t){e.addFromValue=t},expression:"addFromValue"}})],1):e._e(),e._v(" "),"number"===e.fieldType[e.formDialog.field]?a("el-form-item",[a("el-input",{attrs:{type:"number",size:"mini"},model:{value:e.addFromValue,callback:function(t){e.addFromValue=t},expression:"addFromValue"}})],1):e._e(),e._v(" "),"ip"===e.fieldType[e.formDialog.field]?a("el-form-item",[a("el-input",{attrs:{size:"mini"},model:{value:e.addFromValue,callback:function(t){e.addFromValue=t},expression:"addFromValue"}})],1):e._e(),e._v(" "),"date"===e.fieldType[e.formDialog.field]?a("el-form-item",[a("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",size:"mini","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.addFromValue,callback:function(t){e.addFromValue=t},expression:"addFromValue"}})],1):e._e()],1),e._v(" "),a("el-button",{staticStyle:{background:"0","border-radius":"0"},attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addValue()}}},[e._v("添加")])],1)])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.alarmDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:!!(""===e.formDialog.field||""===e.formDialog.operator||""===e.formDialog.value&&""===e.formDialog.start&&0===e.formDialog.values.length&&""===e.formDialog.end||e.formDialog.label_status&&""===e.formDialog.label)&&"disabled"},on:{click:function(t){return e.addAlarm()}}},[e._v("确 定")])],1)])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"icon-wapper"},[t("i",{staticClass:"el-icon-success"})])}]};var p=a("VU/8")(d,f,!1,function(e){a("uc7R")},"data-v-065340da",null);t.default=p.exports},Xw6U:function(e,t){},akOP:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={name:"addAlarm",data:function(){return{busName:{busIndexName:"addAlarmIndexBus",busFilterName:"addAlarmFilterBus",busDateName:"addAlarmDateBus"}}},components:{alarmFrom:a("4Jb0").default}},l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"content-bg"},[t("div",{staticClass:"top-title"},[this._v("添加告警")]),this._v(" "),t("div",{staticClass:"form-wapper"},[t("alarmFrom",{attrs:{url:"/alert/insert.do",busNameObj:this.busName}})],1)])},staticRenderFns:[]};var r=a("VU/8")(i,l,!1,function(e){a("Xw6U")},"data-v-cdacb7f0",null);t.default=r.exports},uc7R:function(e,t){}});